{"version":3,"file":"ImageCropEditor-DFvxRXQs.js","sources":["../../components/ImageCropEditor.jsx"],"sourcesContent":["// ============================================================================\n// ImageCropEditor - Canvas-based image crop, zoom, and pan editor\n// Used for profile photos and item images\n// ============================================================================\n\nimport React, { memo, useState, useRef, useCallback, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { ZoomIn, ZoomOut, RotateCcw, Check, X } from 'lucide-react';\nimport { colors, spacing, borderRadius, typography } from '../theme.js';\nimport { Button } from './ui.jsx';\n\n// ============================================================================\n// Constants\n// ============================================================================\nconst MIN_ZOOM = 1;\nconst MAX_ZOOM = 5;\nconst ZOOM_STEP = 0.1;\nconst ZOOM_WHEEL_SENSITIVITY = 0.002;\n\n// ============================================================================\n// Helper: crop image on a canvas and return data URL\n// ============================================================================\nfunction cropImageToCanvas(image, cropArea, outputSize, borderRadiusPx = 0) {\n  const canvas = document.createElement('canvas');\n  canvas.width = outputSize;\n  canvas.height = outputSize;\n  const ctx = canvas.getContext('2d');\n\n  // Optional: clip to rounded rect for preview (final output is always square)\n  if (borderRadiusPx > 0) {\n    ctx.beginPath();\n    const r = borderRadiusPx;\n    ctx.moveTo(r, 0);\n    ctx.arcTo(outputSize, 0, outputSize, outputSize, r);\n    ctx.arcTo(outputSize, outputSize, 0, outputSize, r);\n    ctx.arcTo(0, outputSize, 0, 0, r);\n    ctx.arcTo(0, 0, outputSize, 0, r);\n    ctx.closePath();\n    ctx.clip();\n  }\n\n  ctx.drawImage(\n    image,\n    cropArea.x, cropArea.y, cropArea.size, cropArea.size,\n    0, 0, outputSize, outputSize\n  );\n\n  return canvas.toDataURL('image/jpeg', 0.9);\n}\n\n// ============================================================================\n// ImageCropEditor Component\n// ============================================================================\nconst ImageCropEditor = memo(function ImageCropEditor({\n  imageSrc,\n  onCropComplete,\n  onCancel,\n  outputSize = 400,\n  cropShape = 'rounded-square', // 'rounded-square' | 'circle' | 'square'\n  cropBorderRadius = 12,\n  title = 'Crop Image',\n}) {\n  // State\n  const [zoom, setZoom] = useState(1);\n  const [pan, setPan] = useState({ x: 0, y: 0 }); // pan offset in image-space pixels\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [imageNatural, setImageNatural] = useState({ width: 0, height: 0 });\n\n  // Refs\n  const containerRef = useRef(null);\n  const imageRef = useRef(null);\n  const canvasPreviewRef = useRef(null);\n\n  // ============================================================================\n  // Image loading\n  // ============================================================================\n  useEffect(() => {\n    const img = new Image();\n    img.onload = () => {\n      imageRef.current = img;\n      setImageNatural({ width: img.naturalWidth, height: img.naturalHeight });\n      setImageLoaded(true);\n      // Center the image\n      setPan({ x: 0, y: 0 });\n      setZoom(1);\n    };\n    img.src = imageSrc;\n  }, [imageSrc]);\n\n  // ============================================================================\n  // Calculate crop area in image coordinates\n  // ============================================================================\n  const getCropArea = useCallback(() => {\n    if (!imageRef.current) return { x: 0, y: 0, size: 0 };\n    \n    const { width: natW, height: natH } = imageNatural;\n    // The visible crop size in image-space: the smaller dimension divided by zoom\n    const baseCropSize = Math.min(natW, natH);\n    const cropSize = baseCropSize / zoom;\n    \n    // Center point with pan offset\n    const centerX = natW / 2 + pan.x;\n    const centerY = natH / 2 + pan.y;\n    \n    // Crop bounds\n    let x = centerX - cropSize / 2;\n    let y = centerY - cropSize / 2;\n    \n    // Clamp to image bounds\n    x = Math.max(0, Math.min(x, natW - cropSize));\n    y = Math.max(0, Math.min(y, natH - cropSize));\n    \n    return { x, y, size: cropSize };\n  }, [imageNatural, zoom, pan]);\n\n  // ============================================================================\n  // Draw preview on canvas\n  // ============================================================================\n  useEffect(() => {\n    if (!imageLoaded || !canvasPreviewRef.current || !imageRef.current) return;\n\n    const canvas = canvasPreviewRef.current;\n    const ctx = canvas.getContext('2d');\n    const displaySize = canvas.width;\n    const cropArea = getCropArea();\n\n    // Clear\n    ctx.clearRect(0, 0, displaySize, displaySize);\n\n    // Draw cropped region\n    ctx.drawImage(\n      imageRef.current,\n      cropArea.x, cropArea.y, cropArea.size, cropArea.size,\n      0, 0, displaySize, displaySize\n    );\n  }, [imageLoaded, zoom, pan, getCropArea]);\n\n  // ============================================================================\n  // Mouse/Touch handlers for panning\n  // ============================================================================\n  const handlePointerDown = useCallback((e) => {\n    e.preventDefault();\n    setIsDragging(true);\n    setDragStart({ x: e.clientX, y: e.clientY });\n  }, []);\n\n  const handlePointerMove = useCallback((e) => {\n    if (!isDragging || !imageRef.current) return;\n    e.preventDefault();\n\n    const { width: natW, height: natH } = imageNatural;\n    const container = containerRef.current;\n    if (!container) return;\n\n    const containerSize = container.offsetWidth;\n    const baseCropSize = Math.min(natW, natH);\n    \n    // Convert pixel drag to image-space movement\n    const scale = baseCropSize / containerSize / zoom;\n    \n    const dx = (e.clientX - dragStart.x) * scale;\n    const dy = (e.clientY - dragStart.y) * scale;\n\n    setPan(prev => {\n      const cropSize = baseCropSize / zoom;\n      const maxPanX = (natW - cropSize) / 2;\n      const maxPanY = (natH - cropSize) / 2;\n      return {\n        x: Math.max(-maxPanX, Math.min(maxPanX, prev.x - dx)),\n        y: Math.max(-maxPanY, Math.min(maxPanY, prev.y - dy)),\n      };\n    });\n\n    setDragStart({ x: e.clientX, y: e.clientY });\n  }, [isDragging, dragStart, imageNatural, zoom]);\n\n  const handlePointerUp = useCallback(() => {\n    setIsDragging(false);\n  }, []);\n\n  // Global mouse up listener\n  useEffect(() => {\n    if (isDragging) {\n      window.addEventListener('pointerup', handlePointerUp);\n      window.addEventListener('pointermove', handlePointerMove);\n      return () => {\n        window.removeEventListener('pointerup', handlePointerUp);\n        window.removeEventListener('pointermove', handlePointerMove);\n      };\n    }\n  }, [isDragging, handlePointerUp, handlePointerMove]);\n\n  // ============================================================================\n  // Scroll/wheel zoom\n  // ============================================================================\n  const handleWheel = useCallback((e) => {\n    e.preventDefault();\n    const delta = -e.deltaY * ZOOM_WHEEL_SENSITIVITY;\n    setZoom(prev => Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, prev + delta)));\n  }, []);\n\n  // Attach wheel listener with passive: false\n  useEffect(() => {\n    const el = containerRef.current;\n    if (!el) return;\n    el.addEventListener('wheel', handleWheel, { passive: false });\n    return () => el.removeEventListener('wheel', handleWheel);\n  }, [handleWheel]);\n\n  // ============================================================================\n  // Zoom controls\n  // ============================================================================\n  const zoomIn = () => setZoom(prev => Math.min(MAX_ZOOM, prev + ZOOM_STEP * 3));\n  const zoomOut = () => setZoom(prev => Math.max(MIN_ZOOM, prev - ZOOM_STEP * 3));\n  const resetView = () => { setZoom(1); setPan({ x: 0, y: 0 }); };\n\n  // ============================================================================\n  // Commit crop\n  // ============================================================================\n  const handleCropComplete = useCallback(() => {\n    if (!imageRef.current) return;\n    const cropArea = getCropArea();\n    const borderRadius = cropShape === 'circle' ? outputSize / 2 : \n                          cropShape === 'rounded-square' ? cropBorderRadius * (outputSize / 200) : 0;\n    const dataUrl = cropImageToCanvas(imageRef.current, cropArea, outputSize, 0);\n    // Always output square — the display layer handles rounding\n    onCropComplete(dataUrl);\n  }, [getCropArea, outputSize, cropShape, cropBorderRadius, onCropComplete]);\n\n  // ============================================================================\n  // Crop overlay shape\n  // ============================================================================\n  const overlayBorderRadius = cropShape === 'circle' ? '50%' : \n                                cropShape === 'rounded-square' ? `${cropBorderRadius}px` : '0';\n\n  // ============================================================================\n  // Render\n  // ============================================================================\n  if (!imageSrc) return null;\n\n  return (\n    <div style={{ padding: spacing[4] }}>\n      {/* Title */}\n      <div style={{ \n        marginBottom: spacing[3], \n        fontWeight: typography.fontWeight.medium, \n        color: colors.textPrimary,\n        fontSize: typography.fontSize.base,\n      }}>\n        {title}\n      </div>\n\n      {/* Main crop area */}\n      <div\n        ref={containerRef}\n        onPointerDown={handlePointerDown}\n        style={{\n          position: 'relative',\n          width: '100%',\n          maxWidth: 300,\n          aspectRatio: '1',\n          margin: '0 auto',\n          cursor: isDragging ? 'grabbing' : 'grab',\n          userSelect: 'none',\n          touchAction: 'none',\n          overflow: 'hidden',\n          borderRadius: overlayBorderRadius,\n          background: colors.surfaceAlt || '#1a1a2e',\n        }}\n      >\n        {/* Canvas preview showing cropped area */}\n        {imageLoaded && (\n          <canvas\n            ref={canvasPreviewRef}\n            width={300}\n            height={300}\n            style={{\n              width: '100%',\n              height: '100%',\n              display: 'block',\n            }}\n          />\n        )}\n\n        {/* Loading state */}\n        {!imageLoaded && (\n          <div style={{\n            position: 'absolute',\n            inset: 0,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: colors.textMuted,\n          }}>\n            Loading...\n          </div>\n        )}\n      </div>\n\n      {/* Zoom slider & controls */}\n      <div style={{\n        display: 'flex',\n        alignItems: 'center',\n        gap: spacing[2],\n        marginTop: spacing[3],\n        maxWidth: 300,\n        margin: `${spacing[3]}px auto 0`,\n      }}>\n        <button\n          onClick={zoomOut}\n          style={{\n            background: 'none',\n            border: 'none',\n            color: colors.textMuted,\n            cursor: 'pointer',\n            padding: spacing[1],\n            display: 'flex',\n          }}\n          title=\"Zoom out\"\n        >\n          <ZoomOut size={18} />\n        </button>\n\n        <input\n          type=\"range\"\n          min={MIN_ZOOM * 100}\n          max={MAX_ZOOM * 100}\n          value={zoom * 100}\n          onChange={(e) => setZoom(Number(e.target.value) / 100)}\n          style={{\n            flex: 1,\n            accentColor: colors.primary,\n            cursor: 'pointer',\n          }}\n        />\n\n        <button\n          onClick={zoomIn}\n          style={{\n            background: 'none',\n            border: 'none',\n            color: colors.textMuted,\n            cursor: 'pointer',\n            padding: spacing[1],\n            display: 'flex',\n          }}\n          title=\"Zoom in\"\n        >\n          <ZoomIn size={18} />\n        </button>\n\n        <button\n          onClick={resetView}\n          style={{\n            background: 'none',\n            border: 'none',\n            color: colors.textMuted,\n            cursor: 'pointer',\n            padding: spacing[1],\n            display: 'flex',\n          }}\n          title=\"Reset view\"\n        >\n          <RotateCcw size={16} />\n        </button>\n      </div>\n\n      {/* Hint text */}\n      <div style={{\n        textAlign: 'center',\n        fontSize: typography.fontSize.xs,\n        color: colors.textMuted,\n        marginTop: spacing[2],\n      }}>\n        Drag to reposition · Scroll to zoom\n      </div>\n\n      {/* Action buttons */}\n      <div style={{\n        display: 'flex',\n        gap: spacing[3],\n        justifyContent: 'center',\n        marginTop: spacing[4],\n      }}>\n        <Button variant=\"secondary\" onClick={onCancel} icon={X} size=\"sm\">\n          Cancel\n        </Button>\n        <Button onClick={handleCropComplete} icon={Check} size=\"sm\">\n          Apply\n        </Button>\n      </div>\n    </div>\n  );\n});\n\nImageCropEditor.propTypes = {\n  /** Data URL or URL of image to crop */\n  imageSrc: PropTypes.string.isRequired,\n  /** Called with cropped image data URL */\n  onCropComplete: PropTypes.func.isRequired,\n  /** Called when user cancels crop */\n  onCancel: PropTypes.func.isRequired,\n  /** Output image size in pixels */\n  outputSize: PropTypes.number,\n  /** Crop overlay shape */\n  cropShape: PropTypes.oneOf(['rounded-square', 'circle', 'square']),\n  /** Border radius for rounded-square mode */\n  cropBorderRadius: PropTypes.number,\n  /** Title shown above crop area */\n  title: PropTypes.string,\n};\n\nexport default ImageCropEditor;\n"],"names":["MIN_ZOOM","MAX_ZOOM","ZOOM_STEP","ZOOM_WHEEL_SENSITIVITY","cropImageToCanvas","image","cropArea","outputSize","borderRadiusPx","canvas","ctx","r","ImageCropEditor","memo","imageSrc","onCropComplete","onCancel","cropShape","cropBorderRadius","title","zoom","setZoom","useState","pan","setPan","isDragging","setIsDragging","dragStart","setDragStart","imageLoaded","setImageLoaded","imageNatural","setImageNatural","containerRef","useRef","imageRef","canvasPreviewRef","useEffect","img","getCropArea","useCallback","natW","natH","cropSize","centerX","centerY","x","y","displaySize","handlePointerDown","handlePointerMove","container","containerSize","baseCropSize","scale","dx","dy","prev","maxPanX","maxPanY","handlePointerUp","handleWheel","delta","el","zoomIn","zoomOut","resetView","handleCropComplete","dataUrl","overlayBorderRadius","jsxs","spacing","jsx","typography","colors","ZoomOut","ZoomIn","RotateCcw","Button","X","Check","PropTypes"],"mappings":"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"}