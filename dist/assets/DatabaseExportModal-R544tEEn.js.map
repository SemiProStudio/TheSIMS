{"version":3,"file":"DatabaseExportModal-R544tEEn.js","sources":["../../modals/DatabaseExportModal.jsx"],"sourcesContent":["// ============================================================================\n// Database Export Modal\n// Full backup/export of all inventory data\n// ============================================================================\n\nimport React, { memo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Download } from 'lucide-react';\nimport { colors, styles, spacing, borderRadius, typography, withOpacity } from '../theme.js';\nimport { Button } from '../components/ui.jsx';\nimport { Modal, ModalHeader } from './ModalBase.jsx';\n\nexport const DatabaseExportModal = memo(function DatabaseExportModal({ \n  inventory, \n  packages, \n  users, \n  categories,\n  specs,\n  auditLog,\n  packLists,\n  onClose \n}) {\n  const [exportFormat, setExportFormat] = useState('json');\n  const [includeOptions, setIncludeOptions] = useState({\n    inventory: true,\n    packages: true,\n    users: false,\n    categories: true,\n    specs: true,\n    auditLog: false,\n    packLists: true\n  });\n  \n  const toggleOption = (key) => {\n    setIncludeOptions(prev => ({ ...prev, [key]: !prev[key] }));\n  };\n  \n  const handleExport = () => {\n    const timestamp = new Date().toISOString().split('T')[0];\n    \n    if (exportFormat === 'json') {\n      // Full JSON backup\n      const data = {};\n      if (includeOptions.inventory) data.inventory = inventory;\n      if (includeOptions.packages) data.packages = packages;\n      if (includeOptions.users) data.users = users.map(u => ({ ...u, password: undefined }));\n      if (includeOptions.categories) data.categories = categories;\n      if (includeOptions.specs) data.specs = specs;\n      if (includeOptions.auditLog) data.auditLog = auditLog;\n      if (includeOptions.packLists) data.packLists = packLists;\n      \n      data.exportedAt = new Date().toISOString();\n      data.version = '2.0';\n      \n      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `sims-backup-${timestamp}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n    } else {\n      // CSV export (inventory only)\n      const headers = ['id', 'name', 'brand', 'category', 'status', 'condition', 'location', \n        'purchaseDate', 'purchasePrice', 'currentValue', 'serialNumber'];\n      \n      // Add dynamic spec headers\n      const specHeaders = new Set();\n      inventory.forEach(item => {\n        if (item.specs) {\n          Object.keys(item.specs).forEach(key => specHeaders.add(`spec:${key}`));\n        }\n      });\n      const allHeaders = [...headers, ...Array.from(specHeaders)];\n      \n      const rows = inventory.map(item => {\n        const row = headers.map(h => {\n          const val = item[h];\n          if (val === null || val === undefined) return '';\n          return String(val);\n        });\n        \n        // Add spec values\n        Array.from(specHeaders).forEach(specHeader => {\n          const specName = specHeader.replace('spec:', '');\n          row.push(item.specs?.[specName] || '');\n        });\n        \n        return row.map(cell => \n          cell.includes(',') || cell.includes('\"') || cell.includes('\\n') \n            ? `\"${cell.replace(/\"/g, '\"\"')}\"` \n            : cell\n        ).join(',');\n      });\n      \n      const csvContent = [allHeaders.join(','), ...rows].join('\\n');\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `sims-inventory-${timestamp}.csv`;\n      a.click();\n      URL.revokeObjectURL(url);\n    }\n    \n    onClose();\n  };\n  \n  const exportOptions = [\n    { key: 'inventory', label: 'Inventory', count: inventory.length },\n    { key: 'packages', label: 'Kits & Packages', count: packages.length },\n    { key: 'categories', label: 'Categories', count: categories.length },\n    { key: 'specs', label: 'Specifications', count: Object.keys(specs).length },\n    { key: 'packLists', label: 'Pack Lists', count: packLists.length },\n    { key: 'users', label: 'Users (no passwords)', count: users.length },\n    { key: 'auditLog', label: 'Audit Log', count: auditLog.length },\n  ];\n  \n  return (\n    <Modal onClose={onClose} maxWidth={500}>\n      <ModalHeader title=\"Export Database\" onClose={onClose} />\n      <div style={{ padding: spacing[4] }}>\n        \n        {/* Format selection */}\n        <div style={{ marginBottom: spacing[4] }}>\n          <label style={styles.label}>Export Format</label>\n          <div style={{ display: 'flex', gap: spacing[2] }}>\n            <button\n              onClick={() => setExportFormat('json')}\n              style={{\n                ...styles.btnSec,\n                flex: 1,\n                justifyContent: 'center',\n                background: exportFormat === 'json' ? `${withOpacity(colors.primary, 30)}` : 'transparent',\n                borderColor: exportFormat === 'json' ? colors.primary : colors.border\n              }}\n            >\n              JSON (Full Backup)\n            </button>\n            <button\n              onClick={() => setExportFormat('csv')}\n              style={{\n                ...styles.btnSec,\n                flex: 1,\n                justifyContent: 'center',\n                background: exportFormat === 'csv' ? `${withOpacity(colors.primary, 30)}` : 'transparent',\n                borderColor: exportFormat === 'csv' ? colors.primary : colors.border\n              }}\n            >\n              CSV (Inventory Only)\n            </button>\n          </div>\n        </div>\n        \n        {/* Include options (only for JSON) */}\n        {exportFormat === 'json' && (\n          <div style={{ marginBottom: spacing[4] }}>\n            <label style={styles.label}>Include in Export</label>\n            <div style={{ display: 'flex', flexDirection: 'column', gap: spacing[2] }}>\n              {exportOptions.map(opt => (\n                <label \n                  key={opt.key}\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: spacing[2],\n                    cursor: 'pointer',\n                    padding: spacing[2],\n                    borderRadius: borderRadius.md,\n                    background: includeOptions[opt.key] ? `${withOpacity(colors.primary, 10)}` : 'transparent'\n                  }}\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={includeOptions[opt.key]}\n                    onChange={() => toggleOption(opt.key)}\n                    style={{ accentColor: colors.primary }}\n                  />\n                  <span style={{ flex: 1, color: colors.textPrimary }}>{opt.label}</span>\n                  <span style={{ color: colors.textMuted, fontSize: typography.fontSize.sm }}>\n                    {opt.count}\n                  </span>\n                </label>\n              ))}\n            </div>\n          </div>\n        )}\n        \n        {/* Info text */}\n        <p style={{ \n          color: colors.textMuted, \n          fontSize: typography.fontSize.sm, \n          marginBottom: spacing[4],\n          padding: spacing[3],\n          background: colors.bgLight,\n          borderRadius: borderRadius.md\n        }}>\n          {exportFormat === 'json' \n            ? 'JSON backup includes all selected data and can be used to restore your inventory later.'\n            : 'CSV export contains inventory items only, suitable for spreadsheet applications.'}\n        </p>\n        \n        {/* Action buttons */}\n        <div style={{ display: 'flex', gap: spacing[3], justifyContent: 'flex-end' }}>\n          <Button variant=\"secondary\" onClick={onClose}>Cancel</Button>\n          <Button onClick={handleExport} icon={Download}>\n            Export {exportFormat.toUpperCase()}\n          </Button>\n        </div>\n      </div>\n    </Modal>\n  );\n});\n\n// ============================================================================\n// PropTypes\n// ============================================================================\nDatabaseExportModal.propTypes = {\n  /** Full inventory array */\n  inventory: PropTypes.array.isRequired,\n  /** Packages/kits array */\n  packages: PropTypes.array,\n  /** Users array (passwords excluded from export) */\n  users: PropTypes.array,\n  /** Categories array */\n  categories: PropTypes.array,\n  /** Specs configuration object */\n  specs: PropTypes.object,\n  /** Audit log entries */\n  auditLog: PropTypes.array,\n  /** Pack lists array */\n  packLists: PropTypes.array,\n  /** Callback to close modal */\n  onClose: PropTypes.func.isRequired,\n};\n"],"names":["DatabaseExportModal","memo","inventory","packages","users","categories","specs","auditLog","packLists","onClose","exportFormat","setExportFormat","useState","includeOptions","setIncludeOptions","toggleOption","key","prev","handleExport","timestamp","data","u","blob","url","a","headers","specHeaders","item","allHeaders","rows","row","h","val","specHeader","specName","cell","csvContent","exportOptions","jsxs","Modal","jsx","ModalHeader","spacing","styles","withOpacity","colors","opt","borderRadius","typography","Button","Download","PropTypes"],"mappings":"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"}