import{j as n,a as i,t as S,c as u,B as _,J as x}from"./index-TtmnPN12.js";import{a as t,a2 as ne,a3 as oe,H as re,X as ae,a4 as se}from"./vendor-icons-B6HpBdFH.js";const D=1,W=5,B=.1,ie=.002;function ce(Z,l,o,C=0){const m=document.createElement("canvas");m.width=o,m.height=o;const r=m.getContext("2d");if(C>0){r.beginPath();const d=C;r.moveTo(d,0),r.arcTo(o,0,o,o,d),r.arcTo(o,o,0,o,d),r.arcTo(0,o,0,0,d),r.arcTo(0,0,o,0,d),r.closePath(),r.clip()}return r.drawImage(Z,l.x,l.y,l.size,l.size,0,0,o,o),m.toDataURL("image/jpeg",.9)}const le=t.memo(function({imageSrc:l,onCropComplete:o,onCancel:C,outputSize:m=400,cropShape:r="rounded-square",cropBorderRadius:d=12,title:U="Crop Image"}){const[h,f]=t.useState(1),[b,I]=t.useState({x:0,y:0}),[y,q]=t.useState(!1),[k,X]=t.useState({x:0,y:0}),[w,V]=t.useState(!1),[M,$]=t.useState({width:0,height:0}),R=t.useRef(null),g=t.useRef(null),z=t.useRef(null);t.useEffect(()=>{const e=new Image;e.onload=()=>{g.current=e,$({width:e.naturalWidth,height:e.naturalHeight}),V(!0),I({x:0,y:0}),f(1)},e.src=l},[l]);const j=t.useCallback(()=>{if(!g.current)return{x:0,y:0,size:0};const{width:e,height:a}=M,s=Math.min(e,a)/h,O=e/2+b.x,E=a/2+b.y;let p=O-s/2,v=E-s/2;return p=Math.max(0,Math.min(p,e-s)),v=Math.max(0,Math.min(v,a-s)),{x:p,y:v,size:s}},[M,h,b]);t.useEffect(()=>{if(!w||!z.current||!g.current)return;const e=z.current,a=e.getContext("2d"),c=e.width,s=j();a.clearRect(0,0,c,c),a.drawImage(g.current,s.x,s.y,s.size,s.size,0,0,c,c)},[w,h,b,j]);const J=t.useCallback(e=>{e.preventDefault(),q(!0),X({x:e.clientX,y:e.clientY})},[]),T=t.useCallback(e=>{if(!y||!g.current)return;e.preventDefault();const{width:a,height:c}=M,s=R.current;if(!s)return;const O=s.offsetWidth,E=Math.min(a,c),p=E/O/h,v=(e.clientX-k.x)*p,te=(e.clientY-k.y)*p;I(Y=>{const A=E/h,H=(a-A)/2,N=(c-A)/2;return{x:Math.max(-H,Math.min(H,Y.x-v)),y:Math.max(-N,Math.min(N,Y.y-te))}}),X({x:e.clientX,y:e.clientY})},[y,k,M,h]),P=t.useCallback(()=>{q(!1)},[]);t.useEffect(()=>{if(y)return window.addEventListener("pointerup",P),window.addEventListener("pointermove",T),()=>{window.removeEventListener("pointerup",P),window.removeEventListener("pointermove",T)}},[y,P,T]);const L=t.useCallback(e=>{e.preventDefault();const a=-e.deltaY*ie;f(c=>Math.max(D,Math.min(W,c+a)))},[]);t.useEffect(()=>{const e=R.current;if(e)return e.addEventListener("wheel",L,{passive:!1}),()=>e.removeEventListener("wheel",L)},[L]);const F=()=>f(e=>Math.min(W,e+B*3)),G=()=>f(e=>Math.max(D,e-B*3)),K=()=>{f(1),I({x:0,y:0})},Q=t.useCallback(()=>{if(!g.current)return;const e=j(),a=ce(g.current,e,m,0);o(a)},[j,m,r,d,o]),ee=r==="circle"?"50%":r==="rounded-square"?`${d}px`:"0";return l?n.jsxs("div",{style:{padding:i[4]},children:[n.jsx("div",{style:{marginBottom:i[3],fontWeight:S.fontWeight.medium,color:u.textPrimary,fontSize:S.fontSize.base},children:U}),n.jsxs("div",{ref:R,onPointerDown:J,style:{position:"relative",width:"100%",maxWidth:300,aspectRatio:"1",margin:"0 auto",cursor:y?"grabbing":"grab",userSelect:"none",touchAction:"none",overflow:"hidden",borderRadius:ee,background:u.surfaceAlt||"#1a1a2e"},children:[w&&n.jsx("canvas",{ref:z,width:300,height:300,style:{width:"100%",height:"100%",display:"block"}}),!w&&n.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:u.textMuted},children:"Loading..."})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i[2],marginTop:i[3],maxWidth:300,margin:`${i[3]}px auto 0`},children:[n.jsx("button",{onClick:G,style:{background:"none",border:"none",color:u.textMuted,cursor:"pointer",padding:i[1],display:"flex"},title:"Zoom out",children:n.jsx(ne,{size:18})}),n.jsx("input",{type:"range",min:D*100,max:W*100,value:h*100,onChange:e=>f(Number(e.target.value)/100),style:{flex:1,accentColor:u.primary,cursor:"pointer"}}),n.jsx("button",{onClick:F,style:{background:"none",border:"none",color:u.textMuted,cursor:"pointer",padding:i[1],display:"flex"},title:"Zoom in",children:n.jsx(oe,{size:18})}),n.jsx("button",{onClick:K,style:{background:"none",border:"none",color:u.textMuted,cursor:"pointer",padding:i[1],display:"flex"},title:"Reset view",children:n.jsx(re,{size:16})})]}),n.jsx("div",{style:{textAlign:"center",fontSize:S.fontSize.xs,color:u.textMuted,marginTop:i[2]},children:"Drag to reposition Â· Scroll to zoom"}),n.jsxs("div",{style:{display:"flex",gap:i[3],justifyContent:"center",marginTop:i[4]},children:[n.jsx(_,{variant:"secondary",onClick:C,icon:ae,size:"sm",children:"Cancel"}),n.jsx(_,{onClick:Q,icon:se,size:"sm",children:"Apply"})]})]}):null});le.propTypes={imageSrc:x.string.isRequired,onCropComplete:x.func.isRequired,onCancel:x.func.isRequired,outputSize:x.number,cropShape:x.oneOf(["rounded-square","circle","square"]),cropBorderRadius:x.number,title:x.string};export{le as I};
//# sourceMappingURL=ImageCropEditor-DFvxRXQs.js.map
