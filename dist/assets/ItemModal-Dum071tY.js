const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-TtmnPN12.js","assets/vendor-icons-B6HpBdFH.js","assets/vendor-react-DwPMHwnM.js","assets/index-BNfydcti.css"])))=>i.map(i=>d[i]);
import{a3 as Bt,a4 as Lt,r as _t,a5 as Ne,_ as nt,a6 as Je,e as Wt,j as e,a as r,t as j,c as n,i as H,w as z,s as _,B as ee,J as I,d as Ot,S as Ie,M as At,D as Et}from"./index-TtmnPN12.js";import{a as v,a0 as Be,F as Te,X as we,a4 as rt,f as Le,g as _e,a7 as qt,T as Ft,t as Ut,b as Vt}from"./vendor-icons-B6HpBdFH.js";import{M as it,a as at}from"./ModalBase-BgtxHV_N.js";import{I as Ht}from"./ImageCropEditor-DFvxRXQs.js";function Dt({isEdit:l,itemId:t,itemForm:o,setItemForm:a,specs:d,categorySettings:c,locations:m,inventory:g,categories:f=[]}){const[y,M]=v.useState({}),[u,B]=v.useState({}),W=d[o.category]||[],N=v.useMemo(()=>g.map(b=>b.id),[g]),A=v.useMemo(()=>g.map(b=>b.code).filter(Boolean),[g]),R=v.useMemo(()=>l?null:Bt(o.category,N),[l,o.category,N]),F=v.useMemo(()=>{if(!o.serialNumber?.trim())return null;const b=o.serialNumber.trim().toLowerCase(),k=g.find(T=>T.serialNumber?.toLowerCase()===b&&T.id!==t);return k&&l&&k.name===o.name?null:k},[o.serialNumber,o.name,l,g,t]),Y=c?.[o.category]||{trackQuantity:!1,trackSerialNumbers:!0,lowStockThreshold:0},Z=v.useMemo(()=>W.filter(k=>k.required).every(k=>o.specs[k.name]?.trim()),[W,o.specs]),V=!Y.trackSerialNumbers||o.serialNumber?.trim(),D=v.useMemo(()=>Lt(o,{existingCodes:A,editingId:t,customCategories:f}),[o,A,t,f]),Q=o.name?.trim()&&o.brand?.trim()&&!F&&Z&&V&&D.isValid,J=v.useMemo(()=>m?_t(m):[],[m]),G=v.useCallback((b,k)=>{a(T=>({...T,[b]:k})),y[b]&&M(T=>({...T,[b]:null})),B(T=>({...T,[b]:!0}))},[a,y]),K=v.useCallback((b,k)=>{a(T=>({...T,specs:{...T.specs,[b]:k}}))},[a]),h=v.useCallback(b=>{B(k=>({...k,[b]:!0})),D.errors[b]&&M(k=>({...k,[b]:D.errors[b]}))},[D.errors]),S=v.useCallback(()=>{const b=Object.keys(o).reduce((T,U)=>(T[U]=!0,T),{});B(b);const k={...D.errors};return F&&(k.serialNumber=`Serial number already exists on "${F.name}"`),Z||(k.specs="Please fill in all required specifications"),Y.trackSerialNumbers&&!o.serialNumber?.trim()&&(k.serialNumber="Serial number is required for this category"),M(k),Object.keys(k).length===0},[o,D.errors,F,Z,Y]),x=v.useCallback(b=>u[b]&&(y[b]||D.errors[b])||null,[u,y,D.errors]),w=v.useCallback(()=>{M({}),B({})},[]);return{isValid:Q,errors:y,touched:u,validation:D,getFieldError:x,validateAll:S,clearErrors:w,handleBlur:h,previewCode:R,duplicateSerialNumber:F,categorySpecs:W,currentCategorySettings:Y,flattenedLocations:J,handleChange:G,handleSpecChange:K}}const Pe=["Sony","Canon","Nikon","Panasonic","Blackmagic","RED","ARRI","Fujifilm","Fuji","Leica","Zeiss","Sigma","Tamron","Tokina","Rokinon","Samyang","Voigtlander","Sennheiser","Rode","RÃ¸de","Shure","Audio-Technica","Zoom","Tascam","Sound Devices","Aputure","Godox","Profoto","Broncolor","Litepanels","Kino Flo","Nanlite","Astera","DJI","Zhiyun","Manfrotto","Gitzo","Sachtler","Tilta","SmallRig","Wooden Camera","Atomos","SmallHD","Teradek","Hollyland","SanDisk","Samsung","Lexar","ProGrade","Apple","Blackmagic Design","Davinci","Avid","Neewer","Elgato","K-Tek","Rycote","Bubblebee","Lectrosonics","Wisycom","Zaxcom","Cooke","Angenieux","Fujinon","Schneider","Tiffen","Lee Filters","NiSi","Matthews","Avenger","Kupo","American Grip","Modern Studio","OConnor","Vinten","Miller","Cartoni","Libec","Benro","Peak Design","Sanken","DPA","Schoeps","Neumann","AKG","Beyerdynamic","Anton Bauer","IDX","Core SWX","Hawk-Woods","Bebob","Dedolight","Mole-Richardson","Quasar Science","Pelican","SKB","Nanuk","Porta Brace","Tenba","Think Tank","Deity","Tentacle Sync","Timecode Systems"],Kt={Cameras:["camera","camcorder","cinema camera","mirrorless","dslr","sensor type","video camera","digital camera"],Lenses:["lens","focal length","aperture","f/","prime lens","zoom lens","wide angle","telephoto","anamorphic"],Lighting:["light","led","strobe","flash","softbox","panel","fresnel","rgb light","bi-color","watt","lumen","fixture"],Audio:["microphone","mic","audio","recorder","wireless system","lavalier","shotgun","boom pole","preamp","mixer"],Support:["tripod","monopod","gimbal","stabilizer","fluid head","slider","dolly","jib","crane","rig"],Grip:["c-stand","grip head","arm","clamp","flag","frame","silk","net","scrim","gobo","sandbag"],Accessories:["battery","charger","cable","adapter","mount","cage","filter","hood","follow focus"],Storage:["card","ssd","drive","memory card","cfast","sd card","storage","cfexpress"],Monitors:["monitor","display","screen","viewfinder","evf","on-camera monitor","field monitor"],Power:["v-mount","gold mount","power supply","battery plate","ac adapter","battery pack"],Consumables:["tape","gel","diffusion","gaffer","expendable"]};function ot(l){if(!l||typeof l!="string")return"";let t=l;return t=t.replace(/<img[^>]*\/?>/gi,""),t=t.replace(/<svg[\s\S]*?<\/svg>/gi,""),t=t.replace(/<(?:picture|video|audio|iframe|canvas|object|embed)[^>]*(?:\/>|>[\s\S]*?<\/(?:picture|video|audio|iframe|canvas|object|embed)>)/gi,""),t=t.replace(/<(?:script|style|noscript)[\s\S]*?<\/(?:script|style|noscript)>/gi,""),t=t.replace(/<!--[\s\S]*?-->/g,""),t=t.replace(/<(?:button|nav|footer|form)[^>]*>[\s\S]*?<\/(?:button|nav|footer|form)>/gi,""),t=t.replace(/<table[^>]*>([\s\S]*?)<\/table>/gi,(o,a)=>{const d=[],c=/<tr[^>]*>([\s\S]*?)<\/tr>/gi;let m;for(;(m=c.exec(a))!==null;){const g=/<t[dh][^>]*>([\s\S]*?)<\/t[dh]>/gi,f=[];let y;for(;(y=g.exec(m[1]))!==null;){const M=y[1].replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();M&&f.push(M)}f.length>=2?d.push(f[0]+"	"+f.slice(1).join(", ")):f.length===1&&d.push(f[0])}return d.join(`
`)}),t=t.replace(/<br\s*\/?>/gi,`
`),t=t.replace(/<hr\s*\/?>/gi,`
`),t=t.replace(/<\/(?:p|div|tr|li|h[1-6]|dt|dd|section|article|header|blockquote)>/gi,`
`),t=t.replace(/<dt[^>]*>([\s\S]*?)<\/dt>\s*<dd[^>]*>([\s\S]*?)<\/dd>/gi,(o,a,d)=>{const c=a.replace(/<[^>]+>/g,"").trim(),m=d.replace(/<[^>]+>/g,"").trim();return c+"	"+m+`
`}),t=t.replace(/<\/t[dh]>\s*<t[dh][^>]*>/gi,"	"),t=t.replace(/<\/tr>\s*/gi,`
`),t=t.replace(/<[^>]+>/g,""),t=t.replace(/&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&quot;/g,'"'),t=t.replace(/&#39;/g,"'"),t=t.replace(/&nbsp;/g," "),t=t.replace(/&#(\d+);/g,(o,a)=>String.fromCharCode(Number(a))),t=t.replace(/&[a-zA-Z]+;/g," "),t=t.replace(/\t+/g,"	"),t=t.replace(/[ \t]*\n[ \t]*/g,`
`),t=t.replace(/\n{3,}/g,`

`),t=t.replace(/^\s+|\s+$/g,""),t}function Ze(l){return new Promise((t,o)=>{const a=new FileReader;a.onload=d=>t(d.target.result),a.onerror=()=>o(new Error("Failed to read file")),a.readAsText(l)})}let Xe=!1;async function Gt(l){!Xe&&!window.pdfjsLib&&await new Promise((d,c)=>{const m=document.createElement("script");m.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",m.onload=()=>{window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",Xe=!0,d()},m.onerror=()=>c(new Error("Failed to load PDF.js library")),document.head.appendChild(m)});const t=await l.arrayBuffer(),o=await window.pdfjsLib.getDocument({data:t}).promise,a=[];for(let d=1;d<=o.numPages;d++){const m=await(await o.getPage(d)).getTextContent(),g=new Map;for(const y of m.items){if(!y.str||!y.str.trim())continue;const M=Math.round(y.transform[5]/3)*3;g.has(M)||g.set(M,[]),g.get(M).push({x:y.transform[4],text:y.str,width:y.width||0})}const f=[...g.entries()].sort((y,M)=>M[0]-y[0]);for(const[,y]of f){y.sort((u,B)=>u.x-B.x);let M=y[0].text;for(let u=1;u<y.length;u++){const B=y[u-1].x+(y[u-1].width||y[u-1].text.length*5),W=y[u].x-B;M+=(W>30?"	":" ")+y[u].text}a.push(M.trim())}d<o.numPages&&a.push("")}return a.join(`
`)}function X(l){return l.toLowerCase().replace(/[-â€“â€”]/g," ").replace(/[()[\]{}]/g,"").replace(/[^a-z0-9\s/%.]/g,"").replace(/\s+/g," ").trim()}const Yt={freq:"frequency",temp:"temperature",max:"maximum",min:"minimum",mic:"microphone",res:"resolution",conn:"connector",dim:"dimensions",wt:"weight",bat:"battery",batt:"battery",vol:"voltage",pwr:"power",cap:"capacity",compat:"compatibility",stab:"stabilization",adj:"adjustment",diam:"diameter",ht:"height",len:"length",sens:"sensitivity",imp:"impedance",approx:"approximate",incl:"included",info:"information",spec:"specification",specs:"specifications",num:"number",qty:"quantity",ext:"extended",dia:"diameter",opt:"optical",mech:"mechanical",elec:"electronic",def:"definition",vid:"video",aud:"audio",rec:"recording",cont:"continuous",std:"standard"};function ne(l){return l.split(" ").map(t=>Yt[t]||t).join(" ")}const Qe=new Set(["type","size","rate","range","mode","with","from","for","the","and","max","min","output","input","total","number","system","included","support","supported","compatible","maximum","minimum","speed","level","control","depth","life","time","capacity","power","count","body","recording","card","cable","mount","class","general","specification","specifications","key","features","feature","details","detail","info","information","other","additional","about","product","item"]);function et(l,t){if(l.length===0)return t.length;if(t.length===0)return l.length;const o=[];for(let a=0;a<=l.length;a++)o[a]=[a];for(let a=0;a<=t.length;a++)o[0][a]=a;for(let a=1;a<=l.length;a++)for(let d=1;d<=t.length;d++){const c=l[a-1]===t[d-1]?0:1;o[a][d]=Math.min(o[a-1][d]+1,o[a][d-1]+1,o[a-1][d-1]+c)}return o[l.length][t.length]}function ve(l,t){const o=X(l),a=X(t);if(!o||!a)return 0;if(o===a)return 100;const d=ne(o),c=ne(a);if(d===c)return 97;if(c.length>=4&&d.includes(c)&&c.length/d.length>.4)return 85+Math.min(10,c.length/d.length*10);if(d.length>=4&&c.includes(d)&&d.length/c.length>.4)return 80+Math.min(10,d.length/c.length*10);const m=d.split(" ").filter(f=>f.length>2&&!Qe.has(f)),g=c.split(" ").filter(f=>f.length>2&&!Qe.has(f));if(m.length>0&&g.length>0){let f=0,y=0;const M=new Set;for(const N of m){const A=g.findIndex((R,F)=>!M.has(F)&&R===N);if(A!==-1){f++,M.add(A);continue}if(N.length>=5){const R=g.findIndex((F,Y)=>!M.has(Y)&&F.length>=5&&et(N,F)<=1);R!==-1&&(y++,M.add(R))}}const u=f+y*.8,B=Math.max(m.length,g.length),W=u/B;if(W>=.5)return Math.round(50+W*35+(f>y?5:0));if(f===1&&m.find(N=>g.includes(N)&&N.length>=7))return 55;if(f===1&&m.find(N=>g.includes(N)&&N.length>=5))return 50}if(d.length<=20&&c.length<=20){const f=Math.max(d.length,c.length),M=1-et(d,c)/f;if(M>=.7)return Math.round(40+M*20)}return 0}const Jt={"sensor type":["sensor","image sensor","sensor specification"],"sensor size":["format","image circle","coverage","sensor format"],"effective pixels":["megapixels","mp","resolution","pixel count","total pixels","image resolution"],"video resolution":["video","video recording","movie recording","max video","4k","8k","video capability","recording resolution"],"frame rates":["frame rate","fps","recording fps"],"mount type":["lens mount","camera mount","bayonet"],"lens mount":["mount","camera mount","mount type","bayonet mount"],"focal length":["zoom range","focal range","fl"],"maximum aperture":["max aperture","aperture","f-stop","fastest aperture","widest aperture","speed","wide open"],"minimum aperture":["min aperture","smallest aperture"],"light type":["lamp type","bulb type","light source","emitter type"],"max power output":["power output","output power","wattage","watts","max power","power"],"color temperature":["color temp","cct","kelvin","white balance"],"cct range":["color temperature range","temp range","kelvin range"],"microphone type":["mic type","transducer","capsule type"],"transducer type":["capsule","element type"],"polar pattern":["pickup pattern","pattern","directivity","directionality"],"frequency response":["freq response","frequency range","bandwidth"],"output connector":["connector","connection","connector type","output type"],"max payload":["payload","payload capacity","max load","load capacity","maximum payload"],capacity:["storage capacity","total capacity","storage size"],compatibility:["compatible with","works with","supported devices"],weight:["body weight","total weight","net weight","unit weight","approx weight"],dimensions:["size","body size","measurements","lxwxh","exterior dimensions","overall dimensions","wxhxd"],"iso range":["iso","iso sensitivity","iso speed","native iso"],"af system":["autofocus","autofocus system","focus system","af type"],"af points":["focus points","autofocus points","af coverage"],stabilization:["image stabilization","ibis","ois","vr","is","steady shot","sensor shift"],"wireless connectivity":["wifi","wi-fi","bluetooth","wireless","nfc"],"battery life":["shots per charge","battery duration","runtime"],"battery type":["battery","power source","battery model"],"weather sealing":["weather sealed","dust proof","moisture resistant","environmental sealing","splash proof"],"screen size":["display size","lcd size","monitor size"],"panel type":["display type","lcd type","screen type"],brightness:["luminance","nits","cd/m2","max brightness"],"read speed":["max read","sequential read","read rate"],"write speed":["max write","sequential write","write rate"],"image stabilization":["stabilization","ois","lens stabilization","vr","is","optical stabilization"],"filter thread":["filter size","front filter","front thread"],"self-noise":["self noise","equivalent noise","noise level","noise floor"],sensitivity:["mic sensitivity","output level"],"max spl":["maximum spl","max sound pressure","clipping level"],cri:["color rendering","color rendering index","ra"],tlci:["television lighting consistency","television lighting consistency index"],"beam angle":["beam spread","coverage angle","field angle"],"power draw":["power consumption","wattage","max draw","current draw"],voltage:["nominal voltage","output voltage","operating voltage"],"charge time":["charging time","recharge time","full charge"],"head type":["fluid head","head style","pan tilt head"],"max height":["maximum height","extended height","full height"],"leg sections":["sections","number of sections"],"support type":["tripod type","stand type"],"min height":["minimum height","lowest height"],"continuous shooting":["burst rate","drive speed","continuous drive"],"shutter speed range":["shutter speed","shutter range","mechanical shutter"],"lcd screen":["lcd","rear display","rear screen"],"viewfinder type":["evf","viewfinder","ovf","electronic viewfinder"],"memory card slots":["card slots","media slots","memory slots"],"card types supported":["supported cards","media type","compatible cards","card type"],"video output":["hdmi output","video out","hdmi","sdi"],"audio input":["mic input","audio in","microphone input","xlr input"],"optical design":["lens construction","elements/groups","optical formula","lens design"],"diaphragm blades":["aperture blades","iris blades","number of blades"],"minimum focus distance":["mfd","close focus","closest focus","near limit","closest focusing distance"],"maximum magnification":["max magnification","magnification ratio","reproduction ratio"],autofocus:["af","auto focus","focus motor"],"luminous flux (lm)":["lumens","lumen output","lm","total output"],"illuminance (lux)":["lux","lux output","lux at 1m"],"modifier mount":["bowens mount","light modifier","accessory mount"],"wireless control":["app control","remote control","bluetooth control"],"signal-to-noise ratio":["snr","s/n ratio","signal to noise"],"dynamic range":["dr"],"phantom power":["48v","phantom","p48"],"wireless frequency":["frequency band","rf frequency","wireless band"],"wireless range":["operating range","transmission range","rf range"],"capacity (wh)":["watt hours","wh","energy capacity"],"capacity (mah)":["mah","milliamp hours","amp hours"],"angle of view":["aov","field of view","fov"],"af motor type":["focus motor","af drive","af motor"],"lens format coverage":["coverage","image circle","format coverage","sensor coverage"],"video format":["codec","recording format","compression","video codec"],"bit depth":["color depth","color bit depth"],"chroma subsampling":["chroma","color subsampling","subsampling"],"hdr recording":["hdr","hdr video","hlg","high dynamic range"],"af detection":["af subject detection","subject tracking","eye af","face detection"],"viewfinder coverage":["evf coverage","viewfinder magnification"],"body material":["construction","chassis","body construction","housing"],"image processor":["processor","engine","image engine","processing engine"],"cooling system":["fan","cooling","active cooling","heat dissipation"],"storage type":["media type","drive type","interface type"],interface:["connection type","bus type"],"form factor":["card size","physical size"],"video speed class":["v class","video class"],"aspect ratio":["display ratio","screen ratio"],"contrast ratio":["contrast","static contrast"],"color gamut":["gamut","color space","rec 709","dci p3"],touchscreen:["touch","touch input","touch display"],"focus assist":["peaking","focus peaking","punch in"],chemistry:["cell chemistry","cell type","battery chemistry"],"max discharge":["continuous draw","max current","peak current"],"protection circuits":["bms","protection","overcharge protection","safety features"],"airline approved":["flight safe","airline safe","faa approved"],"grip type":["stand type","clamp type","holder type"],"primary use":["application","intended use","use case"],material:["build material","construction material"]};function Zt(l){const t=new Map,o=new Set,a=new Map;return l?(Object.entries(l).forEach(([d,c])=>{Array.isArray(c)&&c.forEach(m=>{if(!m.name)return;const g=m.name;o.add(g),a.set(g,d),t.set(X(g),{specName:g,priority:100,category:d});const f=ne(X(g));f!==X(g)&&t.set(f,{specName:g,priority:98,category:d});const y=X(g).split(" ");if(y.length>1){const M=new Set(["type","size","rate","range","mode","with","from","output","input","total","number","system","included","support","supported","compatible","maximum","minimum","speed","level","control","depth","life","time","capacity","power","count","body","recording","card","cable","mount","class","ratio","material","format","angle","length","height","weight","draw","plate","points","slots","display","assist","color","load","adjustment","rotation","position","noise","temp"]);y.forEach(u=>{if(u.length>=5&&!M.has(u)){const B=t.get(u);(!B||B.priority<40)&&t.set(u,{specName:g,priority:40,category:d})}})}})}),Object.entries(Jt).forEach(([d,c])=>{const m=X(d),g=t.get(m),f=g?g.specName:null,y=g?g.category:null;f&&c.forEach(M=>{const u=X(M),B=t.get(u);(!B||B.priority<80)&&t.set(u,{specName:f,priority:80,category:y});const W=ne(u);if(W!==u){const N=t.get(W);(!N||N.priority<78)&&t.set(W,{specName:f,priority:78,category:y})}})}),{aliasMap:t,allSpecNames:[...o],specCategories:a}):{aliasMap:t,allSpecNames:[...o],specCategories:a}}function ke(l,t,{communityAliases:o}={}){const a={name:"",brand:"",category:"",purchasePrice:"",priceNote:"",serialNumber:"",modelNumber:"",fields:new Map,unmatchedPairs:[],rawExtracted:[]};if(!l||typeof l!="string")return a;const d=ot(l),c=d.split(`
`).map(h=>h.trim()).filter(h=>h),m=[/^([^\t]{2,60})\t+(.+)$/,/^([^:]{2,60}):\s+(.+)$/,/^([^|]{2,60})\s*\|\s*(.+)$/,/^([^=]{2,60})\s*=\s*(.+)$/,/^([^â†’]{2,40})\s*â†’\s*(.{2,})$/,/^([^-]{2,40})\s+[-â€“â€”]\s+(.{2,})$/],g=[/^(home|shop|cart|login|sign in|sign up|sign out|menu|search|filter by|sort by|subscribe|newsletter|cookie|accept|privacy|terms|copyright|Â©|all rights)/i,/^(add to|buy now|add to cart|in stock|out of stock|free shipping|see more|learn more|read more|show more|view all|close|back to|next|prev)/i,/^(share|tweet|pin it|email this|print|save for|wishlist|compare|reviews?\s*\(|rating|stars?|^\d+ customer)/i,/^\d+(\.\d+)?$/,/^[A-Z0-9]{3,}$/,/^\[.*\]$/],f=[];for(let h=0;h<c.length;h++){const S=c[h];if(S.length<3||S.length>300||g.some(w=>w.test(S)))continue;let x=!1;for(const w of m){const b=S.match(w);if(b){let[,k,T]=b;if(k=k.trim(),T=T.trim(),T.startsWith("http")||T.length>200||T.length<1||k.length<2)continue;f.push({key:k,value:T,sourceLine:S,lineIndex:h}),x=!0;break}}if(!x&&h+1<c.length){const w=c[h+1]?.trim(),b=S.length>=3&&S.length<=50&&!/^\d/.test(S)&&!/[:|\t=â†’]/.test(S)&&/^[A-Za-z]/.test(S),k=w&&w.length>=1&&w.length<=150&&(/^\d/.test(w)||/\b(mm|cm|m|kg|g|lbs|oz|W|V|Wh|mAh|Hz|kHz|dB|lux|lm|cd|Â°|fps|bit|yes|no|true|false|approx)\b/i.test(w)||/^(f\/|[A-Z]{2,4}[\s-])/i.test(w));b&&k&&(f.push({key:S,value:w,sourceLine:`${S} â†’ ${w}`,lineIndex:h}),h++,x=!0)}if(!x&&!a.name&&S.length>5&&S.length<120){const w=Pe.some(k=>S.toLowerCase().includes(k.toLowerCase())),b=/\b(camera|lens|light|mic|microphone|tripod|monitor|recorder|flash|strobe|gimbal|stabilizer|wireless|transmitter|receiver|boom|shotgun|panel|fixture|battery|card)\b/i.test(S);(w||b)&&(a.name=S)}}a.rawExtracted=f.map(h=>({key:h.key,value:h.value,lineIndex:h.lineIndex,sourceLine:h.sourceLine}));const y=/^(sale\s*price|price|msrp|list\s*price|rrp|retail\s*price|srp|map\s*price|street\s*price)$/i;let M=null;const u=["sale price","street price","map price","price","msrp","list price","rrp","retail price","srp"];let B=1/0;for(const h of f){const S=h.key.trim().toLowerCase();if(y.test(S)){const x=u.findIndex(b=>S.includes(b)),w=x===-1?u.length:x;if(w<B){const b=h.value.match(/[$â‚¬Â£Â¥]?\s*([\d,]+\.?\d*)/);b&&(M=b[1].replace(/,/g,""),B=w)}}}if(M)a.purchasePrice=M;else{const h=l.match(/[$â‚¬Â£Â¥]\s*([\d,]+\.?\d*)\s*[-â€“â€”]\s*[$â‚¬Â£Â¥]?\s*([\d,]+\.?\d*)/);if(h)a.purchasePrice=h[1].replace(/,/g,""),a.priceNote=`Range: ${h[0]}`;else{const S=l.match(/[$â‚¬Â£Â¥]\s*([\d,]+\.?\d*)/);if(S){a.purchasePrice=S[1].replace(/,/g,"");const x=l.match(/([$â‚¬Â£Â¥])/);if(x&&x[1]!=="$"){const w={"â‚¬":"EUR","Â£":"GBP","Â¥":"JPY/CNY"};a.priceNote=`Currency: ${w[x[1]]||x[1]}`}}}}const W=d.toLowerCase(),N=a.name?a.name.toLowerCase():W;for(const h of Pe)if(N.includes(h.toLowerCase())){a.brand=h;break}if(!a.brand){for(const h of Pe)if(W.includes(h.toLowerCase())){a.brand=h;break}}for(const[h,S]of Object.entries(Kt)){let x=0;for(const w of S)W.includes(w)&&x++;x>0&&(!a.category||x>(a._catScore||0))&&(a.category=h,a._catScore=x)}delete a._catScore;const A=/^(serial\s*(number|no|#)?|s\/n|sn)$/i,R=/^(model\s*(number|no|#)?|part\s*(number|no|#)?|sku|upc|ean|asin|mfr\s*(part|#|number)?|manufacturer\s*part|item\s*(number|no|#)?)$/i;for(const h of f){const S=h.key.trim();!a.serialNumber&&A.test(S)&&(a.serialNumber=h.value.trim()),!a.modelNumber&&R.test(S)&&(a.modelNumber=h.value.trim())}const{aliasMap:F,allSpecNames:Y,specCategories:Z}=Zt(t);if(o&&o.size>0)for(const[h,{specName:S,usageCount:x}]of o){const w=X(h);if(!F.has(w)){const b=Math.min(75,55+Math.floor((x-3)*1.5));F.set(w,{specName:S,priority:b,category:null})}}const V=new Map;Y.forEach(h=>V.set(h,[]));const D=new Set;f.forEach((h,S)=>{const x=X(h.key),w=ne(x);let b=F.get(x);if(b||(b=F.get(w)),b){const k=V.get(b.specName)||[];k.push({value:h.value,confidence:b.priority,sourceKey:h.key,lineIndex:h.lineIndex}),V.set(b.specName,k),D.add(S)}});const Q=a.category,J=new Set(["Weight","Dimensions","Battery Type","Battery Life","Mount Type","Power Input","Material"]);f.forEach((h,S)=>{if(D.has(S))return;const x=X(h.key),w=ne(x),b=[];for(const k of Y){const T=X(k),U=ne(T),p=Math.max(ve(x,T),ve(w,U));if(p>=50){let $=p;const O=Z.get(k);Q&&O&&O!==Q&&!J.has(k)&&($=Math.max(0,p-25)),$>=50&&b.push({specName:k,score:$})}}for(const[k,T]of F.entries()){const U=ne(k),p=Math.max(ve(x,k),ve(w,U));if(p>=55){let $=Math.min(92,p+(T.priority-50)*.15);const O=Z.get(T.specName);Q&&O&&O!==Q&&!J.has(T.specName)&&($=Math.max(0,$-25)),$>=50&&b.push({specName:T.specName,score:$})}}if(b.length>0){const k=new Map;b.forEach(T=>{const U=k.get(T.specName);(!U||T.score>U.score)&&k.set(T.specName,T)});for(const[T,U]of k){const p=V.get(T)||[];p.push({value:h.value,confidence:Math.round(U.score),sourceKey:h.key,lineIndex:h.lineIndex}),V.set(T,p)}D.add(S)}});const G={Weight:{pattern:/[\d.]+/,max:100,unit:"kg",warn:"Weight over 100kg â€” verify value"},"Focal Length":{pattern:/[\d.]+/,max:2e3,unit:"mm",warn:"Focal length over 2000mm â€” verify value"},"Maximum Aperture":{pattern:/f?\/?(\d+\.?\d*)/,group:1,min:.7,max:64,warn:"Unusual aperture value â€” verify"},"Minimum Aperture":{pattern:/f?\/?(\d+\.?\d*)/,group:1,min:.7,max:128,warn:"Unusual aperture value â€” verify"},"Max Power Output":{pattern:/[\d.]+/,max:2e4,unit:"W",warn:"Power over 20kW â€” verify value"},"Screen Size":{pattern:/[\d.]+/,max:100,unit:"inches",warn:'Screen size over 100" â€” verify value'},"Max Height":{pattern:/[\d.]+/,max:10,unit:"m",warn:"Height over 10m â€” verify value"},"Battery Life":{pattern:/[\d.]+/,max:1e4,warn:"Unusually high battery life â€” verify value"},"ISO Range":{pattern:/[\d,]+/,checkFn:h=>{const S=parseInt(h.replace(/,/g,""));return S>0&&S<=1e7},warn:"ISO value out of expected range"}};function K(h,S){const x=G[h];if(!x)return null;const w=S.match(x.pattern);if(!w)return null;if(x.checkFn)return x.checkFn(S)?null:x.warn;const b=parseFloat(w[x.group||0]);return isNaN(b)?null:x.min!==void 0&&b<x.min||x.max!==void 0&&b>x.max?x.warn:null}for(const[h,S]of V){if(S.length===0)continue;S.sort((O,E)=>E.confidence-O.confidence);const x=new Set,w=S.filter(O=>{const E=O.value.toLowerCase().trim();return x.has(E)?!1:(x.add(E),!0)}),b=w.filter(O=>O.confidence>=85);let k=null;b.length>1&&Math.max(...b.map(E=>E.confidence))-Math.min(...b.map(E=>E.confidence))<=10&&(k={value:b.map(E=>E.value).join(", "),confidence:Math.round(b.reduce((E,te)=>E+te.confidence,0)/b.length),sourceKey:b.map(E=>E.sourceKey).join(" + "),mergedCount:b.length});let T=!1;if(!k&&w.length>1){const O=w.slice(0,2);Math.abs(O[0].confidence-O[1].confidence)<=15&&O[0].confidence>=50&&O[1].confidence>=50&&(T=!0)}const U=w.find(O=>O.confidence>=85),p=k||U||w[0],$=K(h,p.value);a.fields.set(h,{value:p.value,confidence:p.confidence,sourceKey:p.sourceKey,lineIndex:p.lineIndex,alternatives:w.length>1?w:[],...k?{mergedCount:k.mergedCount}:{},...T?{hasConflict:!0}:{},...$?{validationWarning:$}:{}})}return a.sourceLines=c,f.forEach((h,S)=>{D.has(S)||a.unmatchedPairs.push({key:h.key,value:h.value,lineIndex:h.lineIndex})}),a}const Se={in_to_mm:{pattern:/([\d.]+)\s*(?:in(?:ch(?:es)?)?|")\b/gi,factor:25.4,toUnit:"mm"},mm_to_in:{pattern:/([\d.]+)\s*mm\b/gi,factor:1/25.4,toUnit:"in"},cm_to_mm:{pattern:/([\d.]+)\s*cm\b/gi,factor:10,toUnit:"mm"},lb_to_g:{pattern:/([\d.]+)\s*(?:lbs?|pounds?)\b/gi,factor:453.592,toUnit:"g"},oz_to_g:{pattern:/([\d.]+)\s*(?:oz|ounces?)\b/gi,factor:28.3495,toUnit:"g"},kg_to_g:{pattern:/([\d.]+)\s*kg\b/gi,factor:1e3,toUnit:"g"},f_to_c:{pattern:/([\d.]+)\s*Â°?\s*F\b/gi,fn:l=>((l-32)*5/9).toFixed(0),toUnit:"Â°C"}};function Xt(l,t=!0){if(!l||typeof l!="string")return null;const o=l.match(/([\d.]+)\s*(?:lbs?|pounds?)\s+([\d.]+)\s*(?:oz|ounces?)/i);if(o){const m=parseFloat(o[1])*453.592+parseFloat(o[2])*28.3495;return m>=1e3?{original:l,normalized:`${(m/1e3).toFixed(2)} kg`,unit:"kg"}:{original:l,normalized:`${Math.round(m)} g`,unit:"g"}}const a=l.match(/([\d.]+)\s*[xÃ—]\s*([\d.]+)(?:\s*[xÃ—]\s*([\d.]+))?\s*(?:in(?:ch(?:es)?)?|")/i);if(a&&t){const m=[a[1],a[2],a[3]].filter(Boolean).map(g=>Math.round(parseFloat(g)*25.4));return{original:l,normalized:m.join(" Ã— ")+" mm",unit:"mm"}}const d=l.match(/([\d.]+)\s*[xÃ—]\s*([\d.]+)(?:\s*[xÃ—]\s*([\d.]+))?\s*mm/i);if(d&&!t){const m=[d[1],d[2],d[3]].filter(Boolean).map(g=>(parseFloat(g)/25.4).toFixed(2));return{original:l,normalized:m.join(" Ã— ")+" in",unit:"in"}}if(t)for(const m of["in_to_mm","lb_to_g","oz_to_g"]){const g=Se[m],f=l.match(g.pattern);if(f){const y=parseFloat(f[1]),M=g.fn?g.fn(y):(y*g.factor).toFixed(g.toUnit==="mm"?1:0);return{original:l,normalized:`${M} ${g.toUnit}`,unit:g.toUnit}}}else for(const m of["mm_to_in"]){const g=Se[m],f=l.match(g.pattern);if(f){const M=(parseFloat(f[1])*g.factor).toFixed(2);return{original:l,normalized:`${M} ${g.toUnit}`,unit:g.toUnit}}}const c=l.match(Se.f_to_c.pattern);if(c&&t){const m=Se.f_to_c.fn(parseFloat(c[1]));return{original:l,normalized:`${m} Â°C`,unit:"Â°C"}}return null}function Qt(l,t){if(!t||typeof t!="string")return null;const o=t.trim(),a=l.toLowerCase();if(["weather sealing","touchscreen","autofocus","image stabilization","stabilization","wireless control","airline approved","phantom power","hdr recording"].some(c=>a.includes(c)||c.includes(a))){const c=o.toLowerCase();if(/^(yes|true|included|available|built[\s-]?in|equipped|supported|âœ“|âœ”)$/i.test(c))return{original:o,coerced:"Yes"};if(/^(no|false|not included|none|n\/a|not available|not supported|âœ—|âœ˜|â€”)$/i.test(c))return{original:o,coerced:"No"}}if(a.includes("color temp")||a.includes("cct")){const c=o.match(/(\d{3,5})\s*K?\s*[-â€“â€”to]+\s*(\d{3,5})\s*K?/i);if(c)return{original:o,coerced:`${c[1]}â€“${c[2]} K`}}if(a.includes("aperture")){const c=o.match(/^(\d+\.?\d*)$/);if(c)return{original:o,coerced:`f/${c[1]}`}}return null}function tt(l,t){const o={};for(const[a,d]of l.fields){const c=t?.[a],m=c!==void 0?c:d.value;m&&m.trim()&&(o[a]=m)}if(t?._manualMappings)for(const[a,d]of Object.entries(t._manualMappings))d&&d.trim()&&!o[a]&&(o[a]=d);return{name:l.name||"",brand:l.brand||"",category:l.category||"",purchasePrice:l.purchasePrice||"",priceNote:l.priceNote||"",serialNumber:l.serialNumber||"",modelNumber:l.modelNumber||"",specs:o}}function st(l){if(!l)return[];const t=l.split(`
`),o=[];let a=0,d=null;const c=/\b(?:Sony|Canon|Nikon|Panasonic|Blackmagic|RED|ARRI|Fujifilm|Sennheiser|Rode|Shure|Aputure|Godox|DJI|Manfrotto|Atomos|SmallHD|Teradek)\b/i;for(let g=0;g<t.length;g++){const f=t[g].trim();if(!f)continue;let y=!1,M=null;if(/^[-=_]{3,}\s*$/.test(f))y=!0;else if(/^#{1,3}\s+(.+)/.test(f))y=!0,M=f.replace(/^#{1,3}\s+/,"").trim();else if(/^(?:product|item|model)\s*(?:name|#|number)?\s*[:â†’=]\s*(.+)/i.test(f)){y=!0;const u=f.match(/[:â†’=]\s*(.+)/);M=u?u[1].trim():null}else g>0&&!t[g-1]?.trim()&&c.test(f)&&f.length<120&&(y=!0,M=f);if(y&&g>a+2){const u=t.slice(a,g).join(`
`).trim();u.length>20&&o.push({startLine:a,endLine:g-1,name:d||`Product ${o.length+1}`,text:u}),a=g,d=M}else y&&!d&&(d=M)}const m=t.slice(a).join(`
`).trim();return m.length>20&&o.push({startLine:a,endLine:t.length-1,name:d||`Product ${o.length+1}`,text:m}),o.length>1?o:[]}function en(l,t,o={}){const a=st(l);return a.length===0?[{segment:{name:"Single Product",text:l},result:ke(l,t,o)}]:a.map(d=>({segment:d,result:ke(d.text,t,o)}))}async function tn(l,t){throw new Error("URL import requires a CORS proxy. Set up the fetch-product-page Edge Function and provide its URL.")}function nn(l,t){const o=[],a=new Set([...Object.keys(l||{}),...t?[...t.keys()]:[]]);for(const c of a){const m=l?.[c]||"",g=t?.get(c),f=g?.value||"",y=g?.confidence||0;!m&&f?o.push({specName:c,status:"added",oldValue:"",newValue:f,confidence:y}):m&&!f?o.push({specName:c,status:"removed",oldValue:m,newValue:"",confidence:y}):m&&f&&m.toLowerCase().trim()!==f.toLowerCase().trim()?o.push({specName:c,status:"changed",oldValue:m,newValue:f,confidence:y}):m&&f&&o.push({specName:c,status:"unchanged",oldValue:m,newValue:f,confidence:y})}const d={changed:0,added:1,unchanged:2,removed:3};return o.sort((c,m)=>(d[c.status]??99)-(d[m.status]??99)),o}async function rn(l,t,o,a){if(l)try{const{error:d}=await l.rpc("upsert_smart_paste_alias",{p_source_key:t.toLowerCase().trim(),p_spec_name:o,p_category:a||null});d&&Ne("Failed to record alias:",d.message)}catch(d){Ne("Community alias recording not available:",d.message)}}async function an(l,t=3){if(!l)return new Map;try{const{data:o,error:a}=await l.from("smart_paste_aliases").select("source_key, spec_name, usage_count").gte("usage_count",t).order("usage_count",{ascending:!1});if(a)throw a;const d=new Map;for(const c of o||[])d.set(c.source_key,{specName:c.spec_name,usageCount:c.usage_count});return d}catch(o){return Ne("Community aliases not available:",o.message),new Map}}let le=null;async function on(l,t){if(!le){t&&t(.05);try{const c=await nt(()=>import("https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.esm.min.js"),[]);t&&t(.15),le=await c.createWorker("eng",1,{logger:m=>{t&&m.status==="recognizing text"&&t(.2+m.progress*.7)}})}catch{throw new Error("Failed to load OCR engine. Check your internet connection and try again. Alternatively, paste the text manually or use a screenshot-to-text tool.")}}t&&t(.2);const o=await sn(l);t&&t(.25);const{data:a}=await le.recognize(o||l);t&&t(.95);let d=a.text||"";return d=d.replace(/[|]/g,"I").replace(/(\w)l(\w)/g,"$1I$2").replace(/\n{3,}/g,`

`).replace(/^\s+$/gm,"").trim(),t&&t(1),{text:d,confidence:a.confidence||0}}async function sn(l){try{const t=await createImageBitmap(l),o=new OffscreenCanvas(t.width,t.height),a=o.getContext("2d");a.drawImage(t,0,0);const d=a.getImageData(0,0,o.width,o.height),c=d.data;for(let m=0;m<c.length;m+=4){const g=.299*c[m]+.587*c[m+1]+.114*c[m+2],y=Math.min(255,Math.max(0,((g/255-.5)*1.5+.5)*255));c[m]=y,c[m+1]=y,c[m+2]=y}return a.putImageData(d,0,0),await o.convertToBlob({type:"image/png"})}catch{return null}}async function ln(){if(le){try{await le.terminate()}catch{}le=null}}function Re({confidence:l}){let t,o;return l>=85?(t=n.available,o="Direct"):l>=60?(t=n.accent1,o="Likely"):(t=n.textMuted,o="Fuzzy"),e.jsx("span",{style:{display:"inline-block",fontSize:10,fontWeight:600,padding:"1px 6px",borderRadius:4,background:`${z(t,20)}`,color:t,textTransform:"uppercase",letterSpacing:"0.04em",lineHeight:"16px",whiteSpace:"nowrap",flexShrink:0},children:o})}function je({label:l,value:t}){return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"80px 1fr",gap:r[2],padding:`${r[1]}px 0`,fontSize:j.fontSize.sm},children:[e.jsx("span",{style:{fontWeight:600,color:n.textPrimary},children:l}),e.jsx("span",{style:{color:t?n.textSecondary:z(n.textMuted,40),fontStyle:t?"normal":"italic"},children:t||"Not detected"})]})}function cn({specName:l,fieldData:t,selectedValue:o,onSelect:a,onClear:d,isRequired:c,onLineClick:m,unitInfo:g,coercionInfo:f}){const[y,M]=v.useState(!1),u=t&&t.alternatives&&t.alternatives.length>1,B=t?o!==void 0?o:t.value:"",W=!B;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1.6fr auto",gap:r[2],alignItems:"start",padding:`${r[2]}px 0`,borderBottom:`1px solid ${z(n.border,30)}`},children:[e.jsxs("div",{onClick:()=>m&&t?.lineIndex!=null&&m(t.lineIndex),style:{fontSize:j.fontSize.sm,fontWeight:600,color:W?z(n.textMuted,60):n.textPrimary,paddingTop:2,wordBreak:"break-word",display:"flex",alignItems:"baseline",gap:4,cursor:m&&t?.lineIndex!=null?"pointer":"default"},title:m&&t?.lineIndex!=null?"Click to view in source":void 0,children:[e.jsx("span",{children:l}),c&&e.jsx("span",{style:{color:n.danger,fontSize:10,fontWeight:700},children:"*"})]}),e.jsx("div",{style:{position:"relative"},children:W?e.jsx("span",{style:{fontSize:j.fontSize.sm,color:z(n.textMuted,40),fontStyle:"italic"},children:"â€”"}):e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r[1],flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:j.fontSize.sm,color:n.textSecondary,wordBreak:"break-word",flex:1,minWidth:0},children:B}),t.hasConflict&&!o&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:3,fontSize:10,fontWeight:600,padding:"1px 6px",borderRadius:4,background:z(n.danger,15),color:n.danger,textTransform:"uppercase",letterSpacing:"0.04em",lineHeight:"16px",whiteSpace:"nowrap",flexShrink:0},children:"âš  Conflict"}),t.mergedCount&&e.jsxs("span",{style:{display:"inline-block",fontSize:10,fontWeight:600,padding:"1px 6px",borderRadius:4,background:z(n.primary,15),color:n.primary,textTransform:"uppercase",letterSpacing:"0.04em",lineHeight:"16px",whiteSpace:"nowrap",flexShrink:0},children:["Combined Ã—",t.mergedCount]}),!t.hasConflict&&!t.mergedCount&&e.jsx(Re,{confidence:t.confidence}),t.hasConflict&&!t.mergedCount&&o&&e.jsx(Re,{confidence:t.confidence}),u&&e.jsxs("button",{onClick:()=>M(!y),style:{background:z(n.primary,10),border:`1px solid ${z(n.primary,30)}`,borderRadius:H.sm,cursor:"pointer",color:n.primary,padding:"1px 6px",display:"flex",alignItems:"center",fontSize:j.fontSize.xs,gap:3,whiteSpace:"nowrap",flexShrink:0},title:t.hasConflict?`âš  ${t.alternatives.length} conflicting values â€” click to choose`:`${t.alternatives.length} options â€” click to choose`,children:[y?e.jsx(Le,{size:10}):e.jsx(_e,{size:10}),e.jsxs("span",{children:[t.alternatives.length," ",t.hasConflict?"conflicts":"options"]})]})]}),t.validationWarning&&e.jsxs("div",{style:{fontSize:11,color:n.accent1,marginTop:2,display:"flex",alignItems:"center",gap:4},children:["âš ",e.jsx("span",{children:t.validationWarning})]}),t.sourceKey&&t.sourceKey.toLowerCase()!==l.toLowerCase()&&e.jsxs("div",{style:{fontSize:11,color:z(n.textMuted,60),marginTop:2},children:["matched from: ",e.jsx("em",{children:t.sourceKey})]}),g&&e.jsxs("div",{style:{fontSize:11,color:n.primary,marginTop:2,display:"flex",alignItems:"center",gap:4},children:["â†’",e.jsxs("span",{children:["normalized: ",e.jsx("strong",{children:g.normalized})]})]}),f&&!g&&e.jsxs("div",{style:{fontSize:11,color:z(n.primary,80),marginTop:2,display:"flex",alignItems:"center",gap:4},children:["â†’",e.jsxs("span",{children:["suggestion: ",e.jsx("strong",{children:f.coerced})]})]}),y&&u&&e.jsx("div",{style:{marginTop:r[1],background:n.bgMedium,border:`1px solid ${n.border}`,borderRadius:H.md,overflow:"hidden",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:t.alternatives.map((N,A)=>{const R=N.value===B;return e.jsxs("button",{onClick:()=>{a(l,N.value),M(!1)},style:{width:"100%",textAlign:"left",padding:`${r[2]}px ${r[2]}px`,border:"none",borderBottom:A<t.alternatives.length-1?`1px solid ${z(n.border,30)}`:"none",background:R?`${z(n.primary,15)}`:"transparent",cursor:"pointer",fontSize:j.fontSize.sm,color:n.textSecondary,display:"flex",alignItems:"center",gap:r[2]},children:[R&&e.jsx(rt,{size:12,style:{color:n.primary,flexShrink:0}}),!R&&e.jsx("span",{style:{width:12,flexShrink:0}}),e.jsx("span",{style:{flex:1,wordBreak:"break-word"},children:N.value}),e.jsx(Re,{confidence:N.confidence}),e.jsx("span",{style:{color:z(n.textMuted,60),fontSize:11,flexShrink:0,maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:N.sourceKey})]},A)})})]})}),!W&&e.jsx("button",{onClick:()=>d(l),style:{background:"none",border:"none",cursor:"pointer",color:n.textMuted,padding:2,display:"flex",alignItems:"center",marginTop:2,opacity:.6},title:"Clear this field",children:e.jsx(we,{size:12})})]})}const We=v.memo(function({specs:t,onApply:o,onClose:a,existingItem:d}){const[c,m]=v.useState(""),[g,f]=v.useState("paste"),[y,M]=v.useState(!1),[u,B]=v.useState(null),[W,N]=v.useState({}),[A,R]=v.useState(""),[F,Y]=v.useState(!1),[Z,V]=v.useState(!0),[D,Q]=v.useState("balanced"),[J,G]=v.useState({}),[K,h]=v.useState(null),[S,x]=v.useState(null),[w,b]=v.useState(!1),[k,T]=v.useState(null),[U,p]=v.useState(!0),[$,O]=v.useState(null),[E,te]=v.useState(new Set),[ie,ct]=v.useState(""),[Oe,Ae]=v.useState(!1),[ce,de]=v.useState(null),[ae,dt]=v.useState(null),[Ee,ue]=v.useState(null),qe=v.useRef(null),pe=v.useRef(null),ut=v.useRef(null),pt={strict:85,balanced:60,aggressive:50},Ce="sims_smart_paste_history",mt=5,me=v.useCallback(()=>{try{return JSON.parse(sessionStorage.getItem(Ce)||"[]")}catch{return[]}},[]),Fe=v.useCallback((i,s)=>{try{const C=me(),P={text:i.slice(0,500),fullText:i,matchedCount:s.matchedCount,name:s.name||"Unknown product",timestamp:Date.now()},L=C.filter(q=>q.text!==P.text);L.unshift(P),sessionStorage.setItem(Ce,JSON.stringify(L.slice(0,mt)))}catch{}},[me]),[Ue,gt]=v.useState(()=>{try{return JSON.parse(sessionStorage.getItem(Ce)||"[]")}catch{return[]}});v.useEffect(()=>{g==="paste"&&qe.current?.focus()},[g]),v.useEffect(()=>{let i=!1;return(async()=>{try{const s=await Je(),C=await an(s);i||dt(C)}catch{}})(),()=>{i=!0,ln()}},[]);const ge=t?[...new Set(Object.values(t).flatMap(i=>Array.isArray(i)?i.map(s=>s.name):[]))]:[],ht=t?Object.keys(t).sort():[],ze=new Set;t&&Object.values(t).forEach(i=>{Array.isArray(i)&&i.forEach(s=>{s.required&&ze.add(s.name)})});const ft=v.useCallback(i=>!t||!i||!t[i]?[]:t[i],[t]),xt=v.useCallback(()=>{if(!c.trim())return;const i=ae?{communityAliases:ae}:{};if(st(c).length>1){const L=en(c,t,i);O(L),te(new Set(L.map((q,oe)=>oe))),B(null),N({}),G({}),h(null),x(null),T(null),de(null),R(`Detected ${L.length} products`);return}O(null),de(null);const C=ke(c,t,i);B(C),N({}),G({}),h(null),x(null),T(null),R("");const P=[...C.fields.values()].filter(L=>L.value).length;Fe(c,{matchedCount:P,name:C.name}),gt(me())},[c,t,ae,Fe,me]),Ve=["png","jpg","jpeg","webp","tiff","tif","bmp"],He=v.useCallback(async i=>{const s=i.target.files?.[0];if(s){R("loading");try{let C;const P=s.name.toLowerCase().split(".").pop();if(Ve.includes(P)){ue(0),R("ocr:Running OCR â€” loading engine...");try{const q=await on(s,se=>{ue(se),se<.2?R("ocr:Loading OCR engine..."):se<.9?R(`ocr:Recognizing text... ${Math.round(se*100)}%`):R("ocr:Finishing up...")});C=q.text;const oe=q.confidence>=80?"high":q.confidence>=50?"medium":"low";R(`success:OCR complete â€” ${oe} confidence (${Math.round(q.confidence)}%), ${C.split(`
`).length} lines`)}finally{ue(null)}}else P==="pdf"?C=await Gt(s):["txt","text","csv","tsv","md","rtf"].includes(P)?C=await Ze(s):C=await Ze(s);if(!C||!C.trim()){R("error:No text content found in file");return}m(C),Ve.includes(P)||R(`success:Imported ${s.name} (${C.split(`
`).length} lines)`);const L=ke(C,t,ae?{communityAliases:ae}:{});B(L),N({}),G({}),h(null),x(null)}catch(C){Wt("File import error:",C),R(`error:${C.message||"Failed to read file"}`),ue(null)}pe.current&&(pe.current.value="")}},[t,ae]),yt=v.useCallback((i,s)=>{N(C=>({...C,[i]:s}))},[]),bt=v.useCallback(i=>{N(s=>({...s,[i]:""}))},[]),vt=v.useCallback((i,s,C)=>{if(G(P=>{const L={...P};return s?L[i]=s:delete L[i],L}),N(P=>{const L={...P._manualMappings||{}};if(s)L[s]=C;else for(const[q,oe]of Object.entries(P));return{...P,_manualMappings:L}}),s&&u?.unmatchedPairs?.[i]){const P=u.unmatchedPairs[i].key,L=S||u?.category||null;Je().then(q=>rn(q,P,s,L)).catch(()=>{})}},[u,S]),St=v.useCallback(i=>{m(i.fullText||i.text),B(null),N({}),G({}),h(null),x(null),R(`Restored: ${i.name}`)},[]),jt=v.useCallback(i=>{T(i),b(!0),setTimeout(()=>{const s=document.getElementById(`source-line-${i}`);s&&s.scrollIntoView({behavior:"smooth",block:"center"})},50)},[]),wt=v.useCallback(i=>{const s=i.clipboardData;if(s&&s.types.includes("text/html")){i.preventDefault();const C=s.getData("text/html"),P=ot(C),L=s.getData("text/plain"),q=P.split(`
`).filter(re=>re.trim()).length,oe=L.split(`
`).filter(re=>re.trim()).length,se=P.split(`
`).filter(re=>re.includes("	")).length,Nt=L.split(`
`).filter(re=>re.includes("	")).length,Ye=se>Nt||q>=oe;m(Ye?P:L),B(null),R(Ye?"HTML table structure preserved from clipboard":"")}},[]),kt=v.useCallback(()=>{if(!u)return;const i=tt(u,W);K!==null&&(i.brand=K),S!==null&&(i.category=S),o(i),a()},[u,W,K,S,o,a]),Ct=v.useCallback(()=>{if(!$)return;const i=$.filter((s,C)=>E.has(C)).map(({result:s})=>tt(s,{}));i.length>0&&(o(i.length===1?i[0]:i),a())},[$,E,o,a]),zt=v.useCallback(i=>{if(!$?.[i])return;const{result:s}=$[i];B(s),O(null),N({}),G({}),h(null),x(null),R(`Viewing: ${s.name||`Product ${i+1}`}`)},[$]),Mt=v.useCallback(async()=>{if(ie.trim()){Ae(!0),R("");try{const{text:C}=await tn(ie,null);m(C),f("paste"),R(`Fetched content from ${ie}`)}catch(i){R(`âš  ${i.message}`)}finally{Ae(!1)}}},[ie]),$t=v.useCallback(i=>{if(!u)return;const s=nn(i,u.fields);de(s)},[u]),It=pt[D]||60,he=u?new Map([...u.fields.entries()].filter(([,i])=>i.confidence>=It)):new Map,fe=he.size+Object.keys(J).length,Tt=u?u.rawExtracted.length:0,De=u?u.unmatchedPairs.length:0,Ke=u?[...he.values()].filter(i=>i.alternatives&&i.alternatives.length>1).length:0,xe=S!==null?S:u?.category,Ge=xe?ft(xe):[],ye=[],Me=new Set;if(Ge.length>0)for(const i of Ge){const s=he.get(i.name);ye.push({specName:i.name,data:s||null,isRequired:i.required||!1}),Me.add(i.name)}if(u)for(const[i,s]of he)!Me.has(i)&&s.value&&(ye.push({specName:i,data:s,isRequired:!1}),Me.add(i));const be=ye.filter(i=>{const s=W[i.specName],C=s!==void 0?s:i.data?.value;return C&&C.trim()}),$e=ye.filter(i=>{const s=W[i.specName],C=s!==void 0?s:i.data?.value;return!C||!C.trim()}),Pt=new Set([...be.map(i=>i.specName),...Object.values(J)]),Rt=ge.filter(i=>!Pt.has(i)).sort();return e.jsxs(it,{onClose:a,maxWidth:w?1200:780,children:[e.jsx(at,{title:"Smart Paste â€” Import Product Info",onClose:a}),e.jsxs("div",{style:{padding:r[4],maxHeight:"80vh",overflowY:"auto"},children:[e.jsx("p",{style:{color:n.textSecondary,fontSize:j.fontSize.sm,marginBottom:r[3],lineHeight:1.5},children:"Paste product specifications from a retailer or manufacturer page, or import a PDF/text file. The parser extracts key-value pairs and matches them against your spec fields using direct lookups, abbreviation expansion, and fuzzy matching."}),ge.length>0&&e.jsxs("div",{style:{marginBottom:r[3],padding:`${r[2]}px ${r[3]}px`,background:`${z(n.primary,5)}`,borderRadius:H.md,border:`1px solid ${z(n.primary,15)}`},children:[e.jsxs("div",{style:{fontSize:j.fontSize.xs,fontWeight:700,color:n.primary,marginBottom:r[1],textTransform:"uppercase",letterSpacing:"0.05em"},children:["Matching against ",ge.length," spec fields across all categories"]}),e.jsx("div",{style:{fontSize:j.fontSize.xs,color:n.textMuted,lineHeight:1.6,maxHeight:100,overflowY:"auto",columnCount:3,columnGap:r[3]},children:ge.map(i=>e.jsxs("div",{style:{breakInside:"avoid",opacity:ze.has(i)?1:.7},children:[ze.has(i)&&e.jsx("span",{style:{color:n.danger,marginRight:2},children:"*"}),i]},i))})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:0,borderBottom:`2px solid ${n.border}`},children:[{key:"paste",label:"Paste Text",icon:"ðŸ“‹"},{key:"file",label:"Import File",icon:"ðŸ“"},{key:"url",label:"From URL",icon:"ðŸ”—"}].map(i=>{const s=g===i.key;return e.jsxs("button",{onClick:()=>f(i.key),style:{background:"none",border:"none",borderBottom:s?`2px solid ${n.primary}`:"2px solid transparent",marginBottom:-2,padding:`${r[2]}px ${r[3]}px`,fontSize:j.fontSize.sm,fontWeight:s?700:500,color:s?n.primary:n.textMuted,cursor:"pointer",display:"flex",alignItems:"center",gap:r[1],transition:"color 0.15s, border-color 0.15s"},children:[e.jsx("span",{children:i.icon}),i.label]},i.key)})}),A&&e.jsxs("div",{style:{padding:`${r[2]}px ${r[3]}px`,marginTop:r[2],borderRadius:H.sm,fontSize:j.fontSize.sm,background:A.startsWith("error")?`${z(n.danger,10)}`:A.startsWith("success")?`${z(n.available,10)}`:`${z(n.primary,10)}`,color:A.startsWith("error")?n.danger:A.startsWith("success")?n.available:n.primary},children:[A.startsWith("loading")?"â³ Reading file...":A.startsWith("error:")?`âš  ${A.slice(6)}`:A.startsWith("success:")?`âœ“ ${A.slice(8)}`:A.startsWith("ocr:")?`ðŸ” ${A.slice(4)}`:A,Ee!==null&&e.jsx("div",{style:{marginTop:r[1],height:4,borderRadius:2,background:z(n.primary,20),overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${Math.round(Ee*100)}%`,background:n.primary,borderRadius:2,transition:"width 0.3s ease"}})})]}),g==="paste"&&e.jsxs("div",{style:{marginTop:r[2]},children:[Ue.length>0&&!c&&e.jsxs("div",{style:{marginBottom:r[2],padding:`${r[2]}px ${r[3]}px`,background:z(n.bgMedium,50),borderRadius:H.md,border:`1px solid ${z(n.border,30)}`},children:[e.jsx("div",{style:{fontSize:j.fontSize.xs,fontWeight:600,color:n.textMuted,display:"flex",alignItems:"center",gap:r[1],marginBottom:r[1]},children:"ðŸ• Recent Imports"}),Ue.map((i,s)=>e.jsxs("button",{onClick:()=>St(i),style:{display:"flex",width:"100%",textAlign:"left",padding:`${r[1]}px ${r[2]}px`,border:"none",borderRadius:H.sm,background:"transparent",cursor:"pointer",fontSize:j.fontSize.xs,color:n.textSecondary,gap:r[2],alignItems:"center"},children:[e.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.name}),e.jsxs("span",{style:{color:n.primary,fontWeight:600,flexShrink:0},children:[i.matchedCount," fields"]}),e.jsx("span",{style:{color:z(n.textMuted,50),flexShrink:0},children:new Date(i.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},s))]}),e.jsx("textarea",{ref:qe,value:c,onChange:i=>{m(i.target.value),B(null),R(""),G({})},onPaste:wt,placeholder:`Paste product specifications here...

Supported formats:
  Key: Value
  Key â†’ Value
  Key	Value  (tab-separated)
  Key = Value
  Key | Value

HTML table content is automatically cleaned.
Tip: Copy from a web page to preserve table structure.`,style:{..._.input,width:"100%",minHeight:150,fontFamily:'ui-monospace, "SF Mono", "Cascadia Code", Menlo, monospace',fontSize:j.fontSize.sm,resize:"vertical",lineHeight:1.5}})]}),g==="file"&&e.jsxs("div",{style:{marginTop:r[2]},children:[e.jsxs("div",{onDragOver:i=>{i.preventDefault(),i.stopPropagation(),M(!0)},onDragLeave:()=>M(!1),onDrop:i=>{i.preventDefault(),i.stopPropagation(),M(!1);const s=i.dataTransfer?.files?.[0];s&&He({target:{files:[s]}})},onClick:()=>pe.current?.click(),style:{border:`2px dashed ${y?n.primary:n.border}`,borderRadius:H.lg,padding:`${r[6]}px ${r[4]}px`,textAlign:"center",cursor:"pointer",background:y?z(n.primary,8):z(n.bgMedium,50),transition:"border-color 0.15s, background 0.15s"},children:[e.jsx(Be,{size:32,style:{color:y?n.primary:n.textMuted,margin:"0 auto",display:"block",marginBottom:r[2],opacity:.6}}),e.jsx("div",{style:{fontSize:j.fontSize.base,fontWeight:600,color:n.textPrimary,marginBottom:r[1]},children:"Drop a file here or click to browse"}),e.jsx("div",{style:{fontSize:j.fontSize.sm,color:n.textMuted},children:"PDF, TXT, CSV, TSV, Markdown, RTF, or Images (OCR)"})]}),e.jsx("input",{ref:pe,type:"file",accept:".pdf,.txt,.text,.csv,.tsv,.md,.rtf,.png,.jpg,.jpeg,.webp,.tiff,.tif,.bmp",onChange:He,style:{display:"none"}}),c&&e.jsxs("div",{style:{marginTop:r[2]},children:[e.jsx("div",{style:{fontSize:j.fontSize.xs,fontWeight:600,color:n.textMuted,marginBottom:r[1],textTransform:"uppercase",letterSpacing:"0.05em"},children:"Imported Content Preview"}),e.jsxs("div",{style:{..._.input,width:"100%",maxHeight:120,overflowY:"auto",fontFamily:'ui-monospace, "SF Mono", "Cascadia Code", Menlo, monospace',fontSize:j.fontSize.xs,lineHeight:1.5,whiteSpace:"pre-wrap",color:n.textMuted,padding:r[2]},children:[c.slice(0,2e3),c.length>2e3?`
...`:""]})]})]}),g==="url"&&e.jsxs("div",{style:{marginTop:r[2]},children:[e.jsx("div",{style:{fontSize:j.fontSize.xs,color:n.textMuted,marginBottom:r[2]},children:"Enter a product page URL to fetch and parse specs automatically. Supported sites include B&H, Adorama, manufacturer pages, and Amazon."}),e.jsxs("div",{style:{display:"flex",gap:r[2],alignItems:"center"},children:[e.jsx("input",{type:"url",value:ie,onChange:i=>ct(i.target.value),placeholder:"https://www.bhphotovideo.com/c/product/...",style:{..._.input,flex:1,fontSize:j.fontSize.sm,padding:`${r[2]}px ${r[3]}px`}}),e.jsx(ee,{variant:"secondary",onClick:Mt,disabled:!ie.trim()||Oe,icon:Te,children:Oe?"Fetching...":"Fetch"})]})]}),e.jsxs("div",{style:{display:"flex",gap:r[2],marginTop:r[3],marginBottom:r[3],alignItems:"center",flexWrap:"wrap"},children:[e.jsx(ee,{variant:"secondary",onClick:xt,disabled:!c.trim(),icon:Te,children:"Parse Text"}),$&&e.jsxs("span",{style:{fontSize:j.fontSize.sm,color:n.primary,fontWeight:600},children:["âŠž",$.length," products detected"]}),u&&e.jsxs("span",{style:{fontSize:j.fontSize.sm,color:n.textMuted},children:["Extracted ",e.jsx("strong",{style:{color:n.textPrimary},children:Tt})," pairs"," â†’ ",e.jsx("strong",{style:{color:n.primary},children:fe})," matched",Ke>0&&e.jsxs(e.Fragment,{children:[", ",e.jsx("strong",{style:{color:n.accent1},children:Ke})," with alternatives"]}),De>0&&e.jsxs(e.Fragment,{children:[", ",e.jsx("strong",{style:{color:n.textMuted},children:De})," unmatched"]})]})]}),u&&e.jsxs("div",{style:{display:"flex",gap:r[1],marginBottom:r[3],alignItems:"center"},children:[e.jsx("span",{style:{fontSize:j.fontSize.xs,fontWeight:600,color:n.textMuted,marginRight:r[1]},children:"Match Confidence:"}),[{key:"strict",label:"Strict",desc:"â‰¥85 â€” only high-confidence matches"},{key:"balanced",label:"Balanced",desc:"â‰¥60 â€” recommended for most input"},{key:"aggressive",label:"Aggressive",desc:"â‰¥50 â€” catch more at lower accuracy"}].map(i=>{const s=D===i.key;return e.jsx("button",{onClick:()=>Q(i.key),title:i.desc,style:{padding:`3px ${r[2]}px`,fontSize:j.fontSize.xs,fontWeight:s?700:500,border:`1px solid ${s?n.primary:z(n.border,50)}`,borderRadius:H.sm,background:s?z(n.primary,15):"transparent",color:s?n.primary:n.textMuted,cursor:"pointer",transition:"all 0.15s"},children:i.label},i.key)}),e.jsx("span",{style:{flex:1}}),e.jsx("button",{onClick:()=>p(i=>!i),title:U?"Showing metric conversions":"Unit normalization off",style:{padding:`3px ${r[2]}px`,fontSize:j.fontSize.xs,fontWeight:U?700:500,border:`1px solid ${U?n.primary:z(n.border,50)}`,borderRadius:H.sm,background:U?z(n.primary,15):"transparent",color:U?n.primary:n.textMuted,cursor:"pointer",transition:"all 0.15s",whiteSpace:"nowrap"},children:"Units"}),e.jsx("button",{onClick:()=>b(i=>!i),title:w?"Hide source text":"Show source text alongside results",style:{padding:`3px ${r[2]}px`,fontSize:j.fontSize.xs,fontWeight:w?700:500,border:`1px solid ${w?n.primary:z(n.border,50)}`,borderRadius:H.sm,background:w?z(n.primary,15):"transparent",color:w?n.primary:n.textMuted,cursor:"pointer",transition:"all 0.15s",display:"flex",alignItems:"center",gap:4,whiteSpace:"nowrap"},children:"â–¥ Source"})]}),$&&e.jsxs("div",{style:{background:n.bgLight,borderRadius:H.lg,border:`1px solid ${n.border}`,overflow:"hidden",marginBottom:r[3]},children:[e.jsxs("div",{style:{padding:`${r[2]}px ${r[3]}px`,borderBottom:`1px solid ${n.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{fontSize:j.fontSize.xs,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:n.textMuted,display:"flex",alignItems:"center",gap:r[1]},children:["âŠž Detected Products (",$.length,")"]}),e.jsxs("div",{style:{display:"flex",gap:r[1]},children:[e.jsx("button",{onClick:()=>te(new Set($.map((i,s)=>s))),style:{background:"none",border:"none",cursor:"pointer",fontSize:j.fontSize.xs,color:n.primary,fontWeight:600},children:"Select All"}),e.jsx("button",{onClick:()=>te(new Set),style:{background:"none",border:"none",cursor:"pointer",fontSize:j.fontSize.xs,color:n.textMuted},children:"Clear"})]})]}),$.map(({segment:i,result:s},C)=>{const P=E.has(C),L=[...s.fields.values()].filter(q=>q.value).length;return e.jsxs("div",{style:{padding:`${r[2]}px ${r[3]}px`,borderBottom:`1px solid ${z(n.border,30)}`,display:"flex",alignItems:"center",gap:r[2],background:P?z(n.primary,5):"transparent"},children:[e.jsx("input",{type:"checkbox",checked:P,onChange:()=>{const q=new Set(E);P?q.delete(C):q.add(C),te(q)},style:{cursor:"pointer",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:j.fontSize.sm,fontWeight:600,color:n.textPrimary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name||i.name}),e.jsxs("div",{style:{fontSize:j.fontSize.xs,color:n.textMuted},children:[s.brand&&e.jsxs("span",{children:[s.brand," Â· "]}),s.category&&e.jsxs("span",{children:[s.category," Â· "]}),e.jsxs("span",{children:[L," fields matched"]}),s.purchasePrice&&e.jsxs("span",{children:[" Â· $",s.purchasePrice]})]})]}),e.jsx("button",{onClick:()=>zt(C),title:"View & edit this product in detail",style:{background:z(n.primary,10),border:`1px solid ${z(n.primary,30)}`,borderRadius:H.sm,cursor:"pointer",color:n.primary,padding:`2px ${r[2]}px`,fontSize:j.fontSize.xs,fontWeight:600,whiteSpace:"nowrap",flexShrink:0},children:"Edit"})]},C)}),e.jsx("div",{style:{padding:`${r[2]}px ${r[3]}px`,display:"flex",justifyContent:"flex-end"},children:e.jsxs(ee,{onClick:Ct,disabled:E.size===0,children:["Import ",E.size," Product",E.size!==1?"s":""]})})]}),u&&e.jsxs("div",{style:{display:w?"grid":"block",gridTemplateColumns:w?"1fr 1fr":"1fr",gap:w?r[3]:0,marginBottom:r[3]},children:[w&&u.sourceLines&&e.jsxs("div",{ref:ut,style:{background:n.bgMedium,borderRadius:H.lg,border:`1px solid ${n.border}`,overflow:"hidden",maxHeight:600,overflowY:"auto"},children:[e.jsx("div",{style:{padding:`${r[2]}px ${r[3]}px`,borderBottom:`1px solid ${n.border}`,position:"sticky",top:0,background:n.bgMedium,zIndex:1},children:e.jsxs("div",{style:{fontSize:j.fontSize.xs,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:n.textMuted,display:"flex",alignItems:"center",gap:r[1]},children:[e.jsx(Te,{size:11}),"Source Text (",u.sourceLines.length," lines)"]})}),e.jsx("div",{style:{padding:`${r[1]}px 0`},children:u.sourceLines.map((i,s)=>{const C=[...u.fields.values()].some(q=>q.lineIndex===s),P=u.unmatchedPairs.some(q=>q.lineIndex===s),L=k===s;return e.jsx("div",{id:`source-line-${s}`,style:{padding:`1px ${r[3]}px`,fontSize:11,fontFamily:'ui-monospace, "SF Mono", "Cascadia Code", Menlo, monospace',lineHeight:1.6,whiteSpace:"pre-wrap",wordBreak:"break-word",background:L?z(n.primary,20):C?z(n.available,8):"transparent",color:C?n.textSecondary:P?n.textMuted:z(n.textMuted,40),borderLeft:L?`3px solid ${n.primary}`:C?`3px solid ${z(n.available,40)}`:P?`3px solid ${z(n.accent1,30)}`:"3px solid transparent",transition:"background 0.3s, border-color 0.3s"},children:i||"Â "},s)})})]}),e.jsxs("div",{style:{background:n.bgLight,borderRadius:H.lg,border:`1px solid ${n.border}`,overflow:"hidden",maxHeight:w?600:"none",overflowY:w?"auto":"visible"},children:[e.jsxs("div",{style:{padding:`${r[3]}px ${r[3]}px ${r[2]}px`,borderBottom:`1px solid ${n.border}`},children:[e.jsx("div",{style:{fontSize:j.fontSize.xs,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:n.textMuted,marginBottom:r[2]},children:"Basic Information"}),e.jsx(je,{label:"Name",value:u.name}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"80px 1fr",gap:r[2],padding:`${r[1]}px 0`,fontSize:j.fontSize.sm,alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:600,color:n.textPrimary},children:"Brand"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r[1]},children:[e.jsx("input",{type:"text",value:K!==null?K:u.brand||"",onChange:i=>h(i.target.value),placeholder:"Not detected â€” type to set",style:{..._.input,fontSize:j.fontSize.sm,padding:`2px ${r[2]}px`,flex:1,minWidth:0}}),K!==null&&K!==u.brand&&e.jsx("button",{onClick:()=>h(null),title:"Reset to detected",style:{background:"none",border:"none",cursor:"pointer",color:n.textMuted,padding:2,display:"flex"},children:e.jsx(we,{size:12})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"80px 1fr",gap:r[2],padding:`${r[1]}px 0`,fontSize:j.fontSize.sm,alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:600,color:n.textPrimary},children:"Category"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r[1]},children:[e.jsxs("select",{value:S!==null?S:u.category||"",onChange:i=>x(i.target.value||null),style:{..._.input,fontSize:j.fontSize.sm,padding:`2px ${r[2]}px`,flex:1,minWidth:0,cursor:"pointer",color:S||u.category?n.textSecondary:z(n.textMuted,40)},children:[e.jsx("option",{value:"",children:"Not detected"}),ht.map(i=>e.jsx("option",{value:i,children:i},i))]}),S!==null&&S!==u.category&&e.jsx("button",{onClick:()=>x(null),title:"Reset to detected",style:{background:"none",border:"none",cursor:"pointer",color:n.textMuted,padding:2,display:"flex"},children:e.jsx(we,{size:12})})]})]}),e.jsx(je,{label:"Price",value:u.purchasePrice?`$${u.purchasePrice}${u.priceNote?` (${u.priceNote})`:""}`:""}),u.modelNumber&&e.jsx(je,{label:"Model #",value:u.modelNumber}),u.serialNumber&&e.jsx(je,{label:"Serial #",value:u.serialNumber})]}),be.length>0&&e.jsxs("div",{style:{padding:`${r[3]}px`},children:[e.jsxs("div",{style:{fontSize:j.fontSize.xs,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:n.textMuted,marginBottom:r[2],display:"flex",alignItems:"center",gap:r[2]},children:[e.jsxs("span",{children:["Matched Specifications (",be.length,")"]}),e.jsx(rt,{size:12,style:{color:n.available}})]}),be.map(({specName:i,data:s,isRequired:C})=>{const P=W[i]!==void 0?W[i]:s?.value,L=U&&P?Xt(P,U):null,q=P?Qt(i,P):null;return e.jsx(cn,{specName:i,fieldData:s,selectedValue:W[i],onSelect:yt,onClear:bt,isRequired:C,onLineClick:jt,unitInfo:L,coercionInfo:q},i)})]}),$e.length>0&&e.jsxs("div",{style:{padding:`${r[2]}px ${r[3]}px`,borderTop:`1px solid ${n.border}`},children:[e.jsxs("button",{onClick:()=>V(!Z),style:{background:"none",border:"none",cursor:"pointer",color:n.textMuted,fontSize:j.fontSize.xs,display:"flex",alignItems:"center",gap:r[1],padding:`${r[1]}px 0`,fontWeight:600},children:[Z?e.jsx(Le,{size:12}):e.jsx(_e,{size:12}),$e.length," fields with no match",xe&&e.jsxs("span",{style:{fontWeight:400,marginLeft:4},children:["(",xe,")"]})]}),Z&&e.jsx("div",{style:{marginTop:r[1],fontSize:j.fontSize.xs,color:z(n.textMuted,50),lineHeight:2,columnCount:2,columnGap:r[4]},children:$e.map(({specName:i,isRequired:s})=>e.jsxs("div",{style:{breakInside:"avoid",display:"flex",gap:4},children:[e.jsx("span",{style:{opacity:.5},children:"â€”"}),e.jsx("span",{children:i}),s&&e.jsx("span",{style:{color:n.danger},children:"*"})]},i))})]}),u.unmatchedPairs.length>0&&e.jsxs("div",{style:{padding:`${r[2]}px ${r[3]}px`,borderTop:`1px solid ${n.border}`},children:[e.jsxs("button",{onClick:()=>Y(!F),style:{background:"none",border:"none",cursor:"pointer",color:n.textMuted,fontSize:j.fontSize.xs,display:"flex",alignItems:"center",gap:r[1],padding:`${r[1]}px 0`,fontWeight:600},children:[e.jsx(qt,{size:12}),F?e.jsx(Le,{size:12}):e.jsx(_e,{size:12}),u.unmatchedPairs.length," extracted but not matched",Object.keys(J).length>0&&e.jsxs("span",{style:{marginLeft:6,fontSize:10,fontWeight:600,padding:"1px 6px",borderRadius:4,background:z(n.primary,15),color:n.primary},children:[Object.keys(J).length," mapped"]})]}),F&&e.jsxs("div",{style:{marginTop:r[2],fontSize:j.fontSize.sm,color:n.textMuted,lineHeight:1.6},children:[e.jsx("div",{style:{fontSize:j.fontSize.xs,color:z(n.textMuted,60),marginBottom:r[2],fontStyle:"italic"},children:"Use the dropdowns to manually assign unmatched pairs to spec fields."}),u.unmatchedPairs.map((i,s)=>{const C=J[s];return e.jsxs("div",{style:{padding:"4px 0",display:"grid",gridTemplateColumns:"1fr 1.2fr 1fr",gap:r[2],alignItems:"center",borderBottom:`1px solid ${z(n.border,20)}`},children:[e.jsx("span",{style:{fontWeight:600,color:n.textSecondary},children:i.key}),e.jsx("span",{style:{color:z(n.textMuted,70)},children:i.value}),e.jsxs("select",{value:C||"",onChange:P=>vt(s,P.target.value,i.value),style:{..._.input,fontSize:j.fontSize.xs,padding:`2px ${r[1]}px`,color:C?n.primary:n.textMuted,cursor:"pointer"},children:[e.jsx("option",{value:"",children:"â€” Assign to field â€”"}),Rt.map(P=>e.jsx("option",{value:P,children:P},P))]})]},s)})]})]})]})]}),ce&&e.jsxs("div",{style:{background:n.bgLight,borderRadius:H.lg,border:`1px solid ${n.border}`,overflow:"hidden",marginBottom:r[3]},children:[e.jsxs("div",{style:{padding:`${r[2]}px ${r[3]}px`,borderBottom:`1px solid ${n.border}`,fontSize:j.fontSize.xs,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:n.textMuted,display:"flex",alignItems:"center",gap:r[1]},children:["â‡„ Spec Changes (",ce.filter(i=>i.status!=="unchanged").length," differences)"]}),ce.map(({specName:i,status:s,oldValue:C,newValue:P})=>{const L={changed:n.accent1,added:n.available,removed:n.danger,unchanged:z(n.textMuted,40)},q={changed:"~",added:"+",removed:"-",unchanged:"="};return s==="unchanged"?null:e.jsxs("div",{style:{padding:`${r[1]}px ${r[3]}px`,borderBottom:`1px solid ${z(n.border,20)}`,display:"grid",gridTemplateColumns:"24px 1fr 1fr",gap:r[2],fontSize:j.fontSize.xs,alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:700,color:L[s],fontFamily:"monospace",textAlign:"center"},children:q[s]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:n.textPrimary},children:i}),C&&e.jsx("div",{style:{color:s==="changed"?n.danger:n.textMuted,textDecoration:s==="changed"?"line-through":"none"},children:C})]}),e.jsx("div",{style:{color:s==="removed"?z(n.textMuted,40):n.available,fontWeight:s==="added"?600:400},children:P||"â€”"})]},i)})]}),e.jsxs("div",{style:{display:"flex",gap:r[3],justifyContent:"flex-end",alignItems:"center"},children:[d&&u&&!ce&&e.jsx("button",{onClick:()=>$t(d.specs||{}),style:{background:"none",border:`1px solid ${z(n.border,50)}`,borderRadius:H.sm,cursor:"pointer",color:n.textMuted,padding:`${r[1]}px ${r[2]}px`,fontSize:j.fontSize.xs,display:"flex",alignItems:"center",gap:4,marginRight:"auto"},title:"Compare parsed specs against existing item values",children:"â‡„ Compare with existing"}),ce&&e.jsx("button",{onClick:()=>de(null),style:{background:"none",border:"none",cursor:"pointer",color:n.textMuted,fontSize:j.fontSize.xs,marginRight:"auto"},children:"Hide diff"}),e.jsx(ee,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsxs(ee,{onClick:kt,disabled:!u||fe===0,children:["Apply ",fe>0?`${fe} Fields`:""," to Form"]})]})]})]})});We.propTypes={specs:I.object,onApply:I.func.isRequired,onClose:I.func.isRequired,existingItem:I.object};const lt=v.memo(function({isEdit:t,itemId:o,itemForm:a,setItemForm:d,specs:c,categories:m,categorySettings:g,locations:f,inventory:y,onSave:M,onClose:u,onDelete:B}){const[W,N]=v.useState(!1),[A,R]=v.useState(null),[F,Y]=v.useState(!1),{isValid:Z,getFieldError:V,validateAll:D,handleBlur:Q,previewCode:J,duplicateSerialNumber:G,categorySpecs:K,currentCategorySettings:h,flattenedLocations:S,handleChange:x,handleSpecChange:w}=Dt({isEdit:t,itemId:o,itemForm:a,setItemForm:d,specs:c,categorySettings:g,locations:f,inventory:y,categories:m}),b=v.useCallback(async p=>{if(R(null),t&&o){Y(!0);try{const{storageService:$}=await nt(async()=>{const{storageService:E}=await import("./index-TtmnPN12.js").then(te=>te.a8);return{storageService:E}},__vite__mapDeps([0,1,2,3])),O=await $.uploadFromDataUrl(p,o);x("image",O.url)}catch{x("image",p)}finally{Y(!1)}}else x("image",p)},[t,o,x]),k=()=>{D()&&M()},T=p=>{d($=>({...$,name:p.name||$.name,brand:p.brand||$.brand,category:p.category||$.category,purchasePrice:p.purchasePrice||$.purchasePrice,currentValue:p.purchasePrice||$.currentValue,specs:{...$.specs,...p.specs}}))},U=({field:p})=>{const $=V(p);return $?e.jsx("span",{style:{color:n.danger,fontSize:j.fontSize.xs,marginTop:r[1],display:"block"},children:$}):null};return e.jsxs(e.Fragment,{children:[e.jsxs(it,{onClose:u,maxWidth:600,children:[e.jsx(at,{title:t?"Edit Item":"Add Item",onClose:u}),e.jsxs("div",{style:{padding:r[4],maxHeight:"60vh",overflowY:"auto"},children:[e.jsxs("div",{style:{marginBottom:r[4]},children:[e.jsxs(ee,{variant:"secondary",onClick:()=>N(!0),style:{width:"100%",justifyContent:"center"},children:["ðŸ“‹ Smart Paste - ",t?"Update from Product Page":"Import from Product Page"]}),t&&e.jsx("p",{style:{color:n.textMuted,fontSize:j.fontSize.xs,margin:`${r[1]}px 0 0`,textAlign:"center"},children:"Paste specs to fill in missing fields or update existing ones"})]}),!t&&J&&e.jsxs("div",{style:{marginBottom:r[4],padding:r[3],background:`${z(n.primary,10)}`,borderRadius:H.md,display:"flex",alignItems:"center",gap:r[2]},children:[e.jsx(Ot,{text:J,color:n.primary}),e.jsx("span",{style:{color:n.textMuted,fontSize:j.fontSize.sm},children:"Auto-generated ID"})]}),e.jsxs("div",{style:{marginBottom:r[4]},children:[e.jsx("label",{style:_.label,children:"Image (Optional)"}),A?e.jsx(Ht,{imageSrc:A,onCropComplete:b,onCancel:()=>R(null),outputSize:600,cropShape:"square",title:"Crop item image"}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:r[3],padding:r[3],border:`1px dashed ${n.border}`,borderRadius:H.md,background:n.bgLight,opacity:F?.6:1},children:a.image?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:a.image,alt:"Item preview",style:{width:80,height:80,objectFit:"cover",borderRadius:H.md}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("p",{style:{margin:0,fontSize:j.fontSize.sm,color:n.textSecondary},children:F?"Uploading...":"Image attached"}),e.jsx("button",{onClick:()=>R(a.image),style:{background:"none",border:"none",color:n.primary,fontSize:j.fontSize.sm,cursor:"pointer",padding:0,marginTop:r[1]},children:"Resize / Crop"}),e.jsxs("button",{onClick:()=>x("image",null),style:{background:"none",border:"none",color:n.danger,fontSize:j.fontSize.sm,cursor:"pointer",padding:0,marginTop:r[1],display:"flex",alignItems:"center",gap:r[1]},children:[e.jsx(we,{size:14})," Remove image"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:80,height:80,display:"flex",alignItems:"center",justifyContent:"center",background:z(n.primary,10),borderRadius:H.md,color:n.textMuted},children:e.jsx(Be,{size:24})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",id:"item-image-upload",style:{display:"none"},onChange:p=>{const $=p.target.files?.[0];if($){if($.size>5*1024*1024||!$.type.startsWith("image/"))return;const O=new FileReader;O.onload=E=>{R(E.target.result)},O.readAsDataURL($)}p.target&&(p.target.value="")}}),e.jsxs("label",{htmlFor:"item-image-upload",style:{..._.btnSec,display:"inline-flex",cursor:"pointer",fontSize:j.fontSize.sm},children:[e.jsx(Be,{size:14,style:{marginRight:r[1]}}),"Choose Image"]}),e.jsx("p",{style:{margin:`${r[1]}px 0 0`,fontSize:j.fontSize.xs,color:n.textMuted},children:"JPG, PNG, or WebP (max 5MB)"})]})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:r[3],marginBottom:r[3]},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{..._.label,color:V("name")?n.danger:void 0},children:["Name ",e.jsx("span",{style:{color:n.danger},children:"*"})]}),e.jsx("input",{name:"name",value:a.name,onChange:p=>x("name",p.target.value),onBlur:()=>Q("name"),placeholder:"e.g., Alpha a7 IV",style:{..._.input,borderColor:V("name")?n.danger:n.border},"aria-invalid":V("name")?"true":void 0,"aria-describedby":V("name")?"name-error":void 0}),e.jsx(U,{field:"name"})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{..._.label,color:V("brand")?n.danger:void 0},children:["Brand ",e.jsx("span",{style:{color:n.danger},children:"*"})]}),e.jsx("input",{name:"brand",value:a.brand,onChange:p=>x("brand",p.target.value),onBlur:()=>Q("brand"),placeholder:"e.g., Sony",style:{..._.input,borderColor:V("brand")?n.danger:n.border},"aria-invalid":V("brand")?"true":void 0,"aria-describedby":V("brand")?"brand-error":void 0}),e.jsx(U,{field:"brand"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:r[3],marginBottom:r[3]},children:[e.jsxs("div",{children:[e.jsx("label",{style:_.label,children:"Category"}),e.jsx(Ie,{value:a.category,onChange:p=>x("category",p.target.value),options:m.map(p=>({value:p,label:p})),"aria-label":"Category"})]}),e.jsxs("div",{children:[e.jsx("label",{style:_.label,children:"Condition"}),e.jsx(Ie,{value:a.condition,onChange:p=>x("condition",p.target.value),options:Object.values(At).map(p=>({value:p,label:p})),"aria-label":"Condition"})]})]}),h.trackQuantity&&e.jsxs("div",{style:{marginBottom:r[3]},children:[e.jsx("label",{style:_.label,children:"Quantity"}),e.jsx("input",{type:"number",min:"0",value:a.quantity||1,onChange:p=>x("quantity",Math.max(0,parseInt(p.target.value)||0)),style:{..._.input,maxWidth:"150px"}})]}),h.trackReorderPoint&&e.jsxs("div",{style:{marginBottom:r[3]},children:[e.jsxs("label",{style:_.label,children:["Reorder Point",e.jsx("span",{style:{fontSize:j.fontSize.xs,color:n.textMuted,fontWeight:j.fontWeight.normal,marginLeft:r[2]},children:"(alert when quantity falls below this)"})]}),e.jsx("input",{type:"number",min:"0",value:a.reorderPoint||0,onChange:p=>x("reorderPoint",Math.max(0,parseInt(p.target.value)||0)),style:{..._.input,maxWidth:"150px"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:r[3],marginBottom:r[3]},children:[e.jsxs("div",{children:[e.jsx("label",{style:_.label,children:"Purchase Price"}),e.jsx("input",{type:"number",value:a.purchasePrice,onChange:p=>x("purchasePrice",p.target.value),placeholder:"0.00",style:_.input})]}),e.jsxs("div",{children:[e.jsx("label",{style:_.label,children:"Current Value"}),e.jsx("input",{type:"number",value:a.currentValue,onChange:p=>x("currentValue",p.target.value),placeholder:"0.00",style:_.input})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:r[3],marginBottom:r[3]},children:[e.jsxs("div",{children:[e.jsx("label",{style:_.label,children:"Location"}),S.length>0?e.jsx(Ie,{value:a.location||"",onChange:p=>x("location",p.target.value),options:[{value:"",label:"Select location..."},...S.map(p=>({value:p.fullPath,label:p.fullPath}))],"aria-label":"Location"}):e.jsx("input",{value:a.location,onChange:p=>x("location",p.target.value),placeholder:"e.g., Shelf A-1",style:_.input})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{..._.label,color:h.trackSerialNumbers&&!a.serialNumber||G?n.danger:void 0},children:["Serial Number",h.trackSerialNumbers&&e.jsx("span",{style:{color:n.danger,marginLeft:r[1]},children:"*"})]}),e.jsx("input",{value:a.serialNumber,onChange:p=>x("serialNumber",p.target.value),placeholder:h.trackSerialNumbers?"Required":"Optional",style:{..._.input,borderColor:h.trackSerialNumbers&&!a.serialNumber||G?n.danger:n.border}}),G&&e.jsxs("span",{style:{color:n.danger,fontSize:j.fontSize.xs,display:"block",marginTop:r[1]},children:['Serial number already exists on "',G.name,'" (',G.id,")"]})]})]}),e.jsxs("div",{style:{marginBottom:r[3]},children:[e.jsx("label",{style:_.label,children:"Purchase Date"}),e.jsx(Et,{value:a.purchaseDate,onChange:p=>x("purchaseDate",p.target.value),placeholder:"Select purchase date","aria-label":"Purchase date"})]}),K.length>0&&e.jsxs("div",{style:{borderTop:`1px solid ${n.borderLight}`,paddingTop:r[4],marginTop:r[4]},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:r[3]},children:[e.jsxs("h4",{style:{margin:0,fontSize:j.fontSize.sm,color:n.textMuted},children:["Specifications (",K.length," fields)"]}),e.jsxs("span",{style:{fontSize:j.fontSize.xs,color:n.textMuted},children:[K.filter(p=>p.required).length," required"]})]}),K.filter(p=>p.required).length>0&&e.jsxs("div",{style:{marginBottom:r[4]},children:[e.jsx("div",{style:{fontSize:j.fontSize.xs,color:n.primary,marginBottom:r[2],fontWeight:j.fontWeight.medium},children:"Required Fields"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:r[3]},children:K.filter(p=>p.required).map(p=>{const $=!a.specs[p.name];return e.jsxs("div",{children:[e.jsxs("label",{style:{..._.label,color:$?n.danger:void 0},children:[p.name," ",e.jsx("span",{style:{color:n.danger},children:"*"})]}),e.jsx("input",{value:a.specs[p.name]||"",onChange:O=>w(p.name,O.target.value),style:{..._.input,borderColor:$?n.danger:n.border}})]},p.name)})})]}),K.filter(p=>!p.required).length>0&&e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:j.fontSize.xs,color:n.textMuted,marginBottom:r[2]},children:"Optional Fields"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:r[3]},children:K.filter(p=>!p.required).map(p=>e.jsxs("div",{children:[e.jsx("label",{style:_.label,children:p.name}),e.jsx("input",{value:a.specs[p.name]||"",onChange:$=>w(p.name,$.target.value),style:_.input})]},p.name))})]})]})]}),e.jsxs("div",{style:{padding:r[4],borderTop:`1px solid ${n.borderLight}`,display:"flex",gap:r[3],justifyContent:"space-between",background:n.bgMedium},children:[t&&B&&o?e.jsx(ee,{variant:"secondary",danger:!0,onClick:()=>{u(),B(o)},icon:Ft,children:"Delete Item"}):e.jsx("div",{}),e.jsxs("div",{style:{display:"flex",gap:r[3]},children:[e.jsx(ee,{variant:"secondary",onClick:u,children:"Cancel"}),e.jsx(ee,{onClick:k,disabled:!Z,icon:t?Ut:Vt,children:t?"Save Changes":"Add Item"})]})]})]}),W&&e.jsx(We,{specs:c,onApply:T,onClose:()=>N(!1)})]})}),dn=I.shape({name:I.string,brand:I.string,category:I.string,condition:I.string,purchasePrice:I.oneOfType([I.string,I.number]),currentValue:I.oneOfType([I.string,I.number]),location:I.string,serialNumber:I.string,purchaseDate:I.string,quantity:I.number,reorderPoint:I.number,specs:I.object}),un=I.objectOf(I.arrayOf(I.shape({name:I.string.isRequired,required:I.bool}))),pn=I.objectOf(I.shape({trackSerialNumbers:I.bool,trackQuantity:I.bool})),mn=I.shape({id:I.string.isRequired,name:I.string.isRequired,children:I.array}),gn=I.shape({id:I.string.isRequired,name:I.string.isRequired,serialNumber:I.string});lt.propTypes={isEdit:I.bool,itemId:I.string,itemForm:dn.isRequired,setItemForm:I.func.isRequired,specs:un,categories:I.arrayOf(I.string).isRequired,categorySettings:pn,locations:I.arrayOf(mn),inventory:I.arrayOf(gn),onSave:I.func.isRequired,onClose:I.func.isRequired,onDelete:I.func};const vn=Object.freeze(Object.defineProperty({__proto__:null,ItemModal:lt,SmartPasteModal:We},Symbol.toStringTag,{value:"Module"}));export{vn as I,We as S,Dt as u};
//# sourceMappingURL=ItemModal-Dum071tY.js.map
