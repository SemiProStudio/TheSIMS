{"version":3,"mappings":"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","names":["useItemForm","isEdit","itemId","itemForm","setItemForm","specs","categorySettings","locations","inventory","categories","errors","setErrors","useState","touched","setTouched","categorySpecs","existingIds","useMemo","i","existingCodes","previewCode","generateItemCode","duplicateSerialNumber","serialLower","duplicate","item","currentCategorySettings","requiredSpecsFilled","s","spec","serialNumberValid","validation","validateItem","isValid","flattenedLocations","flattenLocations","handleChange","useCallback","field","value","prev","handleSpecChange","name","handleBlur","validateAll","allTouched","acc","key","allErrors","getFieldError","clearErrors","KNOWN_BRANDS","CATEGORY_KEYWORDS","cleanInputText","text","cleaned","_","tableContent","rows","rowRegex","rowMatch","cellRegex","cells","cellMatch","cellText","dt","dd","val","code","readTextFile","file","resolve","reject","reader","e","pdfjsLoaded","readPdfFile","script","arrayBuffer","pdf","textParts","content","lineMap","y","sortedLines","a","b","items","lineText","j","prevEnd","gap","normalize","str","ABBREVIATIONS","expandAbbreviations","w","STOP_WORDS","levenshtein","matrix","cost","similarityScore","source","target","aExp","bExp","wordsA","wordsB","exactShared","fuzzyShared","usedB","wa","exactIdx","wb","fuzzyIdx","totalShared","maxWords","overlapRatio","maxLen","ratio","COMMON_ALIASES","buildSpecAliasMap","specsConfig","aliasMap","allSpecNames","specCategories","category","specList","expanded","words","genericWords","word","existing","canonical","aliases","canonicalNorm","mapEntry","specName","alias","aliasNorm","aliasExpanded","existingExp","parseProductText","communityAliases","result","lines","l","specPatterns","noisePatterns","rawPairs","line","p","matched","pattern","match","nextLine","looksLikeLabel","looksLikeValue","hasBrand","hasProductWords","priceLabelPattern","priceFromPair","priceKeyPriority","bestPriceKeyRank","pair","keyNorm","rank","effectiveRank","valMatch","rangeMatch","singleMatch","currSymbol","currNames","textLower","nameToCheck","brand","keywords","score","keyword","serialPatterns","modelPatterns","sourceKey","usageCount","norm","priority","candidateMap","matchedPairIndices","idx","keyExp","entry","candidates","detectedCategory","sharedFields","fuzzyMatches","specNorm","specExp","adj","specCat","aliasExp","bestBySpec","m","VALUE_RANGES","v","n","validateFieldValue","rule","num","seen","deduped","c","directMatches","merged","hasConflict","topTwo","directMatch","best","validationWarning","UNIT_CONVERSIONS","normalizeUnits","preferMetric","compoundLb","grams","dimInches","dims","d","dimMm","conv","converted","fMatch","coerceFieldValue","nameLower","f","lower","cctMatch","apMatch","buildApplyPayload","parseResult","selectedValues","data","override","detectProductBoundaries","boundaries","currentStart","currentName","productNamePattern","isBoundary","detectedName","segText","lastText","parseBatchProducts","options","segments","segment","fetchProductPage","url","proxyUrl","diffSpecs","existingSpecs","newFields","diff","allKeys","oldVal","newField","newVal","confidence","statusOrder","recordAlias","supabase","error","warn","fetchCommunityAliases","minUsage","map","row","tesseractWorker","ocrImage","imageFile","onProgress","Tesseract","enhancedBlob","enhanceImageForOCR","bitmap","canvas","ctx","imageData","gray","adjusted","terminateOCR","ConfidenceBadge","color","label","colors","jsx","withOpacity","BasicInfoRow","jsxs","spacing","typography","FieldRow","fieldData","selectedValue","onSelect","onClear","isRequired","onLineClick","unitInfo","coercionInfo","isOpen","setIsOpen","hasAlts","isEmpty","borderRadius","ChevronUp","ChevronDown","alt","isSelected","Check","XIcon","SmartPasteModal","memo","onApply","onClose","existingItem","inputText","setInputText","inputMode","setInputMode","dragOver","setDragOver","setParseResult","setSelectedValues","importStatus","setImportStatus","showUnmatched","setShowUnmatched","showEmptyFields","setShowEmptyFields","confidenceMode","setConfidenceMode","manualMappings","setManualMappings","brandOverride","setBrandOverride","categoryOverride","setCategoryOverride","showSourceView","setShowSourceView","highlightedLine","setHighlightedLine","normalizeMetric","setNormalizeMetric","batchResults","setBatchResults","batchSelected","setBatchSelected","urlInput","setUrlInput","urlLoading","setUrlLoading","diffResults","setDiffResults","setCommunityAliases","ocrProgress","setOcrProgress","textareaRef","useRef","fileInputRef","sourceRef","confidenceThresholds","HISTORY_KEY","MAX_HISTORY","getPasteHistory","savePasteHistory","resultSummary","history","filtered","h","pasteHistory","setPasteHistory","useEffect","cancelled","getSupabase","allSpecFields","availableCategories","requiredFields","getCategoryFields","categoryName","handleParse","parseOpts","batch","matchCount","IMAGE_EXTENSIONS","handleFileImport","ext","ocrResult","progress","confLabel","err","logError","handleSelectValue","handleClearField","handleManualMapping","unmatchedIdx","next","mappings","handleRestoreHistory","handleHighlightLine","lineIndex","el","handlePaste","clipboardData","html","plainText","htmlLines","plainLines","htmlTabLines","plainTabLines","useHtml","handleApply","payload","handleBatchApply","selected","handleBatchSelectSingle","index","handleUrlFetch","handleDiffExisting","threshold","filteredFields","matchedCount","totalExtracted","unmatchedCount","altsCount","categorySpecFields","orderedFields","addedNames","matchedFields","emptyFields","mappedSpecNames","unmappedSpecOptions","Modal","ModalHeader","tab","isActive","styles","Upload","Button","FileText","Fragment","mode","fieldCount","isMatched","isUnmatched","isHighlighted","cat","currentVal","AlertCircle","mappedTo","status","oldValue","newValue","statusColors","statusLabels","PropTypes","ItemModal","onSave","onDelete","showSmartPaste","setShowSmartPaste","cropSrc","setCropSrc","imageUploading","setImageUploading","handleCropComplete","croppedDataUrl","storageService","__vitePreload","handleSave","handleSmartPasteApply","parsed","FieldError","Badge","ImageCropEditor","X","event","Select","CONDITION","loc","DatePicker","Trash2","Save","Plus","itemFormShape","specConfigShape","categorySettingsShape","locationShape","inventoryItemShape"],"ignoreList":[],"sources":["../../components/ItemForm.jsx","../../lib/smartPasteParser.js","../../modals/SmartPasteModal.jsx","../../modals/ItemModal.jsx"],"sourcesContent":["import { useMemo, useState, useCallback } from 'react';\nimport { generateItemCode, flattenLocations } from '../utils.js';\nimport { validateItem } from '../lib/validators.js';\n\nimport { warn } from '../lib/logger.js';\n\n// ============================================================================\n// useItemForm - Custom hook for item form validation and computed values\n// Used by both ItemModal (compact) and ItemFormPage (full page)\n// ============================================================================\n\nexport function useItemForm({\n  isEdit,\n  itemId,\n  itemForm,\n  setItemForm,\n  specs,\n  categorySettings,\n  locations,\n  inventory,\n  categories = [],\n}) {\n  // Validation errors state\n  const [errors, setErrors] = useState({});\n  const [touched, setTouched] = useState({});\n  \n  const categorySpecs = specs[itemForm.category] || [];\n  \n  // Generate item code only once per category - memoize to prevent regeneration on every render\n  const existingIds = useMemo(() => inventory.map(i => i.id), [inventory]);\n  const existingCodes = useMemo(() => inventory.map(i => i.code).filter(Boolean), [inventory]);\n  \n  const previewCode = useMemo(() => {\n    if (isEdit) return null;\n    return generateItemCode(itemForm.category, existingIds);\n  }, [isEdit, itemForm.category, existingIds]);\n  \n  // Check for duplicate serial number\n  const duplicateSerialNumber = useMemo(() => {\n    if (!itemForm.serialNumber?.trim()) return null;\n    const serialLower = itemForm.serialNumber.trim().toLowerCase();\n    const duplicate = inventory.find(item => \n      item.serialNumber?.toLowerCase() === serialLower && \n      item.id !== itemId // Exclude current item when editing\n    );\n    // Debug: log if the \"duplicate\" appears to be the item itself\n    if (duplicate && isEdit) {\n      if (import.meta.env.DEV) {\n        warn('[useItemForm] Serial duplicate check:', {\n          itemId,\n          duplicateId: duplicate.id,\n          duplicateName: duplicate.name,\n          formName: itemForm.name,\n          match: duplicate.id === itemId,\n        });\n      }\n      // Safety: if the duplicate has the same name as the form, it's the item itself\n      if (duplicate.name === itemForm.name) return null;\n    }\n    return duplicate;\n  }, [itemForm.serialNumber, itemForm.name, isEdit, inventory, itemId]);\n  \n  // Get settings for the selected category\n  const currentCategorySettings = categorySettings?.[itemForm.category] || { \n    trackQuantity: false, \n    trackSerialNumbers: true,\n    lowStockThreshold: 0 \n  };\n  \n  // Check if all required specification fields are filled\n  const requiredSpecsFilled = useMemo(() => {\n    const requiredSpecs = categorySpecs.filter(s => s.required);\n    return requiredSpecs.every(spec => itemForm.specs[spec.name]?.trim());\n  }, [categorySpecs, itemForm.specs]);\n  \n  // Check if serial number is required and filled\n  const serialNumberValid = !currentCategorySettings.trackSerialNumbers || itemForm.serialNumber?.trim();\n  \n  // Run full validation using validators.js\n  const validation = useMemo(() => {\n    return validateItem(itemForm, {\n      existingCodes,\n      editingId: itemId,\n      customCategories: categories,\n    });\n  }, [itemForm, existingCodes, itemId, categories]);\n  \n  // Combined validation (basic + validators.js)\n  const isValid = itemForm.name?.trim() && \n                  itemForm.brand?.trim() && \n                  !duplicateSerialNumber && \n                  requiredSpecsFilled &&\n                  serialNumberValid &&\n                  validation.isValid;\n\n  // Flatten locations for selector\n  const flattenedLocations = useMemo(() => {\n    if (!locations) return [];\n    return flattenLocations(locations);\n  }, [locations]);\n\n  // Change handlers with error clearing\n  const handleChange = useCallback((field, value) => {\n    setItemForm(prev => ({ ...prev, [field]: value }));\n    // Clear error when field changes\n    if (errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: null }));\n    }\n    setTouched(prev => ({ ...prev, [field]: true }));\n  }, [setItemForm, errors]);\n  \n  const handleSpecChange = useCallback((name, value) => {\n    setItemForm(prev => ({ ...prev, specs: { ...prev.specs, [name]: value } }));\n  }, [setItemForm]);\n  \n  // Validate a single field on blur\n  const handleBlur = useCallback((field) => {\n    setTouched(prev => ({ ...prev, [field]: true }));\n    // Get error from validation result\n    if (validation.errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: validation.errors[field] }));\n    }\n  }, [validation.errors]);\n  \n  // Validate all fields (call before submit)\n  const validateAll = useCallback(() => {\n    // Mark all fields as touched\n    const allTouched = Object.keys(itemForm).reduce((acc, key) => {\n      acc[key] = true;\n      return acc;\n    }, {});\n    setTouched(allTouched);\n    \n    // Set all errors from validation\n    const allErrors = { ...validation.errors };\n    \n    // Add custom errors\n    if (duplicateSerialNumber) {\n      allErrors.serialNumber = `Serial number already exists on \"${duplicateSerialNumber.name}\"`;\n    }\n    if (!requiredSpecsFilled) {\n      allErrors.specs = 'Please fill in all required specifications';\n    }\n    if (currentCategorySettings.trackSerialNumbers && !itemForm.serialNumber?.trim()) {\n      allErrors.serialNumber = 'Serial number is required for this category';\n    }\n    \n    setErrors(allErrors);\n    return Object.keys(allErrors).length === 0;\n  }, [itemForm, validation.errors, duplicateSerialNumber, requiredSpecsFilled, currentCategorySettings]);\n  \n  // Get error for a field (only show if touched)\n  const getFieldError = useCallback((field) => {\n    if (!touched[field]) return null;\n    return errors[field] || validation.errors[field] || null;\n  }, [touched, errors, validation.errors]);\n  \n  // Clear all errors\n  const clearErrors = useCallback(() => {\n    setErrors({});\n    setTouched({});\n  }, []);\n\n  return {\n    // Validation\n    isValid,\n    errors,\n    touched,\n    validation,\n    \n    // Validation helpers\n    getFieldError,\n    validateAll,\n    clearErrors,\n    handleBlur,\n    \n    // Computed values\n    previewCode,\n    duplicateSerialNumber,\n    categorySpecs,\n    currentCategorySettings,\n    flattenedLocations,\n    \n    // Handlers\n    handleChange,\n    handleSpecChange,\n  };\n}\n\nexport default useItemForm;\n","// ============================================================================\n// Smart Paste Parser Engine\n// Extracts product info from pasted text, PDF, or TXT with fuzzy matching\n// ============================================================================\n\n// Known brand names for detection\nimport { warn } from './logger.js';\n\nconst KNOWN_BRANDS = [\n  'Sony', 'Canon', 'Nikon', 'Panasonic', 'Blackmagic', 'RED', 'ARRI', 'Fujifilm', 'Fuji', 'Leica',\n  'Zeiss', 'Sigma', 'Tamron', 'Tokina', 'Rokinon', 'Samyang', 'Voigtlander',\n  'Sennheiser', 'Rode', 'Rde', 'Shure', 'Audio-Technica', 'Zoom', 'Tascam', 'Sound Devices',\n  'Aputure', 'Godox', 'Profoto', 'Broncolor', 'Litepanels', 'Kino Flo', 'Nanlite', 'Astera',\n  'DJI', 'Zhiyun', 'Manfrotto', 'Gitzo', 'Sachtler', 'Tilta', 'SmallRig', 'Wooden Camera',\n  'Atomos', 'SmallHD', 'Teradek', 'Hollyland', 'SanDisk', 'Samsung', 'Lexar', 'ProGrade',\n  'Apple', 'Blackmagic Design', 'Davinci', 'Avid', 'Neewer', 'Elgato',\n  'K-Tek', 'Rycote', 'Bubblebee', 'Lectrosonics', 'Wisycom', 'Zaxcom',\n  'Cooke', 'Angenieux', 'Fujinon', 'Schneider', 'Tiffen', 'Lee Filters', 'NiSi',\n  'Matthews', 'Avenger', 'Kupo', 'American Grip', 'Modern Studio',\n  'OConnor', 'Vinten', 'Miller', 'Cartoni', 'Libec', 'Benro', 'Peak Design',\n  'Sanken', 'DPA', 'Schoeps', 'Neumann', 'AKG', 'Beyerdynamic',\n  'Anton Bauer', 'IDX', 'Core SWX', 'Hawk-Woods', 'Bebob',\n  'Dedolight', 'Mole-Richardson', 'Quasar Science',\n  'Pelican', 'SKB', 'Nanuk', 'Porta Brace', 'Tenba', 'Think Tank',\n  'Deity', 'Tentacle Sync', 'Timecode Systems',\n];\n\n// Category keywords mapping\nconst CATEGORY_KEYWORDS = {\n  'Cameras': ['camera', 'camcorder', 'cinema camera', 'mirrorless', 'dslr', 'sensor type', 'video camera', 'digital camera'],\n  'Lenses': ['lens', 'focal length', 'aperture', 'f/', 'prime lens', 'zoom lens', 'wide angle', 'telephoto', 'anamorphic'],\n  'Lighting': ['light', 'led', 'strobe', 'flash', 'softbox', 'panel', 'fresnel', 'rgb light', 'bi-color', 'watt', 'lumen', 'fixture'],\n  'Audio': ['microphone', 'mic', 'audio', 'recorder', 'wireless system', 'lavalier', 'shotgun', 'boom pole', 'preamp', 'mixer'],\n  'Support': ['tripod', 'monopod', 'gimbal', 'stabilizer', 'fluid head', 'slider', 'dolly', 'jib', 'crane', 'rig'],\n  'Grip': ['c-stand', 'grip head', 'arm', 'clamp', 'flag', 'frame', 'silk', 'net', 'scrim', 'gobo', 'sandbag'],\n  'Accessories': ['battery', 'charger', 'cable', 'adapter', 'mount', 'cage', 'filter', 'hood', 'follow focus'],\n  'Storage': ['card', 'ssd', 'drive', 'memory card', 'cfast', 'sd card', 'storage', 'cfexpress'],\n  'Monitors': ['monitor', 'display', 'screen', 'viewfinder', 'evf', 'on-camera monitor', 'field monitor'],\n  'Power': ['v-mount', 'gold mount', 'power supply', 'battery plate', 'ac adapter', 'battery pack'],\n  'Consumables': ['tape', 'gel', 'diffusion', 'gaffer', 'expendable'],\n};\n\n\n// ============================================================================\n// Text Preprocessing\n// ============================================================================\n\n/**\n * Clean HTML artifacts, table structures, and non-text elements from pasted text.\n * Converts table rows to \"key\\tvalue\" lines for downstream parsing.\n */\nexport function cleanInputText(text) {\n  if (!text || typeof text !== 'string') return '';\n\n  let cleaned = text;\n\n  // ---- Remove non-text elements entirely ----\n  cleaned = cleaned.replace(/<img[^>]*\\/?>/gi, '');\n  cleaned = cleaned.replace(/<svg[\\s\\S]*?<\\/svg>/gi, '');\n  cleaned = cleaned.replace(/<(?:picture|video|audio|iframe|canvas|object|embed)[^>]*(?:\\/>|>[\\s\\S]*?<\\/(?:picture|video|audio|iframe|canvas|object|embed)>)/gi, '');\n  cleaned = cleaned.replace(/<(?:script|style|noscript)[\\s\\S]*?<\\/(?:script|style|noscript)>/gi, '');\n  cleaned = cleaned.replace(/<!--[\\s\\S]*?-->/g, '');\n  // Remove nav, footer, form, button blocks\n  cleaned = cleaned.replace(/<(?:button|nav|footer|form)[^>]*>[\\s\\S]*?<\\/(?:button|nav|footer|form)>/gi, '');\n\n  // ---- Convert table structures to key\\tvalue lines ----\n  cleaned = cleaned.replace(/<table[^>]*>([\\s\\S]*?)<\\/table>/gi, (_, tableContent) => {\n    const rows = [];\n    const rowRegex = /<tr[^>]*>([\\s\\S]*?)<\\/tr>/gi;\n    let rowMatch;\n    while ((rowMatch = rowRegex.exec(tableContent)) !== null) {\n      const cellRegex = /<t[dh][^>]*>([\\s\\S]*?)<\\/t[dh]>/gi;\n      const cells = [];\n      let cellMatch;\n      while ((cellMatch = cellRegex.exec(rowMatch[1])) !== null) {\n        const cellText = cellMatch[1].replace(/<[^>]+>/g, '').replace(/\\s+/g, ' ').trim();\n        if (cellText) cells.push(cellText);\n      }\n      if (cells.length >= 2) {\n        rows.push(cells[0] + '\\t' + cells.slice(1).join(', '));\n      } else if (cells.length === 1) {\n        rows.push(cells[0]);\n      }\n    }\n    return rows.join('\\n');\n  });\n\n  // ---- Convert remaining block-level elements ----\n  cleaned = cleaned.replace(/<br\\s*\\/?>/gi, '\\n');\n  cleaned = cleaned.replace(/<hr\\s*\\/?>/gi, '\\n');\n  cleaned = cleaned.replace(/<\\/(?:p|div|tr|li|h[1-6]|dt|dd|section|article|header|blockquote)>/gi, '\\n');\n\n  // <dt>...<dd>  \"term\\tvalue\" (definition lists)\n  cleaned = cleaned.replace(/<dt[^>]*>([\\s\\S]*?)<\\/dt>\\s*<dd[^>]*>([\\s\\S]*?)<\\/dd>/gi, (_, dt, dd) => {\n    const key = dt.replace(/<[^>]+>/g, '').trim();\n    const val = dd.replace(/<[^>]+>/g, '').trim();\n    return key + '\\t' + val + '\\n';\n  });\n\n  cleaned = cleaned.replace(/<\\/t[dh]>\\s*<t[dh][^>]*>/gi, '\\t');\n  cleaned = cleaned.replace(/<\\/tr>\\s*/gi, '\\n');\n\n  // ---- Strip all remaining HTML tags ----\n  cleaned = cleaned.replace(/<[^>]+>/g, '');\n\n  // ---- Decode HTML entities ----\n  cleaned = cleaned.replace(/&amp;/g, '&');\n  cleaned = cleaned.replace(/&lt;/g, '<');\n  cleaned = cleaned.replace(/&gt;/g, '>');\n  cleaned = cleaned.replace(/&quot;/g, '\"');\n  cleaned = cleaned.replace(/&#39;/g, \"'\");\n  cleaned = cleaned.replace(/&nbsp;/g, ' ');\n  cleaned = cleaned.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(Number(code)));\n  cleaned = cleaned.replace(/&[a-zA-Z]+;/g, ' ');\n\n  // ---- Normalize whitespace ----\n  cleaned = cleaned.replace(/\\t+/g, '\\t');\n  cleaned = cleaned.replace(/[ \\t]*\\n[ \\t]*/g, '\\n');\n  cleaned = cleaned.replace(/\\n{3,}/g, '\\n\\n');\n  cleaned = cleaned.replace(/^\\s+|\\s+$/g, '');\n\n  return cleaned;\n}\n\n/**\n * Read a text file and return its contents\n */\nexport function readTextFile(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = (e) => resolve(e.target.result);\n    reader.onerror = () => reject(new Error('Failed to read file'));\n    reader.readAsText(file);\n  });\n}\n\n/**\n * Read a PDF file and extract text using pdf.js.\n */\nlet pdfjsLoaded = false;\nexport async function readPdfFile(file) {\n  if (!pdfjsLoaded && !window.pdfjsLib) {\n    await new Promise((resolve, reject) => {\n      const script = document.createElement('script');\n      script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';\n      script.onload = () => {\n        window.pdfjsLib.GlobalWorkerOptions.workerSrc =\n          'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';\n        pdfjsLoaded = true;\n        resolve();\n      };\n      script.onerror = () => reject(new Error('Failed to load PDF.js library'));\n      document.head.appendChild(script);\n    });\n  }\n\n  const arrayBuffer = await file.arrayBuffer();\n  const pdf = await window.pdfjsLib.getDocument({ data: arrayBuffer }).promise;\n  const textParts = [];\n\n  for (let i = 1; i <= pdf.numPages; i++) {\n    const page = await pdf.getPage(i);\n    const content = await page.getTextContent();\n\n    const lineMap = new Map();\n    for (const item of content.items) {\n      if (!item.str || !item.str.trim()) continue;\n      const y = Math.round(item.transform[5] / 3) * 3;\n      if (!lineMap.has(y)) lineMap.set(y, []);\n      lineMap.get(y).push({ x: item.transform[4], text: item.str, width: item.width || 0 });\n    }\n\n    const sortedLines = [...lineMap.entries()].sort((a, b) => b[0] - a[0]);\n\n    for (const [, items] of sortedLines) {\n      items.sort((a, b) => a.x - b.x);\n\n      let lineText = items[0].text;\n      for (let j = 1; j < items.length; j++) {\n        const prevEnd = items[j - 1].x + (items[j - 1].width || items[j - 1].text.length * 5);\n        const gap = items[j].x - prevEnd;\n        lineText += (gap > 30 ? '\\t' : ' ') + items[j].text;\n      }\n      textParts.push(lineText.trim());\n    }\n\n    if (i < pdf.numPages) textParts.push('');\n  }\n\n  return textParts.join('\\n');\n}\n\n\n// ============================================================================\n// Fuzzy Matching Engine\n// ============================================================================\n\nfunction normalize(str) {\n  return str.toLowerCase()\n    .replace(/[-]/g, ' ')\n    .replace(/[()[\\]{}]/g, '')\n    .replace(/[^a-z0-9\\s/%.]/g, '')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\nconst ABBREVIATIONS = {\n  'freq': 'frequency', 'temp': 'temperature', 'max': 'maximum', 'min': 'minimum',\n  'mic': 'microphone', 'res': 'resolution', 'conn': 'connector', 'dim': 'dimensions',\n  'wt': 'weight', 'bat': 'battery', 'batt': 'battery', 'vol': 'voltage',\n  'pwr': 'power', 'cap': 'capacity', 'compat': 'compatibility',\n  'stab': 'stabilization', 'adj': 'adjustment', 'diam': 'diameter',\n  'ht': 'height', 'len': 'length', 'sens': 'sensitivity', 'imp': 'impedance',\n  'approx': 'approximate', 'incl': 'included', 'info': 'information',\n  'spec': 'specification', 'specs': 'specifications', 'num': 'number',\n  'qty': 'quantity', 'ext': 'extended', 'dia': 'diameter', 'opt': 'optical',\n  'mech': 'mechanical', 'elec': 'electronic', 'def': 'definition',\n  'vid': 'video', 'aud': 'audio', 'rec': 'recording', 'cont': 'continuous',\n  'std': 'standard',\n};\n\nfunction expandAbbreviations(str) {\n  return str.split(' ').map(w => ABBREVIATIONS[w] || w).join(' ');\n}\n\nconst STOP_WORDS = new Set([\n  'type', 'size', 'rate', 'range', 'mode', 'with', 'from', 'for', 'the', 'and',\n  'max', 'min', 'output', 'input', 'total', 'number', 'system', 'included',\n  'support', 'supported', 'compatible', 'maximum', 'minimum', 'speed', 'level',\n  'control', 'depth', 'life', 'time', 'capacity', 'power', 'count', 'body',\n  'recording', 'card', 'cable', 'mount', 'class', 'general', 'specification',\n  'specifications', 'key', 'features', 'feature', 'details', 'detail', 'info',\n  'information', 'other', 'additional', 'about', 'product', 'item',\n]);\n\nfunction levenshtein(a, b) {\n  if (a.length === 0) return b.length;\n  if (b.length === 0) return a.length;\n  const matrix = [];\n  for (let i = 0; i <= a.length; i++) matrix[i] = [i];\n  for (let j = 0; j <= b.length; j++) matrix[0][j] = j;\n  for (let i = 1; i <= a.length; i++) {\n    for (let j = 1; j <= b.length; j++) {\n      const cost = a[i - 1] === b[j - 1] ? 0 : 1;\n      matrix[i][j] = Math.min(\n        matrix[i - 1][j] + 1,\n        matrix[i][j - 1] + 1,\n        matrix[i - 1][j - 1] + cost,\n      );\n    }\n  }\n  return matrix[a.length][b.length];\n}\n\n/**\n * Calculate similarity score between two strings (0-100).\n */\nfunction similarityScore(source, target) {\n  const a = normalize(source);\n  const b = normalize(target);\n  if (!a || !b) return 0;\n  if (a === b) return 100;\n\n  const aExp = expandAbbreviations(a);\n  const bExp = expandAbbreviations(b);\n  if (aExp === bExp) return 97;\n\n  // One contains the other fully\n  if (bExp.length >= 4 && aExp.includes(bExp) && bExp.length / aExp.length > 0.4) {\n    return 85 + Math.min(10, (bExp.length / aExp.length) * 10);\n  }\n  if (aExp.length >= 4 && bExp.includes(aExp) && aExp.length / bExp.length > 0.4) {\n    return 80 + Math.min(10, (aExp.length / bExp.length) * 10);\n  }\n\n  // Token-level overlap\n  const wordsA = aExp.split(' ').filter(w => w.length > 2 && !STOP_WORDS.has(w));\n  const wordsB = bExp.split(' ').filter(w => w.length > 2 && !STOP_WORDS.has(w));\n\n  if (wordsA.length > 0 && wordsB.length > 0) {\n    let exactShared = 0;\n    let fuzzyShared = 0;\n    const usedB = new Set();\n\n    for (const wa of wordsA) {\n      const exactIdx = wordsB.findIndex((wb, i) => !usedB.has(i) && wb === wa);\n      if (exactIdx !== -1) {\n        exactShared++;\n        usedB.add(exactIdx);\n        continue;\n      }\n      if (wa.length >= 5) {\n        const fuzzyIdx = wordsB.findIndex((wb, i) =>\n          !usedB.has(i) && wb.length >= 5 && levenshtein(wa, wb) <= 1\n        );\n        if (fuzzyIdx !== -1) {\n          fuzzyShared++;\n          usedB.add(fuzzyIdx);\n        }\n      }\n    }\n\n    const totalShared = exactShared + fuzzyShared * 0.8;\n    const maxWords = Math.max(wordsA.length, wordsB.length);\n    const overlapRatio = totalShared / maxWords;\n\n    if (overlapRatio >= 0.5) {\n      return Math.round(50 + overlapRatio * 35 + (exactShared > fuzzyShared ? 5 : 0));\n    }\n\n    if (exactShared === 1 && wordsA.find(w => wordsB.includes(w) && w.length >= 7)) return 55;\n    if (exactShared === 1 && wordsA.find(w => wordsB.includes(w) && w.length >= 5)) return 50;\n  }\n\n  // Levenshtein on full short strings\n  if (aExp.length <= 20 && bExp.length <= 20) {\n    const maxLen = Math.max(aExp.length, bExp.length);\n    const dist = levenshtein(aExp, bExp);\n    const ratio = 1 - dist / maxLen;\n    if (ratio >= 0.7) return Math.round(40 + ratio * 20);\n  }\n\n  return 0;\n}\n\n\n// ============================================================================\n// Build Spec Alias Map\n// ============================================================================\n\nconst COMMON_ALIASES = {\n  'sensor type': ['sensor', 'image sensor', 'sensor specification'],\n  'sensor size': ['format', 'image circle', 'coverage', 'sensor format'],\n  'effective pixels': ['megapixels', 'mp', 'resolution', 'pixel count', 'total pixels', 'image resolution'],\n  'video resolution': ['video', 'video recording', 'movie recording', 'max video', '4k', '8k', 'video capability', 'recording resolution'],\n  'frame rates': ['frame rate', 'fps', 'recording fps'],\n  'mount type': ['lens mount', 'camera mount', 'bayonet'],\n  'lens mount': ['mount', 'camera mount', 'mount type', 'bayonet mount'],\n  'focal length': ['zoom range', 'focal range', 'fl'],\n  'maximum aperture': ['max aperture', 'aperture', 'f-stop', 'fastest aperture', 'widest aperture', 'speed', 'wide open'],\n  'minimum aperture': ['min aperture', 'smallest aperture'],\n  'light type': ['lamp type', 'bulb type', 'light source', 'emitter type'],\n  'max power output': ['power output', 'output power', 'wattage', 'watts', 'max power', 'power'],\n  'color temperature': ['color temp', 'cct', 'kelvin', 'white balance'],\n  'cct range': ['color temperature range', 'temp range', 'kelvin range'],\n  'microphone type': ['mic type', 'transducer', 'capsule type'],\n  'transducer type': ['capsule', 'element type'],\n  'polar pattern': ['pickup pattern', 'pattern', 'directivity', 'directionality'],\n  'frequency response': ['freq response', 'frequency range', 'bandwidth'],\n  'output connector': ['connector', 'connection', 'connector type', 'output type'],\n  'max payload': ['payload', 'payload capacity', 'max load', 'load capacity', 'maximum payload'],\n  'capacity': ['storage capacity', 'total capacity', 'storage size'],\n  'compatibility': ['compatible with', 'works with', 'supported devices'],\n  'weight': ['body weight', 'total weight', 'net weight', 'unit weight', 'approx weight'],\n  'dimensions': ['size', 'body size', 'measurements', 'lxwxh', 'exterior dimensions', 'overall dimensions', 'wxhxd'],\n  'iso range': ['iso', 'iso sensitivity', 'iso speed', 'native iso'],\n  'af system': ['autofocus', 'autofocus system', 'focus system', 'af type'],\n  'af points': ['focus points', 'autofocus points', 'af coverage'],\n  'stabilization': ['image stabilization', 'ibis', 'ois', 'vr', 'is', 'steady shot', 'sensor shift'],\n  'wireless connectivity': ['wifi', 'wi-fi', 'bluetooth', 'wireless', 'nfc'],\n  'battery life': ['shots per charge', 'battery duration', 'runtime'],\n  'battery type': ['battery', 'power source', 'battery model'],\n  'weather sealing': ['weather sealed', 'dust proof', 'moisture resistant', 'environmental sealing', 'splash proof'],\n  'screen size': ['display size', 'lcd size', 'monitor size'],\n  'panel type': ['display type', 'lcd type', 'screen type'],\n  'brightness': ['luminance', 'nits', 'cd/m2', 'max brightness'],\n  'read speed': ['max read', 'sequential read', 'read rate'],\n  'write speed': ['max write', 'sequential write', 'write rate'],\n  'image stabilization': ['stabilization', 'ois', 'lens stabilization', 'vr', 'is', 'optical stabilization'],\n  'filter thread': ['filter size', 'front filter', 'front thread'],\n  'self-noise': ['self noise', 'equivalent noise', 'noise level', 'noise floor'],\n  'sensitivity': ['mic sensitivity', 'output level'],\n  'max spl': ['maximum spl', 'max sound pressure', 'clipping level'],\n  'cri': ['color rendering', 'color rendering index', 'ra'],\n  'tlci': ['television lighting consistency', 'television lighting consistency index'],\n  'beam angle': ['beam spread', 'coverage angle', 'field angle'],\n  'power draw': ['power consumption', 'wattage', 'max draw', 'current draw'],\n  'voltage': ['nominal voltage', 'output voltage', 'operating voltage'],\n  'charge time': ['charging time', 'recharge time', 'full charge'],\n  'head type': ['fluid head', 'head style', 'pan tilt head'],\n  'max height': ['maximum height', 'extended height', 'full height'],\n  'leg sections': ['sections', 'number of sections'],\n  'support type': ['tripod type', 'stand type'],\n  'min height': ['minimum height', 'lowest height'],\n  'continuous shooting': ['burst rate', 'drive speed', 'continuous drive'],\n  'shutter speed range': ['shutter speed', 'shutter range', 'mechanical shutter'],\n  'lcd screen': ['lcd', 'rear display', 'rear screen'],\n  'viewfinder type': ['evf', 'viewfinder', 'ovf', 'electronic viewfinder'],\n  'memory card slots': ['card slots', 'media slots', 'memory slots'],\n  'card types supported': ['supported cards', 'media type', 'compatible cards', 'card type'],\n  'video output': ['hdmi output', 'video out', 'hdmi', 'sdi'],\n  'audio input': ['mic input', 'audio in', 'microphone input', 'xlr input'],\n  'optical design': ['lens construction', 'elements/groups', 'optical formula', 'lens design'],\n  'diaphragm blades': ['aperture blades', 'iris blades', 'number of blades'],\n  'minimum focus distance': ['mfd', 'close focus', 'closest focus', 'near limit', 'closest focusing distance'],\n  'maximum magnification': ['max magnification', 'magnification ratio', 'reproduction ratio'],\n  'autofocus': ['af', 'auto focus', 'focus motor'],\n  'luminous flux (lm)': ['lumens', 'lumen output', 'lm', 'total output'],\n  'illuminance (lux)': ['lux', 'lux output', 'lux at 1m'],\n  'modifier mount': ['bowens mount', 'light modifier', 'accessory mount'],\n  'wireless control': ['app control', 'remote control', 'bluetooth control'],\n  'signal-to-noise ratio': ['snr', 's/n ratio', 'signal to noise'],\n  'dynamic range': ['dr'],\n  'phantom power': ['48v', 'phantom', 'p48'],\n  'wireless frequency': ['frequency band', 'rf frequency', 'wireless band'],\n  'wireless range': ['operating range', 'transmission range', 'rf range'],\n  'capacity (wh)': ['watt hours', 'wh', 'energy capacity'],\n  'capacity (mah)': ['mah', 'milliamp hours', 'amp hours'],\n  'angle of view': ['aov', 'field of view', 'fov'],\n  'af motor type': ['focus motor', 'af drive', 'af motor'],\n  'lens format coverage': ['coverage', 'image circle', 'format coverage', 'sensor coverage'],\n  'video format': ['codec', 'recording format', 'compression', 'video codec'],\n  'bit depth': ['color depth', 'color bit depth'],\n  'chroma subsampling': ['chroma', 'color subsampling', 'subsampling'],\n  'hdr recording': ['hdr', 'hdr video', 'hlg', 'high dynamic range'],\n  'af detection': ['af subject detection', 'subject tracking', 'eye af', 'face detection'],\n  'viewfinder coverage': ['evf coverage', 'viewfinder magnification'],\n  'body material': ['construction', 'chassis', 'body construction', 'housing'],\n  'image processor': ['processor', 'engine', 'image engine', 'processing engine'],\n  'cooling system': ['fan', 'cooling', 'active cooling', 'heat dissipation'],\n  'storage type': ['media type', 'drive type', 'interface type'],\n  'interface': ['connection type', 'bus type'],\n  'form factor': ['card size', 'physical size'],\n  'video speed class': ['v class', 'video class'],\n  'aspect ratio': ['display ratio', 'screen ratio'],\n  'contrast ratio': ['contrast', 'static contrast'],\n  'color gamut': ['gamut', 'color space', 'rec 709', 'dci p3'],\n  'touchscreen': ['touch', 'touch input', 'touch display'],\n  'focus assist': ['peaking', 'focus peaking', 'punch in'],\n  'chemistry': ['cell chemistry', 'cell type', 'battery chemistry'],\n  'max discharge': ['continuous draw', 'max current', 'peak current'],\n  'protection circuits': ['bms', 'protection', 'overcharge protection', 'safety features'],\n  'airline approved': ['flight safe', 'airline safe', 'faa approved'],\n  'grip type': ['stand type', 'clamp type', 'holder type'],\n  'primary use': ['application', 'intended use', 'use case'],\n  'material': ['build material', 'construction material'],\n};\n\nexport function buildSpecAliasMap(specsConfig) {\n  const aliasMap = new Map();\n  const allSpecNames = new Set();\n  const specCategories = new Map();\n\n  if (!specsConfig) return { aliasMap, allSpecNames: [...allSpecNames], specCategories };\n\n  Object.entries(specsConfig).forEach(([category, specList]) => {\n    if (!Array.isArray(specList)) return;\n    specList.forEach(spec => {\n      if (!spec.name) return;\n      const name = spec.name;\n      allSpecNames.add(name);\n      specCategories.set(name, category);\n\n      // Exact name  highest priority\n      aliasMap.set(normalize(name), { specName: name, priority: 100, category });\n\n      // Expanded abbreviations form\n      const expanded = expandAbbreviations(normalize(name));\n      if (expanded !== normalize(name)) {\n        aliasMap.set(expanded, { specName: name, priority: 98, category });\n      }\n\n      // Individual specific long words from multi-word spec names\n      const words = normalize(name).split(' ');\n      if (words.length > 1) {\n        const genericWords = new Set([\n          'type', 'size', 'rate', 'range', 'mode', 'with', 'from', 'output', 'input',\n          'total', 'number', 'system', 'included', 'support', 'supported', 'compatible',\n          'maximum', 'minimum', 'speed', 'level', 'control', 'depth', 'life', 'time',\n          'capacity', 'power', 'count', 'body', 'recording', 'card', 'cable', 'mount',\n          'class', 'ratio', 'material', 'format', 'angle', 'length', 'height', 'weight',\n          'draw', 'plate', 'points', 'slots', 'display', 'assist', 'color', 'load',\n          'adjustment', 'rotation', 'position', 'noise', 'temp',\n        ]);\n        words.forEach(word => {\n          if (word.length >= 5 && !genericWords.has(word)) {\n            const existing = aliasMap.get(word);\n            if (!existing || existing.priority < 40) {\n              aliasMap.set(word, { specName: name, priority: 40, category });\n            }\n          }\n        });\n      }\n    });\n  });\n\n  // Register common aliases\n  Object.entries(COMMON_ALIASES).forEach(([canonical, aliases]) => {\n    const canonicalNorm = normalize(canonical);\n    const mapEntry = aliasMap.get(canonicalNorm);\n    const specName = mapEntry ? mapEntry.specName : null;\n    const category = mapEntry ? mapEntry.category : null;\n    if (!specName) return;\n\n    aliases.forEach(alias => {\n      const aliasNorm = normalize(alias);\n      const existing = aliasMap.get(aliasNorm);\n      if (!existing || existing.priority < 80) {\n        aliasMap.set(aliasNorm, { specName, priority: 80, category });\n      }\n      const aliasExpanded = expandAbbreviations(aliasNorm);\n      if (aliasExpanded !== aliasNorm) {\n        const existingExp = aliasMap.get(aliasExpanded);\n        if (!existingExp || existingExp.priority < 78) {\n          aliasMap.set(aliasExpanded, { specName, priority: 78, category });\n        }\n      }\n    });\n  });\n\n  return { aliasMap, allSpecNames: [...allSpecNames], specCategories };\n}\n\n\n// ============================================================================\n// Main Parser\n// ============================================================================\n\nexport function parseProductText(text, specsConfig, { communityAliases } = {}) {\n  const result = {\n    name: '',\n    brand: '',\n    category: '',\n    purchasePrice: '',\n    priceNote: '',\n    serialNumber: '',\n    modelNumber: '',\n    fields: new Map(),\n    unmatchedPairs: [],\n    rawExtracted: [],\n  };\n\n  if (!text || typeof text !== 'string') return result;\n\n  const cleaned = cleanInputText(text);\n  const lines = cleaned.split('\\n').map(l => l.trim()).filter(l => l);\n\n  const specPatterns = [\n    /^([^\\t]{2,60})\\t+(.+)$/,              // Key\\tValue (table-derived)\n    /^([^:]{2,60}):\\s+(.+)$/,              // Key: Value\n    /^([^|]{2,60})\\s*\\|\\s*(.+)$/,          // Key | Value\n    /^([^=]{2,60})\\s*=\\s*(.+)$/,           // Key = Value\n    /^([^]{2,40})\\s*\\s*(.{2,})$/,        // Key  Value\n    /^([^-]{2,40})\\s+[-]\\s+(.{2,})$/,    // Key - Value\n  ];\n\n  const noisePatterns = [\n    /^(home|shop|cart|login|sign in|sign up|sign out|menu|search|filter by|sort by|subscribe|newsletter|cookie|accept|privacy|terms|copyright||all rights)/i,\n    /^(add to|buy now|add to cart|in stock|out of stock|free shipping|see more|learn more|read more|show more|view all|close|back to|next|prev)/i,\n    /^(share|tweet|pin it|email this|print|save for|wishlist|compare|reviews?\\s*\\(|rating|stars?|^\\d+ customer)/i,\n    /^\\d+(\\.\\d+)?$/,\n    /^[A-Z0-9]{3,}$/,\n    /^\\[.*\\]$/,\n  ];\n\n  // -----------------------------------------------------------------------\n  // 1. Extract raw key-value pairs\n  // -----------------------------------------------------------------------\n  const rawPairs = [];\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    if (line.length < 3 || line.length > 300) continue;\n    if (noisePatterns.some(p => p.test(line))) continue;\n\n    let matched = false;\n    for (const pattern of specPatterns) {\n      const match = line.match(pattern);\n      if (match) {\n        let [, key, value] = match;\n        key = key.trim();\n        value = value.trim();\n        if (value.startsWith('http') || value.length > 200 || value.length < 1) continue;\n        if (key.length < 2) continue;\n        rawPairs.push({ key, value, sourceLine: line, lineIndex: i });\n        matched = true;\n        break;\n      }\n    }\n\n    // Consecutive-line detection: \"Label\" then \"Value\" on next line\n    if (!matched && i + 1 < lines.length) {\n      const nextLine = lines[i + 1]?.trim();\n      const looksLikeLabel = line.length >= 3 && line.length <= 50\n        && !/^\\d/.test(line)\n        && !/[:|\\t=]/.test(line)\n        && /^[A-Za-z]/.test(line);\n      const looksLikeValue = nextLine && nextLine.length >= 1 && nextLine.length <= 150\n        && (/^\\d/.test(nextLine)\n          || /\\b(mm|cm|m|kg|g|lbs|oz|W|V|Wh|mAh|Hz|kHz|dB|lux|lm|cd||fps|bit|yes|no|true|false|approx)\\b/i.test(nextLine)\n          || /^(f\\/|[A-Z]{2,4}[\\s-])/i.test(nextLine));\n\n      if (looksLikeLabel && looksLikeValue) {\n        rawPairs.push({ key: line, value: nextLine, sourceLine: `${line}  ${nextLine}`, lineIndex: i });\n        i++;\n        matched = true;\n      }\n    }\n\n    // Product name detection\n    if (!matched && !result.name && line.length > 5 && line.length < 120) {\n      const hasBrand = KNOWN_BRANDS.some(b => line.toLowerCase().includes(b.toLowerCase()));\n      const hasProductWords = /\\b(camera|lens|light|mic|microphone|tripod|monitor|recorder|flash|strobe|gimbal|stabilizer|wireless|transmitter|receiver|boom|shotgun|panel|fixture|battery|card)\\b/i.test(line);\n      if (hasBrand || hasProductWords) {\n        result.name = line;\n      }\n    }\n  }\n\n  result.rawExtracted = rawPairs.map(p => ({ key: p.key, value: p.value, lineIndex: p.lineIndex, sourceLine: p.sourceLine }));\n\n  // -----------------------------------------------------------------------\n  // 2. Extract price (improved: multi-currency, ranges, labeled prices)\n  // -----------------------------------------------------------------------\n  // First, check if any raw pair has a price-like key\n  const priceLabelPattern = /^(sale\\s*price|price|msrp|list\\s*price|rrp|retail\\s*price|srp|map\\s*price|street\\s*price)$/i;\n  let priceFromPair = null;\n  const priceKeyPriority = ['sale price', 'street price', 'map price', 'price', 'msrp', 'list price', 'rrp', 'retail price', 'srp'];\n  let bestPriceKeyRank = Infinity;\n\n  for (const pair of rawPairs) {\n    const keyNorm = pair.key.trim().toLowerCase();\n    if (priceLabelPattern.test(keyNorm)) {\n      const rank = priceKeyPriority.findIndex(p => keyNorm.includes(p));\n      const effectiveRank = rank === -1 ? priceKeyPriority.length : rank;\n      if (effectiveRank < bestPriceKeyRank) {\n        // Extract number from the value (with or without currency symbol)\n        const valMatch = pair.value.match(/[$]?\\s*([\\d,]+\\.?\\d*)/);\n        if (valMatch) {\n          priceFromPair = valMatch[1].replace(/,/g, '');\n          bestPriceKeyRank = effectiveRank;\n        }\n      }\n    }\n  }\n\n  if (priceFromPair) {\n    result.purchasePrice = priceFromPair;\n  } else {\n    // Fall back to scanning text for price patterns\n    // Handle price ranges: \"$2,498.00 - $2,798.00\"  use lower value\n    const rangeMatch = text.match(/[$]\\s*([\\d,]+\\.?\\d*)\\s*[-]\\s*[$]?\\s*([\\d,]+\\.?\\d*)/);\n    if (rangeMatch) {\n      result.purchasePrice = rangeMatch[1].replace(/,/g, '');\n      result.priceNote = `Range: ${rangeMatch[0]}`;\n    } else {\n      // Single price with currency symbol ($, , , )\n      const singleMatch = text.match(/[$]\\s*([\\d,]+\\.?\\d*)/);\n      if (singleMatch) {\n        result.purchasePrice = singleMatch[1].replace(/,/g, '');\n        // Note non-USD currencies\n        const currSymbol = text.match(/([$])/);\n        if (currSymbol && currSymbol[1] !== '$') {\n          const currNames = { '': 'EUR', '': 'GBP', '': 'JPY/CNY' };\n          result.priceNote = `Currency: ${currNames[currSymbol[1]] || currSymbol[1]}`;\n        }\n      }\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // 3. Detect brand\n  // -----------------------------------------------------------------------\n  const textLower = cleaned.toLowerCase();\n  const nameToCheck = result.name ? result.name.toLowerCase() : textLower;\n  for (const brand of KNOWN_BRANDS) {\n    if (nameToCheck.includes(brand.toLowerCase())) {\n      result.brand = brand;\n      break;\n    }\n  }\n  if (!result.brand) {\n    for (const brand of KNOWN_BRANDS) {\n      if (textLower.includes(brand.toLowerCase())) {\n        result.brand = brand;\n        break;\n      }\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // 4. Detect category\n  // -----------------------------------------------------------------------\n  for (const [category, keywords] of Object.entries(CATEGORY_KEYWORDS)) {\n    let score = 0;\n    for (const keyword of keywords) {\n      if (textLower.includes(keyword)) score++;\n    }\n    if (score > 0 && (!result.category || score > (result._catScore || 0))) {\n      result.category = category;\n      result._catScore = score;\n    }\n  }\n  delete result._catScore;\n\n  // -----------------------------------------------------------------------\n  // 4b. Extract serial number / model number from raw pairs\n  // -----------------------------------------------------------------------\n  const serialPatterns = /^(serial\\s*(number|no|#)?|s\\/n|sn)$/i;\n  const modelPatterns = /^(model\\s*(number|no|#)?|part\\s*(number|no|#)?|sku|upc|ean|asin|mfr\\s*(part|#|number)?|manufacturer\\s*part|item\\s*(number|no|#)?)$/i;\n\n  for (const pair of rawPairs) {\n    const keyNorm = pair.key.trim();\n    if (!result.serialNumber && serialPatterns.test(keyNorm)) {\n      result.serialNumber = pair.value.trim();\n    }\n    if (!result.modelNumber && modelPatterns.test(keyNorm)) {\n      result.modelNumber = pair.value.trim();\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // 5. Build alias map and match\n  // -----------------------------------------------------------------------\n  const { aliasMap, allSpecNames, specCategories } = buildSpecAliasMap(specsConfig);\n\n  // Inject community aliases (5.3)  lower priority than built-in aliases\n  if (communityAliases && communityAliases.size > 0) {\n    for (const [sourceKey, { specName, usageCount }] of communityAliases) {\n      const norm = normalize(sourceKey);\n      if (!aliasMap.has(norm)) {\n        // Priority scales with usage: base 55, up to 75 at 20+ uses\n        const priority = Math.min(75, 55 + Math.floor((usageCount - 3) * 1.5));\n        aliasMap.set(norm, { specName, priority, category: null });\n      }\n    }\n  }\n\n  const candidateMap = new Map();\n  allSpecNames.forEach(name => candidateMap.set(name, []));\n\n  const matchedPairIndices = new Set();\n\n  // --- Pass 1: Direct alias lookups ---\n  rawPairs.forEach((pair, idx) => {\n    const keyNorm = normalize(pair.key);\n    const keyExp = expandAbbreviations(keyNorm);\n\n    let entry = aliasMap.get(keyNorm);\n    if (!entry) entry = aliasMap.get(keyExp);\n\n    if (entry) {\n      const candidates = candidateMap.get(entry.specName) || [];\n      candidates.push({\n        value: pair.value,\n        confidence: entry.priority,\n        sourceKey: pair.key,\n        lineIndex: pair.lineIndex,\n      });\n      candidateMap.set(entry.specName, candidates);\n      matchedPairIndices.add(idx);\n    }\n  });\n\n  // --- Pass 2: Fuzzy matching for unmatched pairs ---\n  const detectedCategory = result.category;\n  const sharedFields = new Set(['Weight', 'Dimensions', 'Battery Type', 'Battery Life', 'Mount Type', 'Power Input', 'Material']);\n\n  rawPairs.forEach((pair, idx) => {\n    if (matchedPairIndices.has(idx)) return;\n    const keyNorm = normalize(pair.key);\n    const keyExp = expandAbbreviations(keyNorm);\n\n    const fuzzyMatches = [];\n\n    for (const specName of allSpecNames) {\n      const specNorm = normalize(specName);\n      const specExp = expandAbbreviations(specNorm);\n      const score = Math.max(similarityScore(keyNorm, specNorm), similarityScore(keyExp, specExp));\n\n      if (score >= 50) {\n        let adj = score;\n        const specCat = specCategories.get(specName);\n        if (detectedCategory && specCat && specCat !== detectedCategory && !sharedFields.has(specName)) {\n          adj = Math.max(0, score - 25);\n        }\n        if (adj >= 50) fuzzyMatches.push({ specName, score: adj });\n      }\n    }\n\n    for (const [alias, entry] of aliasMap.entries()) {\n      const aliasExp = expandAbbreviations(alias);\n      const score = Math.max(similarityScore(keyNorm, alias), similarityScore(keyExp, aliasExp));\n\n      if (score >= 55) {\n        let adj = Math.min(92, score + (entry.priority - 50) * 0.15);\n        const specCat = specCategories.get(entry.specName);\n        if (detectedCategory && specCat && specCat !== detectedCategory && !sharedFields.has(entry.specName)) {\n          adj = Math.max(0, adj - 25);\n        }\n        if (adj >= 50) fuzzyMatches.push({ specName: entry.specName, score: adj });\n      }\n    }\n\n    if (fuzzyMatches.length > 0) {\n      const bestBySpec = new Map();\n      fuzzyMatches.forEach(m => {\n        const existing = bestBySpec.get(m.specName);\n        if (!existing || m.score > existing.score) bestBySpec.set(m.specName, m);\n      });\n\n      for (const [specName, match] of bestBySpec) {\n        const candidates = candidateMap.get(specName) || [];\n        candidates.push({\n          value: pair.value,\n          confidence: Math.round(match.score),\n          sourceKey: pair.key,\n          lineIndex: pair.lineIndex,\n        });\n        candidateMap.set(specName, candidates);\n      }\n      matchedPairIndices.add(idx);\n    }\n  });\n\n  // --- Pass 3: Resolve best match per field ---\n  // Includes: multi-value merging (1.2), conflict detection (4.3), value validation (4.2)\n  // RULE: Direct matches ( 85) always win over fuzzy matches\n\n  // Known value ranges for validation (4.2)\n  const VALUE_RANGES = {\n    'Weight': { pattern: /[\\d.]+/, max: 100, unit: 'kg', warn: 'Weight over 100kg  verify value' },\n    'Focal Length': { pattern: /[\\d.]+/, max: 2000, unit: 'mm', warn: 'Focal length over 2000mm  verify value' },\n    'Maximum Aperture': { pattern: /f?\\/?(\\d+\\.?\\d*)/, group: 1, min: 0.7, max: 64, warn: 'Unusual aperture value  verify' },\n    'Minimum Aperture': { pattern: /f?\\/?(\\d+\\.?\\d*)/, group: 1, min: 0.7, max: 128, warn: 'Unusual aperture value  verify' },\n    'Max Power Output': { pattern: /[\\d.]+/, max: 20000, unit: 'W', warn: 'Power over 20kW  verify value' },\n    'Screen Size': { pattern: /[\\d.]+/, max: 100, unit: 'inches', warn: 'Screen size over 100\"  verify value' },\n    'Max Height': { pattern: /[\\d.]+/, max: 10, unit: 'm', warn: 'Height over 10m  verify value' },\n    'Battery Life': { pattern: /[\\d.]+/, max: 10000, warn: 'Unusually high battery life  verify value' },\n    'ISO Range': { pattern: /[\\d,]+/, checkFn: (v) => { const n = parseInt(v.replace(/,/g, '')); return n > 0 && n <= 10000000; }, warn: 'ISO value out of expected range' },\n  };\n\n  function validateFieldValue(specName, value) {\n    const rule = VALUE_RANGES[specName];\n    if (!rule) return null;\n    const match = value.match(rule.pattern);\n    if (!match) return null;\n    if (rule.checkFn) {\n      return rule.checkFn(value) ? null : rule.warn;\n    }\n    const num = parseFloat(match[rule.group || 0]);\n    if (isNaN(num)) return null;\n    if (rule.min !== undefined && num < rule.min) return rule.warn;\n    if (rule.max !== undefined && num > rule.max) return rule.warn;\n    return null;\n  }\n\n  for (const [specName, candidates] of candidateMap) {\n    if (candidates.length === 0) continue;\n\n    candidates.sort((a, b) => b.confidence - a.confidence);\n\n    // Deduplicate by value\n    const seen = new Set();\n    const deduped = candidates.filter(c => {\n      const key = c.value.toLowerCase().trim();\n      if (seen.has(key)) return false;\n      seen.add(key);\n      return true;\n    });\n\n    // --- Multi-value merging (1.2) ---\n    // If multiple candidates share similar source keys and confidence levels,\n    // merge their values (e.g. \"4K 60p\" + \"1080p 120p\"  \"4K 60p, 1080p 120p\")\n    const directMatches = deduped.filter(c => c.confidence >= 85);\n    let merged = null;\n    if (directMatches.length > 1) {\n      const confRange = Math.max(...directMatches.map(c => c.confidence)) - Math.min(...directMatches.map(c => c.confidence));\n      if (confRange <= 10) {\n        merged = {\n          value: directMatches.map(c => c.value).join(', '),\n          confidence: Math.round(directMatches.reduce((s, c) => s + c.confidence, 0) / directMatches.length),\n          sourceKey: directMatches.map(c => c.sourceKey).join(' + '),\n          mergedCount: directMatches.length,\n        };\n      }\n    }\n\n    // --- Conflict detection (4.3) ---\n    // If multiple deduped candidates have very different values but similar confidence, flag as conflict\n    let hasConflict = false;\n    if (!merged && deduped.length > 1) {\n      const topTwo = deduped.slice(0, 2);\n      const confDiff = Math.abs(topTwo[0].confidence - topTwo[1].confidence);\n      // Conflict: both are reasonably confident and values differ\n      if (confDiff <= 15 && topTwo[0].confidence >= 50 && topTwo[1].confidence >= 50) {\n        hasConflict = true;\n      }\n    }\n\n    // Prefer merged  direct match  best candidate\n    const directMatch = deduped.find(c => c.confidence >= 85);\n    const best = merged || directMatch || deduped[0];\n\n    // Value range validation (4.2)\n    const validationWarning = validateFieldValue(specName, best.value);\n\n    result.fields.set(specName, {\n      value: best.value,\n      confidence: best.confidence,\n      sourceKey: best.sourceKey,\n      lineIndex: best.lineIndex,\n      alternatives: deduped.length > 1 ? deduped : [],\n      ...(merged ? { mergedCount: merged.mergedCount } : {}),\n      ...(hasConflict ? { hasConflict: true } : {}),\n      ...(validationWarning ? { validationWarning } : {}),\n    });\n  }\n\n  // Store cleaned source lines for side-by-side view (3.3)\n  result.sourceLines = lines;\n\n  // Collect unmatched\n  rawPairs.forEach((pair, idx) => {\n    if (!matchedPairIndices.has(idx)) {\n      result.unmatchedPairs.push({ key: pair.key, value: pair.value, lineIndex: pair.lineIndex });\n    }\n  });\n\n  return result;\n}\n\n\n// ============================================================================\n// Unit Normalization (4.1) & Type Coercion (4.4)\n// ============================================================================\n\nconst UNIT_CONVERSIONS = {\n  // Length: inches  mm\n  'in_to_mm': { pattern: /([\\d.]+)\\s*(?:in(?:ch(?:es)?)?|\")\\b/gi, factor: 25.4, toUnit: 'mm' },\n  'mm_to_in': { pattern: /([\\d.]+)\\s*mm\\b/gi, factor: 1 / 25.4, toUnit: 'in' },\n  'cm_to_mm': { pattern: /([\\d.]+)\\s*cm\\b/gi, factor: 10, toUnit: 'mm' },\n  // Weight: lbs/oz  g\n  'lb_to_g': { pattern: /([\\d.]+)\\s*(?:lbs?|pounds?)\\b/gi, factor: 453.592, toUnit: 'g' },\n  'oz_to_g': { pattern: /([\\d.]+)\\s*(?:oz|ounces?)\\b/gi, factor: 28.3495, toUnit: 'g' },\n  'kg_to_g': { pattern: /([\\d.]+)\\s*kg\\b/gi, factor: 1000, toUnit: 'g' },\n  // Temperature: F  C\n  'f_to_c': { pattern: /([\\d.]+)\\s*?\\s*F\\b/gi, fn: (v) => ((v - 32) * 5 / 9).toFixed(0), toUnit: 'C' },\n};\n\n/**\n * Detect units in a value and return normalized form + original.\n * Returns { original, normalized, unit } or null if no conversion applies.\n */\nexport function normalizeUnits(value, preferMetric = true) {\n  if (!value || typeof value !== 'string') return null;\n\n  // Compound weight: \"1 lb 5 oz\"  grams\n  const compoundLb = value.match(/([\\d.]+)\\s*(?:lbs?|pounds?)\\s+([\\d.]+)\\s*(?:oz|ounces?)/i);\n  if (compoundLb) {\n    const grams = parseFloat(compoundLb[1]) * 453.592 + parseFloat(compoundLb[2]) * 28.3495;\n    if (grams >= 1000) {\n      return { original: value, normalized: `${(grams / 1000).toFixed(2)} kg`, unit: 'kg' };\n    }\n    return { original: value, normalized: `${Math.round(grams)} g`, unit: 'g' };\n  }\n\n  // Dimensions: \"6.5 x 4.3 x 3.1 inches\" or \"165 x 109 x 79 mm\"\n  const dimInches = value.match(/([\\d.]+)\\s*[x]\\s*([\\d.]+)(?:\\s*[x]\\s*([\\d.]+))?\\s*(?:in(?:ch(?:es)?)?|\")/i);\n  if (dimInches && preferMetric) {\n    const dims = [dimInches[1], dimInches[2], dimInches[3]].filter(Boolean).map(d => Math.round(parseFloat(d) * 25.4));\n    return { original: value, normalized: dims.join('  ') + ' mm', unit: 'mm' };\n  }\n  const dimMm = value.match(/([\\d.]+)\\s*[x]\\s*([\\d.]+)(?:\\s*[x]\\s*([\\d.]+))?\\s*mm/i);\n  if (dimMm && !preferMetric) {\n    const dims = [dimMm[1], dimMm[2], dimMm[3]].filter(Boolean).map(d => (parseFloat(d) / 25.4).toFixed(2));\n    return { original: value, normalized: dims.join('  ') + ' in', unit: 'in' };\n  }\n\n  // Simple single-unit conversions\n  if (preferMetric) {\n    for (const key of ['in_to_mm', 'lb_to_g', 'oz_to_g']) {\n      const conv = UNIT_CONVERSIONS[key];\n      const match = value.match(conv.pattern);\n      if (match) {\n        const num = parseFloat(match[1]);\n        const converted = conv.fn ? conv.fn(num) : (num * conv.factor).toFixed(conv.toUnit === 'mm' ? 1 : 0);\n        return { original: value, normalized: `${converted} ${conv.toUnit}`, unit: conv.toUnit };\n      }\n    }\n  } else {\n    for (const key of ['mm_to_in']) {\n      const conv = UNIT_CONVERSIONS[key];\n      const match = value.match(conv.pattern);\n      if (match) {\n        const num = parseFloat(match[1]);\n        const converted = (num * conv.factor).toFixed(2);\n        return { original: value, normalized: `${converted} ${conv.toUnit}`, unit: conv.toUnit };\n      }\n    }\n  }\n\n  // Fahrenheit to Celsius\n  const fMatch = value.match(UNIT_CONVERSIONS.f_to_c.pattern);\n  if (fMatch && preferMetric) {\n    const converted = UNIT_CONVERSIONS.f_to_c.fn(parseFloat(fMatch[1]));\n    return { original: value, normalized: `${converted} C`, unit: 'C' };\n  }\n\n  return null;\n}\n\n/**\n * Smart type coercion (4.4)  normalize values to expected formats.\n */\nexport function coerceFieldValue(specName, value) {\n  if (!value || typeof value !== 'string') return null;\n  const v = value.trim();\n  const nameLower = specName.toLowerCase();\n\n  // Boolean fields\n  const boolFields = ['weather sealing', 'touchscreen', 'autofocus', 'image stabilization',\n    'stabilization', 'wireless control', 'airline approved', 'phantom power', 'hdr recording'];\n  if (boolFields.some(f => nameLower.includes(f) || f.includes(nameLower))) {\n    const lower = v.toLowerCase();\n    if (/^(yes|true|included|available|built[\\s-]?in|equipped|supported||)$/i.test(lower)) {\n      return { original: v, coerced: 'Yes' };\n    }\n    if (/^(no|false|not included|none|n\\/a|not available|not supported|||)$/i.test(lower)) {\n      return { original: v, coerced: 'No' };\n    }\n  }\n\n  // CCT / Color Temperature range: \"2700K-6500K\"  \"27006500 K\"\n  if (nameLower.includes('color temp') || nameLower.includes('cct')) {\n    const cctMatch = v.match(/(\\d{3,5})\\s*K?\\s*[-to]+\\s*(\\d{3,5})\\s*K?/i);\n    if (cctMatch) {\n      return { original: v, coerced: `${cctMatch[1]}${cctMatch[2]} K` };\n    }\n  }\n\n  // Aperture: ensure f/ prefix\n  if (nameLower.includes('aperture')) {\n    const apMatch = v.match(/^(\\d+\\.?\\d*)$/);\n    if (apMatch) {\n      return { original: v, coerced: `f/${apMatch[1]}` };\n    }\n  }\n\n  return null;\n}\n\n\n// ============================================================================\n// Build payload for the item form\n// ============================================================================\n\nexport function buildApplyPayload(parseResult, selectedValues) {\n  const specs = {};\n  for (const [specName, data] of parseResult.fields) {\n    const override = selectedValues?.[specName];\n    const value = override !== undefined ? override : data.value;\n    if (value && value.trim()) {\n      specs[specName] = value;\n    }\n  }\n\n  // Include manually-mapped unmatched pairs\n  if (selectedValues?._manualMappings) {\n    for (const [specName, value] of Object.entries(selectedValues._manualMappings)) {\n      if (value && value.trim() && !specs[specName]) {\n        specs[specName] = value;\n      }\n    }\n  }\n\n  return {\n    name: parseResult.name || '',\n    brand: parseResult.brand || '',\n    category: parseResult.category || '',\n    purchasePrice: parseResult.purchasePrice || '',\n    priceNote: parseResult.priceNote || '',\n    serialNumber: parseResult.serialNumber || '',\n    modelNumber: parseResult.modelNumber || '',\n    specs,\n  };\n}\n\n\n// ============================================================================\n// Batch Import  Multi-product Detection (5.1)\n// ============================================================================\n\n/**\n * Detect product boundaries in text containing multiple products.\n * Returns array of { startLine, endLine, name, text } segments.\n */\nexport function detectProductBoundaries(text) {\n  if (!text) return [];\n  const lines = text.split('\\n');\n  const boundaries = [];\n  let currentStart = 0;\n  let currentName = null;\n\n  // Patterns that indicate a new product boundary\n  const boundaryPatterns = [\n    /^[-=_]{3,}\\s*$/,                                // Horizontal rules: --- === ___\n    /^#{1,3}\\s+.+/,                                  // Markdown headings\n    /^product\\s*(?:name|#|number)?\\s*[:=]/i,        // \"Product Name:\" labels\n    /^item\\s*(?:name|#|number)?\\s*[:=]/i,           // \"Item Name:\" labels\n    /^model\\s*(?:name|#|number)?\\s*[:=]/i,          // \"Model:\" labels\n  ];\n\n  // Brand + product word pattern (strong product name signal)\n  const productNamePattern = /\\b(?:Sony|Canon|Nikon|Panasonic|Blackmagic|RED|ARRI|Fujifilm|Sennheiser|Rode|Shure|Aputure|Godox|DJI|Manfrotto|Atomos|SmallHD|Teradek)\\b/i;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i].trim();\n    if (!line) continue;\n\n    let isBoundary = false;\n    let detectedName = null;\n\n    // Check horizontal rules\n    if (/^[-=_]{3,}\\s*$/.test(line)) {\n      isBoundary = true;\n    }\n    // Check markdown headings\n    else if (/^#{1,3}\\s+(.+)/.test(line)) {\n      isBoundary = true;\n      detectedName = line.replace(/^#{1,3}\\s+/, '').trim();\n    }\n    // Check \"Product Name:\" style labels\n    else if (/^(?:product|item|model)\\s*(?:name|#|number)?\\s*[:=]\\s*(.+)/i.test(line)) {\n      isBoundary = true;\n      const match = line.match(/[:=]\\s*(.+)/);\n      detectedName = match ? match[1].trim() : null;\n    }\n    // Check for brand-name product lines after a gap\n    else if (i > 0 && !lines[i - 1]?.trim() && productNamePattern.test(line) && line.length < 120) {\n      // Empty line before + contains brand name = likely new product\n      isBoundary = true;\n      detectedName = line;\n    }\n\n    if (isBoundary && i > currentStart + 2) {\n      // Save previous segment\n      const segText = lines.slice(currentStart, i).join('\\n').trim();\n      if (segText.length > 20) {\n        boundaries.push({\n          startLine: currentStart,\n          endLine: i - 1,\n          name: currentName || `Product ${boundaries.length + 1}`,\n          text: segText,\n        });\n      }\n      currentStart = i;\n      currentName = detectedName;\n    } else if (isBoundary && !currentName) {\n      currentName = detectedName;\n    }\n  }\n\n  // Last segment\n  const lastText = lines.slice(currentStart).join('\\n').trim();\n  if (lastText.length > 20) {\n    boundaries.push({\n      startLine: currentStart,\n      endLine: lines.length - 1,\n      name: currentName || `Product ${boundaries.length + 1}`,\n      text: lastText,\n    });\n  }\n\n  // If only one segment found, text likely contains a single product\n  return boundaries.length > 1 ? boundaries : [];\n}\n\n/**\n * Parse multiple products from batch text.\n * Returns array of parse results.\n */\nexport function parseBatchProducts(text, specs, options = {}) {\n  const segments = detectProductBoundaries(text);\n  if (segments.length === 0) {\n    // Single product  return as array of one\n    return [{ segment: { name: 'Single Product', text }, result: parseProductText(text, specs, options) }];\n  }\n  return segments.map(segment => ({\n    segment,\n    result: parseProductText(segment.text, specs, options),\n  }));\n}\n\n\n// ============================================================================\n// URL Fetch (2.1)  Client-side stub\n// Requires a Supabase Edge Function for CORS proxy\n// ============================================================================\n\n/**\n * Fetch product page content via a CORS proxy.\n * @param {string} url - The product page URL\n * @param {string} proxyUrl - The Supabase Edge Function URL (e.g. /functions/v1/fetch-product-page)\n * @returns {Promise<{text: string, html: string, sourceUrl: string}>}\n */\nexport async function fetchProductPage(url, proxyUrl) {\n  if (!proxyUrl) {\n    throw new Error(\n      'URL import requires a CORS proxy. Set up the fetch-product-page Edge Function and provide its URL.'\n    );\n  }\n  const response = await fetch(proxyUrl, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ url }),\n  });\n  if (!response.ok) {\n    throw new Error(`Proxy fetch failed: ${response.status} ${response.statusText}`);\n  }\n  const data = await response.json();\n  return {\n    text: data.text || '',\n    html: data.html || '',\n    sourceUrl: url,\n  };\n}\n\n\n// ============================================================================\n// Re-import / Spec Diff Engine (5.2)\n// ============================================================================\n\n/**\n * Compare new parse results against existing item specs.\n * Returns a diff summary for each field.\n * @param {Object} existingSpecs - Current spec values { specName: value }\n * @param {Map} newFields - New parse result fields Map\n * @returns {Array<{specName, status, oldValue, newValue, confidence}>}\n */\nexport function diffSpecs(existingSpecs, newFields) {\n  const diff = [];\n  const allKeys = new Set([\n    ...Object.keys(existingSpecs || {}),\n    ...(newFields ? [...newFields.keys()] : []),\n  ]);\n\n  for (const specName of allKeys) {\n    const oldVal = existingSpecs?.[specName] || '';\n    const newField = newFields?.get(specName);\n    const newVal = newField?.value || '';\n    const confidence = newField?.confidence || 0;\n\n    if (!oldVal && newVal) {\n      diff.push({ specName, status: 'added', oldValue: '', newValue: newVal, confidence });\n    } else if (oldVal && !newVal) {\n      diff.push({ specName, status: 'removed', oldValue: oldVal, newValue: '', confidence });\n    } else if (oldVal && newVal && oldVal.toLowerCase().trim() !== newVal.toLowerCase().trim()) {\n      diff.push({ specName, status: 'changed', oldValue: oldVal, newValue: newVal, confidence });\n    } else if (oldVal && newVal) {\n      diff.push({ specName, status: 'unchanged', oldValue: oldVal, newValue: newVal, confidence });\n    }\n  }\n\n  // Sort: changed first, then added, then unchanged, then removed\n  const statusOrder = { changed: 0, added: 1, unchanged: 2, removed: 3 };\n  diff.sort((a, b) => (statusOrder[a.status] ?? 99) - (statusOrder[b.status] ?? 99));\n\n  return diff;\n}\n\n\n// ============================================================================\n// Community Alias Stub (5.3)\n// Requires Supabase table: smart_paste_aliases\n// ============================================================================\n\n/**\n * Record a manual mapping for community learning.\n * @param {Object} supabase - Supabase client instance\n * @param {string} sourceKey - The original key from the pasted text\n * @param {string} specName - The spec field the user mapped it to\n * @param {string} category - The item category (for context)\n */\nexport async function recordAlias(supabase, sourceKey, specName, category) {\n  if (!supabase) return;\n  try {\n    // Upsert: increment usage_count if exists, insert if not\n    const { error } = await supabase.rpc('upsert_smart_paste_alias', {\n      p_source_key: sourceKey.toLowerCase().trim(),\n      p_spec_name: specName,\n      p_category: category || null,\n    });\n    if (error) warn('Failed to record alias:', error.message);\n  } catch (e) {\n    warn('Community alias recording not available:', e.message);\n  }\n}\n\n/**\n * Fetch community aliases for use in parsing.\n * Returns Map<normalizedKey, { specName, usageCount }>.\n * @param {Object} supabase - Supabase client instance\n * @param {number} minUsage - Minimum usage count to include (default 3)\n */\nexport async function fetchCommunityAliases(supabase, minUsage = 3) {\n  if (!supabase) return new Map();\n  try {\n    const { data, error } = await supabase\n      .from('smart_paste_aliases')\n      .select('source_key, spec_name, usage_count')\n      .gte('usage_count', minUsage)\n      .order('usage_count', { ascending: false });\n    if (error) throw error;\n    const map = new Map();\n    for (const row of data || []) {\n      map.set(row.source_key, { specName: row.spec_name, usageCount: row.usage_count });\n    }\n    return map;\n  } catch (e) {\n    warn('Community aliases not available:', e.message);\n    return new Map();\n  }\n}\n\n\n// ============================================================================\n// Image OCR (2.3)  Tesseract.js loaded on demand from CDN\n// ============================================================================\n\nlet tesseractWorker = null;\n\n/**\n * Run OCR on an image file and return extracted text.\n * Dynamically loads Tesseract.js from CDN on first use (~2MB WASM).\n * @param {File|Blob} imageFile - Image file (PNG, JPEG, WebP, TIFF, BMP)\n * @param {Function} onProgress - Optional progress callback (0-1)\n * @returns {Promise<{ text: string, confidence: number }>}\n */\nexport async function ocrImage(imageFile, onProgress) {\n  // Dynamic import of Tesseract.js from CDN\n  if (!tesseractWorker) {\n    if (onProgress) onProgress(0.05);\n    try {\n      const Tesseract = await import(/* @vite-ignore */ 'https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.esm.min.js');\n      if (onProgress) onProgress(0.15);\n      tesseractWorker = await Tesseract.createWorker('eng', 1, {\n        logger: (m) => {\n          if (onProgress && m.status === 'recognizing text') {\n            onProgress(0.2 + m.progress * 0.7);\n          }\n        },\n      });\n    } catch (err) {\n      throw new Error(\n        'Failed to load OCR engine. Check your internet connection and try again. ' +\n        'Alternatively, paste the text manually or use a screenshot-to-text tool.'\n      );\n    }\n  }\n\n  if (onProgress) onProgress(0.2);\n\n  // Pre-process: create an off-screen canvas for contrast enhancement\n  const enhancedBlob = await enhanceImageForOCR(imageFile);\n  if (onProgress) onProgress(0.25);\n\n  const { data } = await tesseractWorker.recognize(enhancedBlob || imageFile);\n  if (onProgress) onProgress(0.95);\n\n  // Post-process: clean up OCR artifacts\n  let text = data.text || '';\n  text = text\n    .replace(/[|]/g, 'I')           // Common OCR confusion: |  I\n    .replace(/(\\w)l(\\w)/g, '$1I$2')  // Lowercase L in the middle of uppercase words\n    .replace(/\\n{3,}/g, '\\n\\n')      // Collapse excessive blank lines\n    .replace(/^\\s+$/gm, '')          // Remove whitespace-only lines\n    .trim();\n\n  if (onProgress) onProgress(1);\n\n  return {\n    text,\n    confidence: data.confidence || 0, // Tesseract's overall confidence (0-100)\n  };\n}\n\n/**\n * Enhance image for better OCR results.\n * Applies grayscale conversion and contrast boost using canvas.\n * Returns a Blob or null if enhancement fails.\n */\nasync function enhanceImageForOCR(imageFile) {\n  try {\n    const bitmap = await createImageBitmap(imageFile);\n    const canvas = new OffscreenCanvas(bitmap.width, bitmap.height);\n    const ctx = canvas.getContext('2d');\n\n    // Draw original\n    ctx.drawImage(bitmap, 0, 0);\n\n    // Get pixel data\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    const data = imageData.data;\n\n    // Convert to grayscale and boost contrast\n    for (let i = 0; i < data.length; i += 4) {\n      // Luminance grayscale\n      const gray = 0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];\n\n      // Contrast stretch: push darks darker, lights lighter\n      // Using a simple S-curve: factor of 1.5 around midpoint 128\n      const contrast = 1.5;\n      const adjusted = Math.min(255, Math.max(0, ((gray / 255 - 0.5) * contrast + 0.5) * 255));\n\n      data[i] = adjusted;     // R\n      data[i + 1] = adjusted; // G\n      data[i + 2] = adjusted; // B\n      // Alpha unchanged\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n    return await canvas.convertToBlob({ type: 'image/png' });\n  } catch {\n    // Enhancement failed (e.g. OffscreenCanvas not supported)  use original\n    return null;\n  }\n}\n\n/**\n * Terminate the OCR worker to free memory.\n * Call when the modal closes if OCR was used.\n */\nexport async function terminateOCR() {\n  if (tesseractWorker) {\n    try {\n      await tesseractWorker.terminate();\n    } catch { /* ignore */ }\n    tesseractWorker = null;\n  }\n}\n","// ============================================================================\n// Smart Paste Modal\n// Import product specs from pasted text, PDF, or TXT files\n// ============================================================================\n\nimport React, { memo, useState, useRef, useEffect, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport { Upload, FileText, ChevronDown, ChevronUp, AlertCircle, Check, X as XIcon } from 'lucide-react';\nimport { colors, styles, spacing, borderRadius, typography, withOpacity } from '../theme.js';\nimport { Button } from '../components/ui.jsx';\nimport { Modal, ModalHeader } from './ModalBase.jsx';\nimport {\n  parseProductText,\n  buildApplyPayload,\n  readTextFile,\n  readPdfFile,\n  cleanInputText,\n  normalizeUnits,\n  coerceFieldValue,\n  detectProductBoundaries,\n  parseBatchProducts,\n  fetchProductPage,\n  diffSpecs,\n  recordAlias,\n  fetchCommunityAliases,\n  ocrImage,\n  terminateOCR,\n} from '../lib/smartPasteParser.js';\nimport { getSupabase } from '../lib/supabase.js';\n\nimport { error as logError } from '../lib/logger.js';\n\n// ============================================================================\n// Confidence Badge\n// ============================================================================\nfunction ConfidenceBadge({ confidence }) {\n  let color, label;\n  if (confidence >= 85) {\n    color = colors.available || '#4ade80';\n    label = 'Direct';\n  } else if (confidence >= 60) {\n    color = colors.accent1 || '#facc15';\n    label = 'Likely';\n  } else {\n    color = colors.textMuted;\n    label = 'Fuzzy';\n  }\n\n  return (\n    <span style={{\n      display: 'inline-block',\n      fontSize: 10,\n      fontWeight: 600,\n      padding: '1px 6px',\n      borderRadius: 4,\n      background: `${withOpacity(color, 20)}`,\n      color,\n      textTransform: 'uppercase',\n      letterSpacing: '0.04em',\n      lineHeight: '16px',\n      whiteSpace: 'nowrap',\n      flexShrink: 0,\n    }}>\n      {label}\n    </span>\n  );\n}\n\n// ============================================================================\n// Basic Info Row (read-only)\n// ============================================================================\nfunction BasicInfoRow({ label, value }) {\n  return (\n    <div style={{\n      display: 'grid',\n      gridTemplateColumns: '80px 1fr',\n      gap: spacing[2],\n      padding: `${spacing[1]}px 0`,\n      fontSize: typography.fontSize.sm,\n    }}>\n      <span style={{ fontWeight: 600, color: colors.textPrimary }}>{label}</span>\n      <span style={{\n        color: value ? colors.textSecondary : withOpacity(colors.textMuted, 40),\n        fontStyle: value ? 'normal' : 'italic',\n      }}>\n        {value || 'Not detected'}\n      </span>\n    </div>\n  );\n}\n\n// ============================================================================\n// Field Row with dropdown alternatives\n// ============================================================================\nfunction FieldRow({ specName, fieldData, selectedValue, onSelect, onClear, isRequired, onLineClick, unitInfo, coercionInfo }) {\n  const [isOpen, setIsOpen] = useState(false);\n  const hasAlts = fieldData && fieldData.alternatives && fieldData.alternatives.length > 1;\n  const value = fieldData\n    ? (selectedValue !== undefined ? selectedValue : fieldData.value)\n    : '';\n  const isEmpty = !value;\n\n  return (\n    <div style={{\n      display: 'grid',\n      gridTemplateColumns: '1fr 1.6fr auto',\n      gap: spacing[2],\n      alignItems: 'start',\n      padding: `${spacing[2]}px 0`,\n      borderBottom: `1px solid ${withOpacity(colors.border, 30)}`,\n    }}>\n      {/* Spec Name  clickable to highlight source line (3.3) */}\n      <div\n        onClick={() => onLineClick && fieldData?.lineIndex != null && onLineClick(fieldData.lineIndex)}\n        style={{\n          fontSize: typography.fontSize.sm,\n          fontWeight: 600,\n          color: isEmpty ? withOpacity(colors.textMuted, 60) : colors.textPrimary,\n          paddingTop: 2,\n          wordBreak: 'break-word',\n          display: 'flex',\n          alignItems: 'baseline',\n          gap: 4,\n          cursor: onLineClick && fieldData?.lineIndex != null ? 'pointer' : 'default',\n        }}\n        title={onLineClick && fieldData?.lineIndex != null ? 'Click to view in source' : undefined}\n      >\n        <span>{specName}</span>\n        {isRequired && (\n          <span style={{ color: colors.danger || '#f87171', fontSize: 10, fontWeight: 700 }}>*</span>\n        )}\n      </div>\n\n      {/* Value + Dropdown */}\n      <div style={{ position: 'relative' }}>\n        {isEmpty ? (\n          <span style={{\n            fontSize: typography.fontSize.sm,\n            color: withOpacity(colors.textMuted, 40),\n            fontStyle: 'italic',\n          }}>\n            \n          </span>\n        ) : (\n          <div>\n            <div style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: spacing[1],\n              flexWrap: 'wrap',\n            }}>\n              <span style={{\n                fontSize: typography.fontSize.sm,\n                color: colors.textSecondary,\n                wordBreak: 'break-word',\n                flex: 1,\n                minWidth: 0,\n              }}>\n                {value}\n              </span>\n              {/* Conflict badge (4.3) */}\n              {fieldData.hasConflict && !selectedValue && (\n                <span style={{\n                  display: 'inline-flex',\n                  alignItems: 'center',\n                  gap: 3,\n                  fontSize: 10,\n                  fontWeight: 600,\n                  padding: '1px 6px',\n                  borderRadius: 4,\n                  background: withOpacity(colors.danger || '#f87171', 15),\n                  color: colors.danger || '#f87171',\n                  textTransform: 'uppercase',\n                  letterSpacing: '0.04em',\n                  lineHeight: '16px',\n                  whiteSpace: 'nowrap',\n                  flexShrink: 0,\n                }}>\n                   Conflict\n                </span>\n              )}\n              {/* Merged badge (1.2) */}\n              {fieldData.mergedCount && (\n                <span style={{\n                  display: 'inline-block',\n                  fontSize: 10,\n                  fontWeight: 600,\n                  padding: '1px 6px',\n                  borderRadius: 4,\n                  background: withOpacity(colors.primary, 15),\n                  color: colors.primary,\n                  textTransform: 'uppercase',\n                  letterSpacing: '0.04em',\n                  lineHeight: '16px',\n                  whiteSpace: 'nowrap',\n                  flexShrink: 0,\n                }}>\n                  Combined {fieldData.mergedCount}\n                </span>\n              )}\n              {/* Standard confidence badge */}\n              {!fieldData.hasConflict && !fieldData.mergedCount && (\n                <ConfidenceBadge confidence={fieldData.confidence} />\n              )}\n              {fieldData.hasConflict && !fieldData.mergedCount && selectedValue && (\n                <ConfidenceBadge confidence={fieldData.confidence} />\n              )}\n              {hasAlts && (\n                <button\n                  onClick={() => setIsOpen(!isOpen)}\n                  style={{\n                    background: withOpacity(colors.primary, 10),\n                    border: `1px solid ${withOpacity(colors.primary, 30)}`,\n                    borderRadius: borderRadius.sm,\n                    cursor: 'pointer',\n                    color: colors.primary,\n                    padding: '1px 6px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    fontSize: typography.fontSize.xs,\n                    gap: 3,\n                    whiteSpace: 'nowrap',\n                    flexShrink: 0,\n                  }}\n                  title={fieldData.hasConflict\n                    ? ` ${fieldData.alternatives.length} conflicting values  click to choose`\n                    : `${fieldData.alternatives.length} options  click to choose`}\n                >\n                  {isOpen ? <ChevronUp size={10} /> : <ChevronDown size={10} />}\n                  <span>{fieldData.alternatives.length} {fieldData.hasConflict ? 'conflicts' : 'options'}</span>\n                </button>\n              )}\n            </div>\n            {/* Validation warning (4.2) */}\n            {fieldData.validationWarning && (\n              <div style={{\n                fontSize: 11,\n                color: colors.accent1 || '#facc15',\n                marginTop: 2,\n                display: 'flex',\n                alignItems: 'center',\n                gap: 4,\n              }}>\n                \n                <span>{fieldData.validationWarning}</span>\n              </div>\n            )}\n            {/* Source key hint */}\n            {fieldData.sourceKey && fieldData.sourceKey.toLowerCase() !== specName.toLowerCase() && (\n              <div style={{\n                fontSize: 11,\n                color: withOpacity(colors.textMuted, 60),\n                marginTop: 2,\n              }}>\n                matched from: <em>{fieldData.sourceKey}</em>\n              </div>\n            )}\n            {/* Unit normalization hint (4.1) */}\n            {unitInfo && (\n              <div style={{\n                fontSize: 11,\n                color: colors.primary,\n                marginTop: 2,\n                display: 'flex',\n                alignItems: 'center',\n                gap: 4,\n              }}>\n                \n                <span>normalized: <strong>{unitInfo.normalized}</strong></span>\n              </div>\n            )}\n            {/* Type coercion hint (4.4) */}\n            {coercionInfo && !unitInfo && (\n              <div style={{\n                fontSize: 11,\n                color: withOpacity(colors.primary, 80),\n                marginTop: 2,\n                display: 'flex',\n                alignItems: 'center',\n                gap: 4,\n              }}>\n                \n                <span>suggestion: <strong>{coercionInfo.coerced}</strong></span>\n              </div>\n            )}\n            {/* Alternatives dropdown */}\n            {isOpen && hasAlts && (\n              <div style={{\n                marginTop: spacing[1],\n                background: colors.bgMedium,\n                border: `1px solid ${colors.border}`,\n                borderRadius: borderRadius.md,\n                overflow: 'hidden',\n                boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n              }}>\n                {fieldData.alternatives.map((alt, i) => {\n                  const isSelected = alt.value === value;\n                  return (\n                    <button\n                      key={i}\n                      onClick={() => { onSelect(specName, alt.value); setIsOpen(false); }}\n                      style={{\n                        width: '100%',\n                        textAlign: 'left',\n                        padding: `${spacing[2]}px ${spacing[2]}px`,\n                        border: 'none',\n                        borderBottom: i < fieldData.alternatives.length - 1\n                          ? `1px solid ${withOpacity(colors.border, 30)}`\n                          : 'none',\n                        background: isSelected ? `${withOpacity(colors.primary, 15)}` : 'transparent',\n                        cursor: 'pointer',\n                        fontSize: typography.fontSize.sm,\n                        color: colors.textSecondary,\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: spacing[2],\n                      }}\n                    >\n                      {isSelected && <Check size={12} style={{ color: colors.primary, flexShrink: 0 }} />}\n                      {!isSelected && <span style={{ width: 12, flexShrink: 0 }} />}\n                      <span style={{ flex: 1, wordBreak: 'break-word' }}>{alt.value}</span>\n                      <ConfidenceBadge confidence={alt.confidence} />\n                      <span style={{\n                        color: withOpacity(colors.textMuted, 60),\n                        fontSize: 11,\n                        flexShrink: 0,\n                        maxWidth: 120,\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: 'nowrap',\n                      }}>\n                        {alt.sourceKey}\n                      </span>\n                    </button>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Clear button */}\n      {!isEmpty && (\n        <button\n          onClick={() => onClear(specName)}\n          style={{\n            background: 'none',\n            border: 'none',\n            cursor: 'pointer',\n            color: colors.textMuted,\n            padding: 2,\n            display: 'flex',\n            alignItems: 'center',\n            marginTop: 2,\n            opacity: 0.6,\n          }}\n          title=\"Clear this field\"\n        >\n          <XIcon size={12} />\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// Smart Paste Modal Component\n// ============================================================================\nexport const SmartPasteModal = memo(function SmartPasteModal({ specs, onApply, onClose, existingItem }) {\n  const [inputText, setInputText] = useState('');\n  const [inputMode, setInputMode] = useState('paste'); // 'paste' | 'file' | 'url'\n  const [dragOver, setDragOver] = useState(false);\n  const [parseResult, setParseResult] = useState(null);\n  const [selectedValues, setSelectedValues] = useState({});\n  const [importStatus, setImportStatus] = useState('');\n  const [showUnmatched, setShowUnmatched] = useState(false);\n  const [showEmptyFields, setShowEmptyFields] = useState(true);\n  const [confidenceMode, setConfidenceMode] = useState('balanced'); // 'strict' | 'balanced' | 'aggressive'\n  const [manualMappings, setManualMappings] = useState({}); // { unmatchedIndex: specName }\n  const [brandOverride, setBrandOverride] = useState(null); // null = use detected\n  const [categoryOverride, setCategoryOverride] = useState(null); // null = use detected\n  const [showSourceView, setShowSourceView] = useState(false); // side-by-side source (3.3)\n  const [highlightedLine, setHighlightedLine] = useState(null); // highlighted source line (3.3)\n  const [normalizeMetric, setNormalizeMetric] = useState(true); // unit normalization toggle (4.1)\n  const [batchResults, setBatchResults] = useState(null); // batch import results (5.1)\n  const [batchSelected, setBatchSelected] = useState(new Set()); // selected products for batch import\n  const [urlInput, setUrlInput] = useState(''); // URL import (2.1)\n  const [urlLoading, setUrlLoading] = useState(false);\n  const [diffResults, setDiffResults] = useState(null); // re-import diff (5.2)\n  const [communityAliases, setCommunityAliases] = useState(null); // Map from fetchCommunityAliases (5.3)\n  const [ocrProgress, setOcrProgress] = useState(null); // null = idle, 0-1 = in progress (2.3)\n  const textareaRef = useRef(null);\n  const fileInputRef = useRef(null);\n  const sourceRef = useRef(null);\n\n  const confidenceThresholds = { strict: 85, balanced: 60, aggressive: 50 };\n\n  // Paste history (3.4)  stored in sessionStorage\n  const HISTORY_KEY = 'sims_smart_paste_history';\n  const MAX_HISTORY = 5;\n\n  const getPasteHistory = useCallback(() => {\n    try {\n      return JSON.parse(sessionStorage.getItem(HISTORY_KEY) || '[]');\n    } catch { return []; }\n  }, []);\n\n  const savePasteHistory = useCallback((text, resultSummary) => {\n    try {\n      const history = getPasteHistory();\n      const entry = {\n        text: text.slice(0, 500), // truncate for storage\n        fullText: text,\n        matchedCount: resultSummary.matchedCount,\n        name: resultSummary.name || 'Unknown product',\n        timestamp: Date.now(),\n      };\n      // Deduplicate by text content\n      const filtered = history.filter(h => h.text !== entry.text);\n      filtered.unshift(entry);\n      sessionStorage.setItem(HISTORY_KEY, JSON.stringify(filtered.slice(0, MAX_HISTORY)));\n    } catch { /* sessionStorage full or unavailable */ }\n  }, [getPasteHistory]);\n\n  const [pasteHistory, setPasteHistory] = useState(() => {\n    try { return JSON.parse(sessionStorage.getItem(HISTORY_KEY) || '[]'); } catch { return []; }\n  });\n\n  useEffect(() => {\n    if (inputMode === 'paste') textareaRef.current?.focus();\n  }, [inputMode]);\n\n  // Load community aliases on mount (5.3) + cleanup OCR on unmount (2.3)\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      try {\n        const supabase = await getSupabase();\n        const aliases = await fetchCommunityAliases(supabase);\n        if (!cancelled) setCommunityAliases(aliases);\n      } catch {\n        // Community aliases not available  parser works fine without them\n      }\n    })();\n    return () => {\n      cancelled = true;\n      terminateOCR(); // Free OCR worker memory on unmount\n    };\n  }, []);\n\n  // Build full list of spec field names across all categories\n  const allSpecFields = specs ? [...new Set(\n    Object.values(specs).flatMap(specList =>\n      Array.isArray(specList) ? specList.map(s => s.name) : []\n    )\n  )] : [];\n\n  // Available categories for the override dropdown (3.2)\n  const availableCategories = specs ? Object.keys(specs).sort() : [];\n\n  // Build required fields set\n  const requiredFields = new Set();\n  if (specs) {\n    Object.values(specs).forEach(specList => {\n      if (!Array.isArray(specList)) return;\n      specList.forEach(s => { if (s.required) requiredFields.add(s.name); });\n    });\n  }\n\n  // Get fields for the detected category\n  const getCategoryFields = useCallback((categoryName) => {\n    if (!specs || !categoryName || !specs[categoryName]) return [];\n    return specs[categoryName];\n  }, [specs]);\n\n  // -------------------------------------------------------------------------\n  // Handlers\n  // -------------------------------------------------------------------------\n  const handleParse = useCallback(() => {\n    if (!inputText.trim()) return;\n    const parseOpts = communityAliases ? { communityAliases } : {};\n\n    // Check for multi-product content (5.1)\n    const segments = detectProductBoundaries(inputText);\n    if (segments.length > 1) {\n      const batch = parseBatchProducts(inputText, specs, parseOpts);\n      setBatchResults(batch);\n      setBatchSelected(new Set(batch.map((_, i) => i)));\n      setParseResult(null);\n      setSelectedValues({});\n      setManualMappings({});\n      setBrandOverride(null);\n      setCategoryOverride(null);\n      setHighlightedLine(null);\n      setDiffResults(null);\n      setImportStatus(`Detected ${batch.length} products`);\n      return;\n    }\n\n    // Single product\n    setBatchResults(null);\n    setDiffResults(null);\n    const result = parseProductText(inputText, specs, parseOpts);\n    setParseResult(result);\n    setSelectedValues({});\n    setManualMappings({});\n    setBrandOverride(null);\n    setCategoryOverride(null);\n    setHighlightedLine(null);\n    setImportStatus('');\n    // Save to paste history (3.4)\n    const matchCount = [...result.fields.values()].filter(f => f.value).length;\n    savePasteHistory(inputText, { matchedCount: matchCount, name: result.name });\n    setPasteHistory(getPasteHistory());\n  }, [inputText, specs, communityAliases, savePasteHistory, getPasteHistory]);\n\n  const IMAGE_EXTENSIONS = ['png', 'jpg', 'jpeg', 'webp', 'tiff', 'tif', 'bmp'];\n\n  const handleFileImport = useCallback(async (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setImportStatus('loading');\n    try {\n      let text;\n      const ext = file.name.toLowerCase().split('.').pop();\n\n      if (IMAGE_EXTENSIONS.includes(ext)) {\n        // OCR path (2.3)\n        setOcrProgress(0);\n        setImportStatus('ocr:Running OCR  loading engine...');\n        try {\n          const ocrResult = await ocrImage(file, (progress) => {\n            setOcrProgress(progress);\n            if (progress < 0.2) {\n              setImportStatus('ocr:Loading OCR engine...');\n            } else if (progress < 0.9) {\n              setImportStatus(`ocr:Recognizing text... ${Math.round(progress * 100)}%`);\n            } else {\n              setImportStatus('ocr:Finishing up...');\n            }\n          });\n          text = ocrResult.text;\n          const confLabel = ocrResult.confidence >= 80 ? 'high' : ocrResult.confidence >= 50 ? 'medium' : 'low';\n          setImportStatus(`success:OCR complete  ${confLabel} confidence (${Math.round(ocrResult.confidence)}%), ${text.split('\\n').length} lines`);\n        } finally {\n          setOcrProgress(null);\n        }\n      } else if (ext === 'pdf') {\n        text = await readPdfFile(file);\n      } else if (['txt', 'text', 'csv', 'tsv', 'md', 'rtf'].includes(ext)) {\n        text = await readTextFile(file);\n      } else {\n        text = await readTextFile(file);\n      }\n\n      if (!text || !text.trim()) {\n        setImportStatus('error:No text content found in file');\n        return;\n      }\n\n      setInputText(text);\n      if (!IMAGE_EXTENSIONS.includes(ext)) {\n        setImportStatus(`success:Imported ${file.name} (${text.split('\\n').length} lines)`);\n      }\n\n      const result = parseProductText(text, specs, communityAliases ? { communityAliases } : {});\n      setParseResult(result);\n      setSelectedValues({});\n      setManualMappings({});\n      setBrandOverride(null);\n      setCategoryOverride(null);\n    } catch (err) {\n      logError('File import error:', err);\n      setImportStatus(`error:${err.message || 'Failed to read file'}`);\n      setOcrProgress(null);\n    }\n\n    if (fileInputRef.current) fileInputRef.current.value = '';\n  }, [specs, communityAliases]);\n\n  const handleSelectValue = useCallback((specName, value) => {\n    setSelectedValues(prev => ({ ...prev, [specName]: value }));\n  }, []);\n\n  const handleClearField = useCallback((specName) => {\n    setSelectedValues(prev => ({ ...prev, [specName]: '' }));\n  }, []);\n\n  // Manual mapping handler (1.1)\n  const handleManualMapping = useCallback((unmatchedIdx, specName, value) => {\n    setManualMappings(prev => {\n      const next = { ...prev };\n      if (!specName) {\n        delete next[unmatchedIdx];\n      } else {\n        next[unmatchedIdx] = specName;\n      }\n      return next;\n    });\n    // Also store the value in selectedValues under _manualMappings\n    setSelectedValues(prev => {\n      const mappings = { ...(prev._manualMappings || {}) };\n      if (!specName) {\n        // Find and remove old mapping for this index\n        for (const [key, val] of Object.entries(prev)) {\n          if (key === '_manualMappings') continue;\n        }\n      } else {\n        mappings[specName] = value;\n      }\n      return { ...prev, _manualMappings: mappings };\n    });\n\n    // Record community alias (5.3)  async, fire and forget\n    if (specName && parseResult?.unmatchedPairs?.[unmatchedIdx]) {\n      const sourceKey = parseResult.unmatchedPairs[unmatchedIdx].key;\n      const category = categoryOverride || parseResult?.category || null;\n      getSupabase()\n        .then(supabase => recordAlias(supabase, sourceKey, specName, category))\n        .catch(() => {}); // Silent fail  community aliases are optional\n    }\n  }, [parseResult, categoryOverride]);\n\n  // Restore from paste history (3.4)\n  const handleRestoreHistory = useCallback((entry) => {\n    setInputText(entry.fullText || entry.text);\n    setParseResult(null);\n    setSelectedValues({});\n    setManualMappings({});\n    setBrandOverride(null);\n    setCategoryOverride(null);\n    setImportStatus(`Restored: ${entry.name}`);\n  }, []);\n\n  // Highlight source line from field click (3.3)\n  const handleHighlightLine = useCallback((lineIndex) => {\n    setHighlightedLine(lineIndex);\n    setShowSourceView(true);\n    // Scroll to the line in the source panel\n    setTimeout(() => {\n      const el = document.getElementById(`source-line-${lineIndex}`);\n      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 50);\n  }, []);\n\n  // Clipboard HTML preservation (2.2)  intercept paste and prefer text/html\n  const handlePaste = useCallback((e) => {\n    const clipboardData = e.clipboardData;\n    if (!clipboardData) return;\n\n    // Check if HTML is available (browser copy often includes rich HTML)\n    if (clipboardData.types.includes('text/html')) {\n      e.preventDefault();\n      const html = clipboardData.getData('text/html');\n      const cleaned = cleanInputText(html);\n      // If HTML cleaning produced more structured content, use it\n      const plainText = clipboardData.getData('text/plain');\n      const htmlLines = cleaned.split('\\n').filter(l => l.trim()).length;\n      const plainLines = plainText.split('\\n').filter(l => l.trim()).length;\n      // Use HTML version if it has more structure (more tab-separated lines)\n      const htmlTabLines = cleaned.split('\\n').filter(l => l.includes('\\t')).length;\n      const plainTabLines = plainText.split('\\n').filter(l => l.includes('\\t')).length;\n      const useHtml = htmlTabLines > plainTabLines || htmlLines >= plainLines;\n      const text = useHtml ? cleaned : plainText;\n      setInputText(text);\n      setParseResult(null);\n      setImportStatus(useHtml ? 'HTML table structure preserved from clipboard' : '');\n    }\n    // Otherwise, let the default paste behavior happen\n  }, []);\n\n  const handleApply = useCallback(() => {\n    if (!parseResult) return;\n    const payload = buildApplyPayload(parseResult, selectedValues);\n    // Apply brand/category overrides (3.2)\n    if (brandOverride !== null) payload.brand = brandOverride;\n    if (categoryOverride !== null) payload.category = categoryOverride;\n    onApply(payload);\n    onClose();\n  }, [parseResult, selectedValues, brandOverride, categoryOverride, onApply, onClose]);\n\n  // Batch apply  sends selected products (5.1)\n  const handleBatchApply = useCallback(() => {\n    if (!batchResults) return;\n    const selected = batchResults\n      .filter((_, i) => batchSelected.has(i))\n      .map(({ result }) => buildApplyPayload(result, {}));\n    if (selected.length > 0) {\n      // onApply receives either a single payload or an array for batch\n      onApply(selected.length === 1 ? selected[0] : selected);\n      onClose();\n    }\n  }, [batchResults, batchSelected, onApply, onClose]);\n\n  // Select a single batch product to view/edit in detail\n  const handleBatchSelectSingle = useCallback((index) => {\n    if (!batchResults?.[index]) return;\n    const { result } = batchResults[index];\n    setParseResult(result);\n    setBatchResults(null);\n    setSelectedValues({});\n    setManualMappings({});\n    setBrandOverride(null);\n    setCategoryOverride(null);\n    setImportStatus(`Viewing: ${result.name || `Product ${index + 1}`}`);\n  }, [batchResults]);\n\n  // URL fetch handler (2.1)\n  const handleUrlFetch = useCallback(async () => {\n    if (!urlInput.trim()) return;\n    setUrlLoading(true);\n    setImportStatus('');\n    try {\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n      const proxyUrl = supabaseUrl ? `${supabaseUrl}/functions/v1/fetch-product-page` : null;\n      const { text } = await fetchProductPage(urlInput, proxyUrl);\n      setInputText(text);\n      setInputMode('paste');\n      setImportStatus(`Fetched content from ${urlInput}`);\n    } catch (e) {\n      setImportStatus(` ${e.message}`);\n    } finally {\n      setUrlLoading(false);\n    }\n  }, [urlInput]);\n\n  // Diff against existing item (5.2)\n  const handleDiffExisting = useCallback((existingSpecs) => {\n    if (!parseResult) return;\n    const diff = diffSpecs(existingSpecs, parseResult.fields);\n    setDiffResults(diff);\n  }, [parseResult]);\n\n  // -------------------------------------------------------------------------\n  // Derived data\n  // -------------------------------------------------------------------------\n  const threshold = confidenceThresholds[confidenceMode] || 60;\n\n  // Filter fields by confidence threshold (3.1)\n  const filteredFields = parseResult ? new Map(\n    [...parseResult.fields.entries()].filter(([, data]) => data.confidence >= threshold)\n  ) : new Map();\n\n  const matchedCount = filteredFields.size + Object.keys(manualMappings).length;\n  const totalExtracted = parseResult ? parseResult.rawExtracted.length : 0;\n  const unmatchedCount = parseResult ? parseResult.unmatchedPairs.length : 0;\n  const altsCount = parseResult\n    ? [...filteredFields.values()].filter(f => f.alternatives && f.alternatives.length > 1).length\n    : 0;\n\n  // Get category-specific spec fields if category detected (respects override  3.2)\n  const detectedCategory = categoryOverride !== null ? categoryOverride : parseResult?.category;\n  const categorySpecFields = detectedCategory ? getCategoryFields(detectedCategory) : [];\n\n  // Build ordered field list: category fields first (in order), then any extra matched fields\n  const orderedFields = [];\n  const addedNames = new Set();\n\n  if (categorySpecFields.length > 0) {\n    for (const spec of categorySpecFields) {\n      const field = filteredFields.get(spec.name);\n      orderedFields.push({\n        specName: spec.name,\n        data: field || null,\n        isRequired: spec.required || false,\n      });\n      addedNames.add(spec.name);\n    }\n  }\n\n  // Add any matched fields not in the detected category\n  if (parseResult) {\n    for (const [specName, data] of filteredFields) {\n      if (!addedNames.has(specName) && data.value) {\n        orderedFields.push({ specName, data, isRequired: false });\n        addedNames.add(specName);\n      }\n    }\n  }\n\n  // Separate into matched and empty\n  const matchedFields = orderedFields.filter(f => {\n    const override = selectedValues[f.specName];\n    const val = override !== undefined ? override : f.data?.value;\n    return val && val.trim();\n  });\n  const emptyFields = orderedFields.filter(f => {\n    const override = selectedValues[f.specName];\n    const val = override !== undefined ? override : f.data?.value;\n    return !val || !val.trim();\n  });\n\n  // Build list of spec fields available for manual mapping (1.1)\n  const mappedSpecNames = new Set([\n    ...matchedFields.map(f => f.specName),\n    ...Object.values(manualMappings),\n  ]);\n  const unmappedSpecOptions = allSpecFields.filter(name => !mappedSpecNames.has(name)).sort();\n\n  // -------------------------------------------------------------------------\n  // Render\n  // -------------------------------------------------------------------------\n  return (\n    <Modal onClose={onClose} maxWidth={showSourceView ? 1200 : 780}>\n      <ModalHeader title=\"Smart Paste  Import Product Info\" onClose={onClose} />\n      <div style={{ padding: spacing[4], maxHeight: '80vh', overflowY: 'auto' }}>\n\n        {/* Instructions */}\n        <p style={{ color: colors.textSecondary, fontSize: typography.fontSize.sm, marginBottom: spacing[3], lineHeight: 1.5 }}>\n          Paste product specifications from a retailer or manufacturer page, or import a PDF/text file.\n          The parser extracts key-value pairs and matches them against your spec fields using\n          direct lookups, abbreviation expansion, and fuzzy matching.\n        </p>\n\n        {/* Spec fields list  always visible */}\n        {allSpecFields.length > 0 && (\n          <div style={{\n            marginBottom: spacing[3],\n            padding: `${spacing[2]}px ${spacing[3]}px`,\n            background: `${withOpacity(colors.primary, 5)}`,\n            borderRadius: borderRadius.md,\n            border: `1px solid ${withOpacity(colors.primary, 15)}`,\n          }}>\n            <div style={{\n              fontSize: typography.fontSize.xs,\n              fontWeight: 700,\n              color: colors.primary,\n              marginBottom: spacing[1],\n              textTransform: 'uppercase',\n              letterSpacing: '0.05em',\n            }}>\n              Matching against {allSpecFields.length} spec fields across all categories\n            </div>\n            <div style={{\n              fontSize: typography.fontSize.xs,\n              color: colors.textMuted,\n              lineHeight: 1.6,\n              maxHeight: 100,\n              overflowY: 'auto',\n              columnCount: 3,\n              columnGap: spacing[3],\n            }}>\n              {allSpecFields.map(name => (\n                <div key={name} style={{\n                  breakInside: 'avoid',\n                  opacity: requiredFields.has(name) ? 1 : 0.7,\n                }}>\n                  {requiredFields.has(name) && <span style={{ color: colors.danger || '#f87171', marginRight: 2 }}>*</span>}\n                  {name}\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Input Method Tabs */}\n        <div style={{\n          display: 'flex',\n          gap: 0,\n          marginBottom: 0,\n          borderBottom: `2px solid ${colors.border}`,\n        }}>\n          {[\n            { key: 'paste', label: 'Paste Text', icon: '' },\n            { key: 'file', label: 'Import File', icon: '' },\n            { key: 'url', label: 'From URL', icon: '' },\n          ].map(tab => {\n            const isActive = inputMode === tab.key;\n            return (\n              <button\n                key={tab.key}\n                onClick={() => setInputMode(tab.key)}\n                style={{\n                  background: 'none',\n                  border: 'none',\n                  borderBottom: isActive\n                    ? `2px solid ${colors.primary}`\n                    : '2px solid transparent',\n                  marginBottom: -2,\n                  padding: `${spacing[2]}px ${spacing[3]}px`,\n                  fontSize: typography.fontSize.sm,\n                  fontWeight: isActive ? 700 : 500,\n                  color: isActive ? colors.primary : colors.textMuted,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: spacing[1],\n                  transition: 'color 0.15s, border-color 0.15s',\n                }}\n              >\n                <span>{tab.icon}</span>\n                {tab.label}\n              </button>\n            );\n          })}\n        </div>\n\n        {/* Import status */}\n        {importStatus && (\n          <div style={{\n            padding: `${spacing[2]}px ${spacing[3]}px`,\n            marginTop: spacing[2],\n            borderRadius: borderRadius.sm,\n            fontSize: typography.fontSize.sm,\n            background: importStatus.startsWith('error')\n              ? `${withOpacity(colors.danger, 10)}`\n              : importStatus.startsWith('success')\n                ? `${withOpacity(colors.available || '#4ade80', 10)}`\n                : `${withOpacity(colors.primary, 10)}`,\n            color: importStatus.startsWith('error')\n              ? colors.danger\n              : importStatus.startsWith('success')\n                ? (colors.available || '#4ade80')\n                : colors.primary,\n          }}>\n            {importStatus.startsWith('loading') ? ' Reading file...' :\n             importStatus.startsWith('error:') ? ` ${importStatus.slice(6)}` :\n             importStatus.startsWith('success:') ? ` ${importStatus.slice(8)}` :\n             importStatus.startsWith('ocr:') ? ` ${importStatus.slice(4)}` :\n             importStatus}\n            {/* OCR progress bar (2.3) */}\n            {ocrProgress !== null && (\n              <div style={{\n                marginTop: spacing[1],\n                height: 4,\n                borderRadius: 2,\n                background: withOpacity(colors.primary, 20),\n                overflow: 'hidden',\n              }}>\n                <div style={{\n                  height: '100%',\n                  width: `${Math.round(ocrProgress * 100)}%`,\n                  background: colors.primary,\n                  borderRadius: 2,\n                  transition: 'width 0.3s ease',\n                }} />\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Paste Text tab */}\n        {inputMode === 'paste' && (\n          <div style={{ marginTop: spacing[2] }}>\n            {/* Paste history (3.4) */}\n            {pasteHistory.length > 0 && !inputText && (\n              <div style={{\n                marginBottom: spacing[2],\n                padding: `${spacing[2]}px ${spacing[3]}px`,\n                background: withOpacity(colors.bgMedium, 50),\n                borderRadius: borderRadius.md,\n                border: `1px solid ${withOpacity(colors.border, 30)}`,\n              }}>\n                <div style={{\n                  fontSize: typography.fontSize.xs,\n                  fontWeight: 600,\n                  color: colors.textMuted,\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: spacing[1],\n                  marginBottom: spacing[1],\n                }}>\n                  \n                  Recent Imports\n                </div>\n                {pasteHistory.map((entry, i) => (\n                  <button\n                    key={i}\n                    onClick={() => handleRestoreHistory(entry)}\n                    style={{\n                      display: 'flex',\n                      width: '100%',\n                      textAlign: 'left',\n                      padding: `${spacing[1]}px ${spacing[2]}px`,\n                      border: 'none',\n                      borderRadius: borderRadius.sm,\n                      background: 'transparent',\n                      cursor: 'pointer',\n                      fontSize: typography.fontSize.xs,\n                      color: colors.textSecondary,\n                      gap: spacing[2],\n                      alignItems: 'center',\n                    }}\n                  >\n                    <span style={{ flex: 1, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>\n                      {entry.name}\n                    </span>\n                    <span style={{ color: colors.primary, fontWeight: 600, flexShrink: 0 }}>\n                      {entry.matchedCount} fields\n                    </span>\n                    <span style={{ color: withOpacity(colors.textMuted, 50), flexShrink: 0 }}>\n                      {new Date(entry.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                    </span>\n                  </button>\n                ))}\n              </div>\n            )}\n            <textarea\n              ref={textareaRef}\n              value={inputText}\n              onChange={e => { setInputText(e.target.value); setParseResult(null); setImportStatus(''); setManualMappings({}); }}\n              onPaste={handlePaste}\n              placeholder={`Paste product specifications here...\\n\\nSupported formats:\\n  Key: Value\\n  Key  Value\\n  Key\\tValue  (tab-separated)\\n  Key = Value\\n  Key | Value\\n\\nHTML table content is automatically cleaned.\\nTip: Copy from a web page to preserve table structure.`}\n              style={{\n                ...styles.input,\n                width: '100%',\n                minHeight: 150,\n                fontFamily: 'ui-monospace, \"SF Mono\", \"Cascadia Code\", Menlo, monospace',\n                fontSize: typography.fontSize.sm,\n                resize: 'vertical',\n                lineHeight: 1.5,\n              }}\n            />\n          </div>\n        )}\n\n        {/* Import File tab */}\n        {inputMode === 'file' && (\n          <div style={{ marginTop: spacing[2] }}>\n            {/* Drop zone */}\n            <div\n              onDragOver={e => { e.preventDefault(); e.stopPropagation(); setDragOver(true); }}\n              onDragLeave={() => setDragOver(false)}\n              onDrop={e => {\n                e.preventDefault();\n                e.stopPropagation();\n                setDragOver(false);\n                const file = e.dataTransfer?.files?.[0];\n                if (file) handleFileImport({ target: { files: [file] } });\n              }}\n              onClick={() => fileInputRef.current?.click()}\n              style={{\n                border: `2px dashed ${dragOver ? colors.primary : colors.border}`,\n                borderRadius: borderRadius.lg,\n                padding: `${spacing[6]}px ${spacing[4]}px`,\n                textAlign: 'center',\n                cursor: 'pointer',\n                background: dragOver\n                  ? withOpacity(colors.primary, 8)\n                  : withOpacity(colors.bgMedium, 50),\n                transition: 'border-color 0.15s, background 0.15s',\n              }}\n            >\n              <Upload size={32} style={{\n                color: dragOver ? colors.primary : colors.textMuted,\n                margin: '0 auto',\n                display: 'block',\n                marginBottom: spacing[2],\n                opacity: 0.6,\n              }} />\n              <div style={{\n                fontSize: typography.fontSize.base,\n                fontWeight: 600,\n                color: colors.textPrimary,\n                marginBottom: spacing[1],\n              }}>\n                Drop a file here or click to browse\n              </div>\n              <div style={{\n                fontSize: typography.fontSize.sm,\n                color: colors.textMuted,\n              }}>\n                PDF, TXT, CSV, TSV, Markdown, RTF, or Images (OCR)\n              </div>\n            </div>\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\".pdf,.txt,.text,.csv,.tsv,.md,.rtf,.png,.jpg,.jpeg,.webp,.tiff,.tif,.bmp\"\n              onChange={handleFileImport}\n              style={{ display: 'none' }}\n            />\n\n            {/* Show imported text preview if file was loaded */}\n            {inputText && (\n              <div style={{ marginTop: spacing[2] }}>\n                <div style={{\n                  fontSize: typography.fontSize.xs,\n                  fontWeight: 600,\n                  color: colors.textMuted,\n                  marginBottom: spacing[1],\n                  textTransform: 'uppercase',\n                  letterSpacing: '0.05em',\n                }}>\n                  Imported Content Preview\n                </div>\n                <div style={{\n                  ...styles.input,\n                  width: '100%',\n                  maxHeight: 120,\n                  overflowY: 'auto',\n                  fontFamily: 'ui-monospace, \"SF Mono\", \"Cascadia Code\", Menlo, monospace',\n                  fontSize: typography.fontSize.xs,\n                  lineHeight: 1.5,\n                  whiteSpace: 'pre-wrap',\n                  color: colors.textMuted,\n                  padding: spacing[2],\n                }}>\n                  {inputText.slice(0, 2000)}{inputText.length > 2000 ? '\\n...' : ''}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* URL Import tab (2.1) */}\n        {inputMode === 'url' && (\n          <div style={{ marginTop: spacing[2] }}>\n            <div style={{\n              fontSize: typography.fontSize.xs,\n              color: colors.textMuted,\n              marginBottom: spacing[2],\n            }}>\n              Enter a product page URL to fetch and parse specs automatically.\n              Supported sites include B&H, Adorama, manufacturer pages, and Amazon.\n            </div>\n            <div style={{ display: 'flex', gap: spacing[2], alignItems: 'center' }}>\n              <input\n                type=\"url\"\n                value={urlInput}\n                onChange={e => setUrlInput(e.target.value)}\n                placeholder=\"https://www.bhphotovideo.com/c/product/...\"\n                style={{\n                  ...styles.input,\n                  flex: 1,\n                  fontSize: typography.fontSize.sm,\n                  padding: `${spacing[2]}px ${spacing[3]}px`,\n                }}\n              />\n              <Button\n                variant=\"secondary\"\n                onClick={handleUrlFetch}\n                disabled={!urlInput.trim() || urlLoading}\n                icon={FileText}\n              >\n                {urlLoading ? 'Fetching...' : 'Fetch'}\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* Parse button + summary */}\n        <div style={{ display: 'flex', gap: spacing[2], marginTop: spacing[3], marginBottom: spacing[3], alignItems: 'center', flexWrap: 'wrap' }}>\n          <Button variant=\"secondary\" onClick={handleParse} disabled={!inputText.trim()} icon={FileText}>\n            Parse Text\n          </Button>\n          {/* Batch results indicator (5.1) */}\n          {batchResults && (\n            <span style={{ fontSize: typography.fontSize.sm, color: colors.primary, fontWeight: 600 }}>\n              \n              {batchResults.length} products detected\n            </span>\n          )}\n          {parseResult && (\n            <span style={{ fontSize: typography.fontSize.sm, color: colors.textMuted }}>\n              Extracted <strong style={{ color: colors.textPrimary }}>{totalExtracted}</strong> pairs\n              {'  '}<strong style={{ color: colors.primary }}>{matchedCount}</strong> matched\n              {altsCount > 0 && (\n                <>, <strong style={{ color: colors.accent1 || '#facc15' }}>{altsCount}</strong> with alternatives</>\n              )}\n              {unmatchedCount > 0 && (\n                <>, <strong style={{ color: colors.textMuted }}>{unmatchedCount}</strong> unmatched</>\n              )}\n            </span>\n          )}\n        </div>\n\n        {/* Confidence threshold control (3.1) */}\n        {parseResult && (\n          <div style={{\n            display: 'flex',\n            gap: spacing[1],\n            marginBottom: spacing[3],\n            alignItems: 'center',\n          }}>\n            <span style={{\n              fontSize: typography.fontSize.xs,\n              fontWeight: 600,\n              color: colors.textMuted,\n              marginRight: spacing[1],\n            }}>\n              Match Confidence:\n            </span>\n            {[\n              { key: 'strict', label: 'Strict', desc: '85  only high-confidence matches' },\n              { key: 'balanced', label: 'Balanced', desc: '60  recommended for most input' },\n              { key: 'aggressive', label: 'Aggressive', desc: '50  catch more at lower accuracy' },\n            ].map(mode => {\n              const isActive = confidenceMode === mode.key;\n              return (\n                <button\n                  key={mode.key}\n                  onClick={() => setConfidenceMode(mode.key)}\n                  title={mode.desc}\n                  style={{\n                    padding: `3px ${spacing[2]}px`,\n                    fontSize: typography.fontSize.xs,\n                    fontWeight: isActive ? 700 : 500,\n                    border: `1px solid ${isActive ? colors.primary : withOpacity(colors.border, 50)}`,\n                    borderRadius: borderRadius.sm,\n                    background: isActive ? withOpacity(colors.primary, 15) : 'transparent',\n                    color: isActive ? colors.primary : colors.textMuted,\n                    cursor: 'pointer',\n                    transition: 'all 0.15s',\n                  }}\n                >\n                  {mode.label}\n                </button>\n              );\n            })}\n\n            {/* Spacer */}\n            <span style={{ flex: 1 }} />\n\n            {/* Unit normalization toggle (4.1) */}\n            <button\n              onClick={() => setNormalizeMetric(prev => !prev)}\n              title={normalizeMetric ? 'Showing metric conversions' : 'Unit normalization off'}\n              style={{\n                padding: `3px ${spacing[2]}px`,\n                fontSize: typography.fontSize.xs,\n                fontWeight: normalizeMetric ? 700 : 500,\n                border: `1px solid ${normalizeMetric ? colors.primary : withOpacity(colors.border, 50)}`,\n                borderRadius: borderRadius.sm,\n                background: normalizeMetric ? withOpacity(colors.primary, 15) : 'transparent',\n                color: normalizeMetric ? colors.primary : colors.textMuted,\n                cursor: 'pointer',\n                transition: 'all 0.15s',\n                whiteSpace: 'nowrap',\n              }}\n            >\n              Units\n            </button>\n\n            {/* Source view toggle (3.3) */}\n            <button\n              onClick={() => setShowSourceView(prev => !prev)}\n              title={showSourceView ? 'Hide source text' : 'Show source text alongside results'}\n              style={{\n                padding: `3px ${spacing[2]}px`,\n                fontSize: typography.fontSize.xs,\n                fontWeight: showSourceView ? 700 : 500,\n                border: `1px solid ${showSourceView ? colors.primary : withOpacity(colors.border, 50)}`,\n                borderRadius: borderRadius.sm,\n                background: showSourceView ? withOpacity(colors.primary, 15) : 'transparent',\n                color: showSourceView ? colors.primary : colors.textMuted,\n                cursor: 'pointer',\n                transition: 'all 0.15s',\n                display: 'flex',\n                alignItems: 'center',\n                gap: 4,\n                whiteSpace: 'nowrap',\n              }}\n            >\n               Source\n            </button>\n          </div>\n        )}\n\n        {/* ================================================================= */}\n        {/* Batch Product Selection (5.1) */}\n        {/* ================================================================= */}\n        {batchResults && (\n          <div style={{\n            background: colors.bgLight,\n            borderRadius: borderRadius.lg,\n            border: `1px solid ${colors.border}`,\n            overflow: 'hidden',\n            marginBottom: spacing[3],\n          }}>\n            <div style={{\n              padding: `${spacing[2]}px ${spacing[3]}px`,\n              borderBottom: `1px solid ${colors.border}`,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between',\n            }}>\n              <div style={{\n                fontSize: typography.fontSize.xs,\n                fontWeight: 700,\n                textTransform: 'uppercase',\n                letterSpacing: '0.06em',\n                color: colors.textMuted,\n                display: 'flex',\n                alignItems: 'center',\n                gap: spacing[1],\n              }}>\n                \n                Detected Products ({batchResults.length})\n              </div>\n              <div style={{ display: 'flex', gap: spacing[1] }}>\n                <button\n                  onClick={() => setBatchSelected(new Set(batchResults.map((_, i) => i)))}\n                  style={{\n                    background: 'none', border: 'none', cursor: 'pointer',\n                    fontSize: typography.fontSize.xs, color: colors.primary, fontWeight: 600,\n                  }}\n                >Select All</button>\n                <button\n                  onClick={() => setBatchSelected(new Set())}\n                  style={{\n                    background: 'none', border: 'none', cursor: 'pointer',\n                    fontSize: typography.fontSize.xs, color: colors.textMuted,\n                  }}\n                >Clear</button>\n              </div>\n            </div>\n            {batchResults.map(({ segment, result }, i) => {\n              const isSelected = batchSelected.has(i);\n              const fieldCount = [...result.fields.values()].filter(f => f.value).length;\n              return (\n                <div\n                  key={i}\n                  style={{\n                    padding: `${spacing[2]}px ${spacing[3]}px`,\n                    borderBottom: `1px solid ${withOpacity(colors.border, 30)}`,\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: spacing[2],\n                    background: isSelected ? withOpacity(colors.primary, 5) : 'transparent',\n                  }}\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={isSelected}\n                    onChange={() => {\n                      const next = new Set(batchSelected);\n                      if (isSelected) next.delete(i); else next.add(i);\n                      setBatchSelected(next);\n                    }}\n                    style={{ cursor: 'pointer', flexShrink: 0 }}\n                  />\n                  <div style={{ flex: 1, minWidth: 0 }}>\n                    <div style={{\n                      fontSize: typography.fontSize.sm,\n                      fontWeight: 600,\n                      color: colors.textPrimary,\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis',\n                      whiteSpace: 'nowrap',\n                    }}>\n                      {result.name || segment.name}\n                    </div>\n                    <div style={{ fontSize: typography.fontSize.xs, color: colors.textMuted }}>\n                      {result.brand && <span>{result.brand}  </span>}\n                      {result.category && <span>{result.category}  </span>}\n                      <span>{fieldCount} fields matched</span>\n                      {result.purchasePrice && <span>  ${result.purchasePrice}</span>}\n                    </div>\n                  </div>\n                  <button\n                    onClick={() => handleBatchSelectSingle(i)}\n                    title=\"View & edit this product in detail\"\n                    style={{\n                      background: withOpacity(colors.primary, 10),\n                      border: `1px solid ${withOpacity(colors.primary, 30)}`,\n                      borderRadius: borderRadius.sm,\n                      cursor: 'pointer',\n                      color: colors.primary,\n                      padding: `2px ${spacing[2]}px`,\n                      fontSize: typography.fontSize.xs,\n                      fontWeight: 600,\n                      whiteSpace: 'nowrap',\n                      flexShrink: 0,\n                    }}\n                  >\n                    Edit\n                  </button>\n                </div>\n              );\n            })}\n            <div style={{\n              padding: `${spacing[2]}px ${spacing[3]}px`,\n              display: 'flex',\n              justifyContent: 'flex-end',\n            }}>\n              <Button\n                onClick={handleBatchApply}\n                disabled={batchSelected.size === 0}\n              >\n                Import {batchSelected.size} Product{batchSelected.size !== 1 ? 's' : ''}\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* ================================================================= */}\n        {/* Results (with optional source view  3.3) */}\n        {/* ================================================================= */}\n        {parseResult && (\n          <div style={{\n            display: showSourceView ? 'grid' : 'block',\n            gridTemplateColumns: showSourceView ? '1fr 1fr' : '1fr',\n            gap: showSourceView ? spacing[3] : 0,\n            marginBottom: spacing[3],\n          }}>\n            {/* Source panel (3.3) */}\n            {showSourceView && parseResult.sourceLines && (\n              <div\n                ref={sourceRef}\n                style={{\n                  background: colors.bgMedium,\n                  borderRadius: borderRadius.lg,\n                  border: `1px solid ${colors.border}`,\n                  overflow: 'hidden',\n                  maxHeight: 600,\n                  overflowY: 'auto',\n                }}\n              >\n                <div style={{\n                  padding: `${spacing[2]}px ${spacing[3]}px`,\n                  borderBottom: `1px solid ${colors.border}`,\n                  position: 'sticky',\n                  top: 0,\n                  background: colors.bgMedium,\n                  zIndex: 1,\n                }}>\n                  <div style={{\n                    fontSize: typography.fontSize.xs,\n                    fontWeight: 700,\n                    textTransform: 'uppercase',\n                    letterSpacing: '0.06em',\n                    color: colors.textMuted,\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: spacing[1],\n                  }}>\n                    <FileText size={11} />\n                    Source Text ({parseResult.sourceLines.length} lines)\n                  </div>\n                </div>\n                <div style={{ padding: `${spacing[1]}px 0` }}>\n                  {parseResult.sourceLines.map((line, i) => {\n                    // Check if this line was matched to any field\n                    const isMatched = [...parseResult.fields.values()].some(f => f.lineIndex === i);\n                    const isUnmatched = parseResult.unmatchedPairs.some(p => p.lineIndex === i);\n                    const isHighlighted = highlightedLine === i;\n                    return (\n                      <div\n                        key={i}\n                        id={`source-line-${i}`}\n                        style={{\n                          padding: `1px ${spacing[3]}px`,\n                          fontSize: 11,\n                          fontFamily: 'ui-monospace, \"SF Mono\", \"Cascadia Code\", Menlo, monospace',\n                          lineHeight: 1.6,\n                          whiteSpace: 'pre-wrap',\n                          wordBreak: 'break-word',\n                          background: isHighlighted\n                            ? withOpacity(colors.primary, 20)\n                            : isMatched\n                              ? withOpacity(colors.available || '#4ade80', 8)\n                              : 'transparent',\n                          color: isMatched\n                            ? colors.textSecondary\n                            : isUnmatched\n                              ? colors.textMuted\n                              : withOpacity(colors.textMuted, 40),\n                          borderLeft: isHighlighted\n                            ? `3px solid ${colors.primary}`\n                            : isMatched\n                              ? `3px solid ${withOpacity(colors.available || '#4ade80', 40)}`\n                              : isUnmatched\n                                ? `3px solid ${withOpacity(colors.accent1 || '#facc15', 30)}`\n                                : '3px solid transparent',\n                          transition: 'background 0.3s, border-color 0.3s',\n                        }}\n                      >\n                        {line || '\\u00A0'}\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            {/* Results panel */}\n            <div style={{\n              background: colors.bgLight,\n              borderRadius: borderRadius.lg,\n              border: `1px solid ${colors.border}`,\n              overflow: 'hidden',\n              maxHeight: showSourceView ? 600 : 'none',\n              overflowY: showSourceView ? 'auto' : 'visible',\n            }}>\n            {/* Basic Info Section  editable brand/category (3.2) */}\n            <div style={{\n              padding: `${spacing[3]}px ${spacing[3]}px ${spacing[2]}px`,\n              borderBottom: `1px solid ${colors.border}`,\n            }}>\n              <div style={{\n                fontSize: typography.fontSize.xs,\n                fontWeight: 700,\n                textTransform: 'uppercase',\n                letterSpacing: '0.06em',\n                color: colors.textMuted,\n                marginBottom: spacing[2],\n              }}>\n                Basic Information\n              </div>\n\n              {/* Name  read only */}\n              <BasicInfoRow label=\"Name\" value={parseResult.name} />\n\n              {/* Brand  editable (3.2) */}\n              <div style={{\n                display: 'grid',\n                gridTemplateColumns: '80px 1fr',\n                gap: spacing[2],\n                padding: `${spacing[1]}px 0`,\n                fontSize: typography.fontSize.sm,\n                alignItems: 'center',\n              }}>\n                <span style={{ fontWeight: 600, color: colors.textPrimary }}>Brand</span>\n                <div style={{ display: 'flex', alignItems: 'center', gap: spacing[1] }}>\n                  <input\n                    type=\"text\"\n                    value={brandOverride !== null ? brandOverride : (parseResult.brand || '')}\n                    onChange={e => setBrandOverride(e.target.value)}\n                    placeholder=\"Not detected  type to set\"\n                    style={{\n                      ...styles.input,\n                      fontSize: typography.fontSize.sm,\n                      padding: `2px ${spacing[2]}px`,\n                      flex: 1,\n                      minWidth: 0,\n                    }}\n                  />\n                  {brandOverride !== null && brandOverride !== parseResult.brand && (\n                    <button\n                      onClick={() => setBrandOverride(null)}\n                      title=\"Reset to detected\"\n                      style={{\n                        background: 'none', border: 'none', cursor: 'pointer',\n                        color: colors.textMuted, padding: 2, display: 'flex',\n                      }}\n                    >\n                      <XIcon size={12} />\n                    </button>\n                  )}\n                </div>\n              </div>\n\n              {/* Category  editable dropdown (3.2) */}\n              <div style={{\n                display: 'grid',\n                gridTemplateColumns: '80px 1fr',\n                gap: spacing[2],\n                padding: `${spacing[1]}px 0`,\n                fontSize: typography.fontSize.sm,\n                alignItems: 'center',\n              }}>\n                <span style={{ fontWeight: 600, color: colors.textPrimary }}>Category</span>\n                <div style={{ display: 'flex', alignItems: 'center', gap: spacing[1] }}>\n                  <select\n                    value={categoryOverride !== null ? categoryOverride : (parseResult.category || '')}\n                    onChange={e => setCategoryOverride(e.target.value || null)}\n                    style={{\n                      ...styles.input,\n                      fontSize: typography.fontSize.sm,\n                      padding: `2px ${spacing[2]}px`,\n                      flex: 1,\n                      minWidth: 0,\n                      cursor: 'pointer',\n                      color: (categoryOverride || parseResult.category) ? colors.textSecondary : withOpacity(colors.textMuted, 40),\n                    }}\n                  >\n                    <option value=\"\">Not detected</option>\n                    {availableCategories.map(cat => (\n                      <option key={cat} value={cat}>{cat}</option>\n                    ))}\n                  </select>\n                  {categoryOverride !== null && categoryOverride !== parseResult.category && (\n                    <button\n                      onClick={() => setCategoryOverride(null)}\n                      title=\"Reset to detected\"\n                      style={{\n                        background: 'none', border: 'none', cursor: 'pointer',\n                        color: colors.textMuted, padding: 2, display: 'flex',\n                      }}\n                    >\n                      <XIcon size={12} />\n                    </button>\n                  )}\n                </div>\n              </div>\n\n              {/* Price, Model, Serial  read only */}\n              <BasicInfoRow\n                label=\"Price\"\n                value={parseResult.purchasePrice ? `$${parseResult.purchasePrice}${parseResult.priceNote ? ` (${parseResult.priceNote})` : ''}` : ''}\n              />\n              {parseResult.modelNumber && <BasicInfoRow label=\"Model #\" value={parseResult.modelNumber} />}\n              {parseResult.serialNumber && <BasicInfoRow label=\"Serial #\" value={parseResult.serialNumber} />}\n            </div>\n\n            {/* Matched Specs Section */}\n            {matchedFields.length > 0 && (\n              <div style={{ padding: `${spacing[3]}px` }}>\n                <div style={{\n                  fontSize: typography.fontSize.xs,\n                  fontWeight: 700,\n                  textTransform: 'uppercase',\n                  letterSpacing: '0.06em',\n                  color: colors.textMuted,\n                  marginBottom: spacing[2],\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: spacing[2],\n                }}>\n                  <span>Matched Specifications ({matchedFields.length})</span>\n                  <Check size={12} style={{ color: colors.available || '#4ade80' }} />\n                </div>\n\n                {matchedFields.map(({ specName, data, isRequired }) => {\n                  const currentVal = selectedValues[specName] !== undefined ? selectedValues[specName] : data?.value;\n                  const unitInfo = normalizeMetric && currentVal ? normalizeUnits(currentVal, normalizeMetric) : null;\n                  const coercionInfo = currentVal ? coerceFieldValue(specName, currentVal) : null;\n                  return (\n                    <FieldRow\n                      key={specName}\n                      specName={specName}\n                      fieldData={data}\n                      selectedValue={selectedValues[specName]}\n                      onSelect={handleSelectValue}\n                      onClear={handleClearField}\n                      isRequired={isRequired}\n                      onLineClick={handleHighlightLine}\n                      unitInfo={unitInfo}\n                      coercionInfo={coercionInfo}\n                    />\n                  );\n                })}\n              </div>\n            )}\n\n            {/* Empty fields section */}\n            {emptyFields.length > 0 && (\n              <div style={{\n                padding: `${spacing[2]}px ${spacing[3]}px`,\n                borderTop: `1px solid ${colors.border}`,\n              }}>\n                <button\n                  onClick={() => setShowEmptyFields(!showEmptyFields)}\n                  style={{\n                    background: 'none',\n                    border: 'none',\n                    cursor: 'pointer',\n                    color: colors.textMuted,\n                    fontSize: typography.fontSize.xs,\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: spacing[1],\n                    padding: `${spacing[1]}px 0`,\n                    fontWeight: 600,\n                  }}\n                >\n                  {showEmptyFields ? <ChevronUp size={12} /> : <ChevronDown size={12} />}\n                  {emptyFields.length} fields with no match\n                  {detectedCategory && <span style={{ fontWeight: 400, marginLeft: 4 }}>({detectedCategory})</span>}\n                </button>\n                {showEmptyFields && (\n                  <div style={{\n                    marginTop: spacing[1],\n                    fontSize: typography.fontSize.xs,\n                    color: withOpacity(colors.textMuted, 50),\n                    lineHeight: 2,\n                    columnCount: 2,\n                    columnGap: spacing[4],\n                  }}>\n                    {emptyFields.map(({ specName, isRequired }) => (\n                      <div key={specName} style={{ breakInside: 'avoid', display: 'flex', gap: 4 }}>\n                        <span style={{ opacity: 0.5 }}></span>\n                        <span>{specName}</span>\n                        {isRequired && <span style={{ color: colors.danger || '#f87171' }}>*</span>}\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Unmatched pairs with manual mapping (1.1) */}\n            {parseResult.unmatchedPairs.length > 0 && (\n              <div style={{\n                padding: `${spacing[2]}px ${spacing[3]}px`,\n                borderTop: `1px solid ${colors.border}`,\n              }}>\n                <button\n                  onClick={() => setShowUnmatched(!showUnmatched)}\n                  style={{\n                    background: 'none',\n                    border: 'none',\n                    cursor: 'pointer',\n                    color: colors.textMuted,\n                    fontSize: typography.fontSize.xs,\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: spacing[1],\n                    padding: `${spacing[1]}px 0`,\n                    fontWeight: 600,\n                  }}\n                >\n                  <AlertCircle size={12} />\n                  {showUnmatched ? <ChevronUp size={12} /> : <ChevronDown size={12} />}\n                  {parseResult.unmatchedPairs.length} extracted but not matched\n                  {Object.keys(manualMappings).length > 0 && (\n                    <span style={{\n                      marginLeft: 6,\n                      fontSize: 10,\n                      fontWeight: 600,\n                      padding: '1px 6px',\n                      borderRadius: 4,\n                      background: withOpacity(colors.primary, 15),\n                      color: colors.primary,\n                    }}>\n                      {Object.keys(manualMappings).length} mapped\n                    </span>\n                  )}\n                </button>\n                {showUnmatched && (\n                  <div style={{\n                    marginTop: spacing[2],\n                    fontSize: typography.fontSize.sm,\n                    color: colors.textMuted,\n                    lineHeight: 1.6,\n                  }}>\n                    <div style={{\n                      fontSize: typography.fontSize.xs,\n                      color: withOpacity(colors.textMuted, 60),\n                      marginBottom: spacing[2],\n                      fontStyle: 'italic',\n                    }}>\n                      Use the dropdowns to manually assign unmatched pairs to spec fields.\n                    </div>\n                    {parseResult.unmatchedPairs.map((pair, i) => {\n                      const mappedTo = manualMappings[i];\n                      return (\n                        <div key={i} style={{\n                          padding: `4px 0`,\n                          display: 'grid',\n                          gridTemplateColumns: '1fr 1.2fr 1fr',\n                          gap: spacing[2],\n                          alignItems: 'center',\n                          borderBottom: `1px solid ${withOpacity(colors.border, 20)}`,\n                        }}>\n                          <span style={{ fontWeight: 600, color: colors.textSecondary }}>{pair.key}</span>\n                          <span style={{ color: withOpacity(colors.textMuted, 70) }}>{pair.value}</span>\n                          <select\n                            value={mappedTo || ''}\n                            onChange={e => handleManualMapping(i, e.target.value, pair.value)}\n                            style={{\n                              ...styles.input,\n                              fontSize: typography.fontSize.xs,\n                              padding: `2px ${spacing[1]}px`,\n                              color: mappedTo ? colors.primary : colors.textMuted,\n                              cursor: 'pointer',\n                            }}\n                          >\n                            <option value=\"\"> Assign to field </option>\n                            {unmappedSpecOptions.map(name => (\n                              <option key={name} value={name}>{name}</option>\n                            ))}\n                          </select>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n          </div>\n        )}\n\n        {/* ================================================================= */}\n        {/* Diff View (5.2)  shown when comparing against existing item */}\n        {/* ================================================================= */}\n        {diffResults && (\n          <div style={{\n            background: colors.bgLight,\n            borderRadius: borderRadius.lg,\n            border: `1px solid ${colors.border}`,\n            overflow: 'hidden',\n            marginBottom: spacing[3],\n          }}>\n            <div style={{\n              padding: `${spacing[2]}px ${spacing[3]}px`,\n              borderBottom: `1px solid ${colors.border}`,\n              fontSize: typography.fontSize.xs,\n              fontWeight: 700,\n              textTransform: 'uppercase',\n              letterSpacing: '0.06em',\n              color: colors.textMuted,\n              display: 'flex',\n              alignItems: 'center',\n              gap: spacing[1],\n            }}>\n              \n              Spec Changes ({diffResults.filter(d => d.status !== 'unchanged').length} differences)\n            </div>\n            {diffResults.map(({ specName, status, oldValue, newValue }) => {\n              const statusColors = {\n                changed: colors.accent1 || '#facc15',\n                added: colors.available || '#4ade80',\n                removed: colors.danger || '#f87171',\n                unchanged: withOpacity(colors.textMuted, 40),\n              };\n              const statusLabels = { changed: '~', added: '+', removed: '-', unchanged: '=' };\n              if (status === 'unchanged') return null; // Skip unchanged in diff view\n              return (\n                <div key={specName} style={{\n                  padding: `${spacing[1]}px ${spacing[3]}px`,\n                  borderBottom: `1px solid ${withOpacity(colors.border, 20)}`,\n                  display: 'grid',\n                  gridTemplateColumns: '24px 1fr 1fr',\n                  gap: spacing[2],\n                  fontSize: typography.fontSize.xs,\n                  alignItems: 'center',\n                }}>\n                  <span style={{\n                    fontWeight: 700,\n                    color: statusColors[status],\n                    fontFamily: 'monospace',\n                    textAlign: 'center',\n                  }}>{statusLabels[status]}</span>\n                  <div>\n                    <div style={{ fontWeight: 600, color: colors.textPrimary }}>{specName}</div>\n                    {oldValue && (\n                      <div style={{\n                        color: status === 'changed' ? colors.danger || '#f87171' : colors.textMuted,\n                        textDecoration: status === 'changed' ? 'line-through' : 'none',\n                      }}>{oldValue}</div>\n                    )}\n                  </div>\n                  <div style={{\n                    color: status === 'removed' ? withOpacity(colors.textMuted, 40) : colors.available || '#4ade80',\n                    fontWeight: status === 'added' ? 600 : 400,\n                  }}>\n                    {newValue || ''}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Action Buttons */}\n        <div style={{ display: 'flex', gap: spacing[3], justifyContent: 'flex-end', alignItems: 'center' }}>\n          {/* Compare button (5.2)  only shown when editing existing item */}\n          {existingItem && parseResult && !diffResults && (\n            <button\n              onClick={() => handleDiffExisting(existingItem.specs || {})}\n              style={{\n                background: 'none',\n                border: `1px solid ${withOpacity(colors.border, 50)}`,\n                borderRadius: borderRadius.sm,\n                cursor: 'pointer',\n                color: colors.textMuted,\n                padding: `${spacing[1]}px ${spacing[2]}px`,\n                fontSize: typography.fontSize.xs,\n                display: 'flex',\n                alignItems: 'center',\n                gap: 4,\n                marginRight: 'auto',\n              }}\n              title=\"Compare parsed specs against existing item values\"\n            >\n               Compare with existing\n            </button>\n          )}\n          {diffResults && (\n            <button\n              onClick={() => setDiffResults(null)}\n              style={{\n                background: 'none', border: 'none', cursor: 'pointer',\n                color: colors.textMuted, fontSize: typography.fontSize.xs, marginRight: 'auto',\n              }}\n            >\n              Hide diff\n            </button>\n          )}\n          <Button variant=\"secondary\" onClick={onClose}>Cancel</Button>\n          <Button onClick={handleApply} disabled={!parseResult || matchedCount === 0}>\n            Apply {matchedCount > 0 ? `${matchedCount} Fields` : ''} to Form\n          </Button>\n        </div>\n      </div>\n    </Modal>\n  );\n});\n\n// ============================================================================\n// PropTypes\n// ============================================================================\nSmartPasteModal.propTypes = {\n  specs: PropTypes.object,\n  onApply: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  existingItem: PropTypes.object, // Optional: pass for re-import diff (5.2)\n};\n","// ============================================================================\n// Item Modal\n// Add and edit inventory items with Smart Paste support\n// ============================================================================\n\nimport React, { memo, useState, useRef, useEffect, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport { Plus, Save, Trash2, Upload, X } from 'lucide-react';\nimport { CONDITION } from '../constants.js';\nimport { colors, styles, spacing, borderRadius, typography, withOpacity } from '../theme.js';\nimport { Badge, Button } from '../components/ui.jsx';\nimport { Select } from '../components/Select.jsx';\nimport { DatePicker } from '../components/DatePicker.jsx';\nimport { useItemForm } from '../components/ItemForm.jsx';\nimport { Modal, ModalHeader } from './ModalBase.jsx';\nimport ImageCropEditor from '../components/ImageCropEditor.jsx';\nimport { SmartPasteModal } from './SmartPasteModal.jsx';\n\n// Re-export SmartPasteModal for consumers who import from ItemModal\nexport { SmartPasteModal };\n\n// ============================================================================\n// Item Modal (Add/Edit)\n// ============================================================================\nexport const ItemModal = memo(function ItemModal({ isEdit, itemId, itemForm, setItemForm, specs, categories, categorySettings, locations, inventory, onSave, onClose, onDelete }) {\n  const [showSmartPaste, setShowSmartPaste] = useState(false);\n  const [cropSrc, setCropSrc] = useState(null);\n  const [imageUploading, setImageUploading] = useState(false);\n  \n  // Use the shared ItemForm hook for validation and computed values\n  const {\n    isValid,\n    errors,\n    getFieldError,\n    validateAll,\n    handleBlur,\n    previewCode,\n    duplicateSerialNumber,\n    categorySpecs,\n    currentCategorySettings,\n    flattenedLocations,\n    handleChange,\n    handleSpecChange,\n  } = useItemForm({\n    isEdit,\n    itemId,\n    itemForm,\n    setItemForm,\n    specs,\n    categorySettings,\n    locations,\n    inventory,\n    categories,\n  });\n  \n  // Image crop handler  uploads to Supabase Storage when editing, stores base64 for new items\n  const handleCropComplete = useCallback(async (croppedDataUrl) => {\n    setCropSrc(null);\n    \n    if (isEdit && itemId) {\n      setImageUploading(true);\n      try {\n        const { storageService } = await import('../lib/index.js');\n        const result = await storageService.uploadFromDataUrl(croppedDataUrl, itemId);\n        handleChange('image', result.url);\n      } catch (err) {\n        handleChange('image', croppedDataUrl);\n      } finally {\n        setImageUploading(false);\n      }\n    } else {\n      handleChange('image', croppedDataUrl);\n    }\n  }, [isEdit, itemId, handleChange]);\n\n  // Handle save with validation\n  const handleSave = () => {\n    if (validateAll()) {\n      onSave();\n    }\n  };\n  \n  const handleSmartPasteApply = (parsed) => {\n    setItemForm(prev => ({\n      ...prev,\n      name: parsed.name || prev.name,\n      brand: parsed.brand || prev.brand,\n      category: parsed.category || prev.category,\n      purchasePrice: parsed.purchasePrice || prev.purchasePrice,\n      currentValue: parsed.purchasePrice || prev.currentValue,\n      specs: { ...prev.specs, ...parsed.specs }\n    }));\n  };\n  \n  // Helper to render field error\n  const FieldError = ({ field }) => {\n    const error = getFieldError(field);\n    if (!error) return null;\n    return (\n      <span style={{ \n        color: colors.danger, \n        fontSize: typography.fontSize.xs, \n        marginTop: spacing[1],\n        display: 'block'\n      }}>\n        {error}\n      </span>\n    );\n  };\n\n  return (\n    <>\n      <Modal onClose={onClose} maxWidth={600}>\n        <ModalHeader title={isEdit ? 'Edit Item' : 'Add Item'} onClose={onClose} />\n        <div style={{ padding: spacing[4], maxHeight: '60vh', overflowY: 'auto' }}>\n          {/* Smart Paste Button */}\n          <div style={{ marginBottom: spacing[4] }}>\n            <Button \n              variant=\"secondary\" \n              onClick={() => setShowSmartPaste(true)}\n              style={{ width: '100%', justifyContent: 'center' }}\n            >\n               Smart Paste - {isEdit ? 'Update from Product Page' : 'Import from Product Page'}\n            </Button>\n            {isEdit && (\n              <p style={{ \n                color: colors.textMuted, \n                fontSize: typography.fontSize.xs, \n                margin: `${spacing[1]}px 0 0`, \n                textAlign: 'center' \n              }}>\n                Paste specs to fill in missing fields or update existing ones\n              </p>\n            )}\n          </div>\n          \n          {/* Preview Code Badge */}\n          {!isEdit && previewCode && (\n            <div style={{ marginBottom: spacing[4], padding: spacing[3], background: `${withOpacity(colors.primary, 10)}`, borderRadius: borderRadius.md, display: 'flex', alignItems: 'center', gap: spacing[2] }}>\n              <Badge text={previewCode} color={colors.primary} />\n              <span style={{ color: colors.textMuted, fontSize: typography.fontSize.sm }}>Auto-generated ID</span>\n            </div>\n          )}\n          \n          {/* Image Upload Section */}\n          <div style={{ marginBottom: spacing[4] }}>\n            <label style={styles.label}>Image (Optional)</label>\n            \n            {cropSrc ? (\n              /* Crop editor mode */\n              <ImageCropEditor\n                imageSrc={cropSrc}\n                onCropComplete={handleCropComplete}\n                onCancel={() => setCropSrc(null)}\n                outputSize={600}\n                cropShape=\"square\"\n                title=\"Crop item image\"\n              />\n            ) : (\n            <div style={{ \n              display: 'flex', \n              alignItems: 'center', \n              gap: spacing[3],\n              padding: spacing[3],\n              border: `1px dashed ${colors.border}`,\n              borderRadius: borderRadius.md,\n              background: colors.bgLight,\n              opacity: imageUploading ? 0.6 : 1,\n            }}>\n              {itemForm.image ? (\n                <>\n                  <img \n                    src={itemForm.image} \n                    alt=\"Item preview\" \n                    style={{ \n                      width: 80, \n                      height: 80, \n                      objectFit: 'cover', \n                      borderRadius: borderRadius.md \n                    }} \n                  />\n                  <div style={{ flex: 1 }}>\n                    <p style={{ margin: 0, fontSize: typography.fontSize.sm, color: colors.textSecondary }}>\n                      {imageUploading ? 'Uploading...' : 'Image attached'}\n                    </p>\n                    <button\n                      onClick={() => setCropSrc(itemForm.image)}\n                      style={{\n                        background: 'none',\n                        border: 'none',\n                        color: colors.primary,\n                        fontSize: typography.fontSize.sm,\n                        cursor: 'pointer',\n                        padding: 0,\n                        marginTop: spacing[1],\n                      }}\n                    >\n                      Resize / Crop\n                    </button>\n                    <button\n                      onClick={() => handleChange('image', null)}\n                      style={{\n                        background: 'none',\n                        border: 'none',\n                        color: colors.danger,\n                        fontSize: typography.fontSize.sm,\n                        cursor: 'pointer',\n                        padding: 0,\n                        marginTop: spacing[1],\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: spacing[1],\n                      }}\n                    >\n                      <X size={14} /> Remove image\n                    </button>\n                  </div>\n                </>\n              ) : (\n                <>\n                  <div style={{\n                    width: 80,\n                    height: 80,\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    background: withOpacity(colors.primary, 10),\n                    borderRadius: borderRadius.md,\n                    color: colors.textMuted,\n                  }}>\n                    <Upload size={24} />\n                  </div>\n                  <div style={{ flex: 1 }}>\n                    <input\n                      type=\"file\"\n                      accept=\"image/jpeg,image/png,image/webp,image/gif\"\n                      id=\"item-image-upload\"\n                      style={{ display: 'none' }}\n                      onChange={(e) => {\n                        const file = e.target.files?.[0];\n                        if (file) {\n                          if (file.size > 5 * 1024 * 1024) return;\n                          if (!file.type.startsWith('image/')) return;\n                          const reader = new FileReader();\n                          reader.onload = (event) => {\n                            setCropSrc(event.target.result);\n                          };\n                          reader.readAsDataURL(file);\n                        }\n                        if (e.target) e.target.value = '';\n                      }}\n                    />\n                    <label \n                      htmlFor=\"item-image-upload\"\n                      style={{\n                        ...styles.btnSec,\n                        display: 'inline-flex',\n                        cursor: 'pointer',\n                        fontSize: typography.fontSize.sm,\n                      }}\n                    >\n                      <Upload size={14} style={{ marginRight: spacing[1] }} />\n                      Choose Image\n                    </label>\n                    <p style={{ \n                      margin: `${spacing[1]}px 0 0`, \n                      fontSize: typography.fontSize.xs, \n                      color: colors.textMuted \n                    }}>\n                      JPG, PNG, or WebP (max 5MB)\n                    </p>\n                  </div>\n                </>\n              )}\n            </div>\n            )}\n          </div>\n          \n          {/* Name and Brand */}\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: spacing[3], marginBottom: spacing[3] }}>\n            <div>\n              <label style={{ ...styles.label, color: getFieldError('name') ? colors.danger : undefined }}>\n                Name <span style={{ color: colors.danger }}>*</span>\n              </label>\n              <input \n                name=\"name\"\n                value={itemForm.name} \n                onChange={e => handleChange('name', e.target.value)}\n                onBlur={() => handleBlur('name')}\n                placeholder=\"e.g., Alpha a7 IV\" \n                style={{ ...styles.input, borderColor: getFieldError('name') ? colors.danger : colors.border }}\n                aria-invalid={getFieldError('name') ? 'true' : undefined}\n                aria-describedby={getFieldError('name') ? 'name-error' : undefined}\n              />\n              <FieldError field=\"name\" />\n            </div>\n            <div>\n              <label style={{ ...styles.label, color: getFieldError('brand') ? colors.danger : undefined }}>\n                Brand <span style={{ color: colors.danger }}>*</span>\n              </label>\n              <input \n                name=\"brand\"\n                value={itemForm.brand} \n                onChange={e => handleChange('brand', e.target.value)}\n                onBlur={() => handleBlur('brand')}\n                placeholder=\"e.g., Sony\" \n                style={{ ...styles.input, borderColor: getFieldError('brand') ? colors.danger : colors.border }}\n                aria-invalid={getFieldError('brand') ? 'true' : undefined}\n                aria-describedby={getFieldError('brand') ? 'brand-error' : undefined}\n              />\n              <FieldError field=\"brand\" />\n            </div>\n          </div>\n          \n          {/* Category and Condition */}\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: spacing[3], marginBottom: spacing[3] }}>\n            <div>\n              <label style={styles.label}>Category</label>\n              <Select \n                value={itemForm.category} \n                onChange={e => handleChange('category', e.target.value)} \n                options={categories.map(c => ({ value: c, label: c }))}\n                aria-label=\"Category\"\n              />\n            </div>\n            <div>\n              <label style={styles.label}>Condition</label>\n              <Select \n                value={itemForm.condition} \n                onChange={e => handleChange('condition', e.target.value)} \n                options={Object.values(CONDITION).map(c => ({ value: c, label: c }))}\n                aria-label=\"Condition\"\n              />\n            </div>\n          </div>\n          \n          {/* Quantity field - only if category tracks quantity */}\n          {currentCategorySettings.trackQuantity && (\n            <div style={{ marginBottom: spacing[3] }}>\n              <label style={styles.label}>\n                Quantity\n              </label>\n              <input \n                type=\"number\" \n                min=\"0\"\n                value={itemForm.quantity || 1} \n                onChange={e => handleChange('quantity', Math.max(0, parseInt(e.target.value) || 0))} \n                style={{\n                  ...styles.input,\n                  maxWidth: '150px'\n                }} \n              />\n            </div>\n          )}\n          \n          {/* Reorder Point field - only for Consumables category */}\n          {currentCategorySettings.trackReorderPoint && (\n            <div style={{ marginBottom: spacing[3] }}>\n              <label style={styles.label}>\n                Reorder Point\n                <span style={{ fontSize: typography.fontSize.xs, color: colors.textMuted, fontWeight: typography.fontWeight.normal, marginLeft: spacing[2] }}>\n                  (alert when quantity falls below this)\n                </span>\n              </label>\n              <input \n                type=\"number\" \n                min=\"0\"\n                value={itemForm.reorderPoint || 0} \n                onChange={e => handleChange('reorderPoint', Math.max(0, parseInt(e.target.value) || 0))} \n                style={{\n                  ...styles.input,\n                  maxWidth: '150px'\n                }} \n              />\n            </div>\n          )}\n          \n          {/* Purchase Price and Current Value */}\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: spacing[3], marginBottom: spacing[3] }}>\n            <div>\n              <label style={styles.label}>Purchase Price</label>\n              <input type=\"number\" value={itemForm.purchasePrice} onChange={e => handleChange('purchasePrice', e.target.value)} placeholder=\"0.00\" style={styles.input} />\n            </div>\n            <div>\n              <label style={styles.label}>Current Value</label>\n              <input type=\"number\" value={itemForm.currentValue} onChange={e => handleChange('currentValue', e.target.value)} placeholder=\"0.00\" style={styles.input} />\n            </div>\n          </div>\n          \n          {/* Location and Serial Number */}\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: spacing[3], marginBottom: spacing[3] }}>\n            <div>\n              <label style={styles.label}>Location</label>\n              {flattenedLocations.length > 0 ? (\n                <Select\n                  value={itemForm.location || ''}\n                  onChange={e => handleChange('location', e.target.value)}\n                  options={[\n                    { value: '', label: 'Select location...' },\n                    ...flattenedLocations.map(loc => ({ value: loc.fullPath, label: loc.fullPath }))\n                  ]}\n                  aria-label=\"Location\"\n                />\n              ) : (\n                <input value={itemForm.location} onChange={e => handleChange('location', e.target.value)} placeholder=\"e.g., Shelf A-1\" style={styles.input} />\n              )}\n            </div>\n            <div>\n              <label style={{ \n                ...styles.label, \n                color: (currentCategorySettings.trackSerialNumbers && !itemForm.serialNumber) || duplicateSerialNumber ? colors.danger : undefined \n              }}>\n                Serial Number\n                {currentCategorySettings.trackSerialNumbers && (\n                  <span style={{ color: colors.danger, marginLeft: spacing[1] }}>*</span>\n                )}\n              </label>\n              <input \n                value={itemForm.serialNumber} \n                onChange={e => handleChange('serialNumber', e.target.value)} \n                placeholder={currentCategorySettings.trackSerialNumbers ? \"Required\" : \"Optional\"} \n                style={{\n                  ...styles.input,\n                  borderColor: (currentCategorySettings.trackSerialNumbers && !itemForm.serialNumber) || duplicateSerialNumber ? colors.danger : colors.border\n                }} \n              />\n              {duplicateSerialNumber && (\n                <span style={{ color: colors.danger, fontSize: typography.fontSize.xs, display: 'block', marginTop: spacing[1] }}>\n                  Serial number already exists on \"{duplicateSerialNumber.name}\" ({duplicateSerialNumber.id})\n                </span>\n              )}\n            </div>\n          </div>\n          \n          {/* Purchase Date */}\n          <div style={{ marginBottom: spacing[3] }}>\n            <label style={styles.label}>Purchase Date</label>\n            <DatePicker \n              value={itemForm.purchaseDate} \n              onChange={e => handleChange('purchaseDate', e.target.value)} \n              placeholder=\"Select purchase date\"\n              aria-label=\"Purchase date\"\n            />\n          </div>\n          \n          {/* Specifications */}\n          {categorySpecs.length > 0 && (\n            <div style={{ borderTop: `1px solid ${colors.borderLight}`, paddingTop: spacing[4], marginTop: spacing[4] }}>\n              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: spacing[3] }}>\n                <h4 style={{ margin: 0, fontSize: typography.fontSize.sm, color: colors.textMuted }}>\n                  Specifications ({categorySpecs.length} fields)\n                </h4>\n                <span style={{ fontSize: typography.fontSize.xs, color: colors.textMuted }}>\n                  {categorySpecs.filter(s => s.required).length} required\n                </span>\n              </div>\n              \n              {/* Required fields first */}\n              {categorySpecs.filter(s => s.required).length > 0 && (\n                <div style={{ marginBottom: spacing[4] }}>\n                  <div style={{ fontSize: typography.fontSize.xs, color: colors.primary, marginBottom: spacing[2], fontWeight: typography.fontWeight.medium }}>\n                    Required Fields\n                  </div>\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: spacing[3] }}>\n                    {categorySpecs.filter(s => s.required).map(spec => {\n                      const isEmpty = !itemForm.specs[spec.name];\n                      return (\n                        <div key={spec.name}>\n                          <label style={{ ...styles.label, color: isEmpty ? colors.danger : undefined }}>\n                            {spec.name} <span style={{ color: colors.danger }}>*</span>\n                          </label>\n                          <input \n                            value={itemForm.specs[spec.name] || ''} \n                            onChange={e => handleSpecChange(spec.name, e.target.value)} \n                            style={{ ...styles.input, borderColor: isEmpty ? colors.danger : colors.border }} \n                          />\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n              \n              {/* Optional fields */}\n              {categorySpecs.filter(s => !s.required).length > 0 && (\n                <div>\n                  <div style={{ fontSize: typography.fontSize.xs, color: colors.textMuted, marginBottom: spacing[2] }}>\n                    Optional Fields\n                  </div>\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: spacing[3] }}>\n                    {categorySpecs.filter(s => !s.required).map(spec => (\n                      <div key={spec.name}>\n                        <label style={styles.label}>{spec.name}</label>\n                        <input \n                          value={itemForm.specs[spec.name] || ''} \n                          onChange={e => handleSpecChange(spec.name, e.target.value)} \n                          style={styles.input} \n                        />\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n        \n        {/* Action Buttons in fixed footer */}\n        <div style={{ \n          padding: spacing[4], \n          borderTop: `1px solid ${colors.borderLight}`,\n          display: 'flex', \n          gap: spacing[3], \n          justifyContent: 'space-between',\n          background: colors.bgMedium,\n        }}>\n          {isEdit && onDelete && itemId ? (\n            <Button variant=\"secondary\" danger onClick={() => { onClose(); onDelete(itemId); }} icon={Trash2}>Delete Item</Button>\n          ) : (\n            <div />\n          )}\n          <div style={{ display: 'flex', gap: spacing[3] }}>\n            <Button variant=\"secondary\" onClick={onClose}>Cancel</Button>\n            <Button onClick={handleSave} disabled={!isValid} icon={isEdit ? Save : Plus}>{isEdit ? 'Save Changes' : 'Add Item'}</Button>\n          </div>\n        </div>\n      </Modal>\n      \n      {showSmartPaste && (\n        <SmartPasteModal\n          specs={specs}\n          onApply={handleSmartPasteApply}\n          onClose={() => setShowSmartPaste(false)}\n        />\n      )}\n    </>\n  );\n});\n\n// ============================================================================\n// PropTypes\n// ============================================================================\n\n/** Shape for item form data */\nconst itemFormShape = PropTypes.shape({\n  name: PropTypes.string,\n  brand: PropTypes.string,\n  category: PropTypes.string,\n  condition: PropTypes.string,\n  purchasePrice: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  currentValue: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  location: PropTypes.string,\n  serialNumber: PropTypes.string,\n  purchaseDate: PropTypes.string,\n  quantity: PropTypes.number,\n  reorderPoint: PropTypes.number,\n  specs: PropTypes.object,\n});\n\n/** Shape for spec configuration */\nconst specConfigShape = PropTypes.objectOf(\n  PropTypes.arrayOf(PropTypes.shape({\n    name: PropTypes.string.isRequired,\n    required: PropTypes.bool,\n  }))\n);\n\n/** Shape for category settings */\nconst categorySettingsShape = PropTypes.objectOf(PropTypes.shape({\n  trackSerialNumbers: PropTypes.bool,\n  trackQuantity: PropTypes.bool,\n}));\n\n/** Shape for location */\nconst locationShape = PropTypes.shape({\n  id: PropTypes.string.isRequired,\n  name: PropTypes.string.isRequired,\n  children: PropTypes.array,\n});\n\n/** Shape for inventory item */\nconst inventoryItemShape = PropTypes.shape({\n  id: PropTypes.string.isRequired,\n  name: PropTypes.string.isRequired,\n  serialNumber: PropTypes.string,\n});\n\nItemModal.propTypes = {\n  /** Whether this is editing an existing item */\n  isEdit: PropTypes.bool,\n  /** ID of item being edited (required if isEdit is true) */\n  itemId: PropTypes.string,\n  /** Current form data */\n  itemForm: itemFormShape.isRequired,\n  /** Setter for form data */\n  setItemForm: PropTypes.func.isRequired,\n  /** Spec configuration by category */\n  specs: specConfigShape,\n  /** Available categories */\n  categories: PropTypes.arrayOf(PropTypes.string).isRequired,\n  /** Category-specific settings */\n  categorySettings: categorySettingsShape,\n  /** Available locations */\n  locations: PropTypes.arrayOf(locationShape),\n  /** Current inventory (for duplicate detection) */\n  inventory: PropTypes.arrayOf(inventoryItemShape),\n  /** Callback when save is clicked */\n  onSave: PropTypes.func.isRequired,\n  /** Callback to close modal */\n  onClose: PropTypes.func.isRequired,\n  /** Callback to delete item (optional) */\n  onDelete: PropTypes.func,\n};\n"],"file":"ItemModal-Dum071tY.js"}