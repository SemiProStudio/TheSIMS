import{r as U,j as e,P as V,B as I,t as m,a as i,c as s,C as E,b as X,h as F,L as R,i as W,s as w,S as Z,w as B,d as ee}from"./index-TtmnPN12.js";import{a as l,t as O,b as A,u as k,g as te,C as ne,j as se,T as ie,n as re,B as ae,e as oe,v as le,w as de,x as ce}from"./vendor-icons-B6HpBdFH.js";import"./vendor-react-DwPMHwnM.js";const D=L=>{switch(L){case"building":return ce;case"room":return de;case"cabinet":return le;case"shelf":return oe;case"case":return ae;case"external":return re;default:return k}},he=l.memo(function L({location:o,level:S=0,onEdit:g,onDelete:c,onAddChild:y,expandedIds:f,toggleExpand:C,itemCounts:v}){const j=D(o.type),d=o.children&&o.children.length>0,p=f.has(o.id),h=v[o.id]||0;return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i[2],padding:`${i[2]}px ${i[3]}px`,paddingLeft:i[3]+S*24,background:S%2===0?"transparent":`${B(s.primary,3)}`,borderBottom:`1px solid ${s.borderLight}`},children:[e.jsx("button",{onClick:()=>d&&C(o.id),style:{background:"none",border:"none",color:d?s.textMuted:"transparent",cursor:d?"pointer":"default",padding:2,width:20,display:"flex",alignItems:"center",justifyContent:"center"},children:d&&(p?e.jsx(te,{size:14}):e.jsx(ne,{size:14}))}),e.jsx("div",{style:{width:28,height:28,borderRadius:W.md,background:`${B(s.primary,15)}`,display:"flex",alignItems:"center",justifyContent:"center",color:s.primary},children:e.jsx(j,{size:14})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:m.fontSize.sm,color:s.textPrimary,fontWeight:m.fontWeight.medium},children:o.name}),e.jsxs("div",{style:{fontSize:m.fontSize.xs,color:s.textMuted,display:"flex",alignItems:"center",gap:i[2]},children:[e.jsx("span",{style:{textTransform:"capitalize"},children:o.type}),h>0&&e.jsx(ee,{text:`${h} items`,color:s.primary,size:"xs"})]})]}),e.jsxs("div",{style:{display:"flex",gap:i[1]},children:[e.jsx("button",{onClick:()=>y(o),title:"Add sub-location",style:{...w.btnSec,padding:i[1],fontSize:m.fontSize.xs},children:e.jsx(A,{size:14})}),e.jsx("button",{onClick:()=>g(o),title:"Edit location",style:{...w.btnSec,padding:i[1],fontSize:m.fontSize.xs},children:e.jsx(se,{size:14})}),e.jsx("button",{onClick:()=>c(o),title:h>0?`Cannot delete - ${h} items`:"Delete location",disabled:h>0,style:{...w.btnSec,padding:i[1],color:h>0?s.textMuted:s.danger,opacity:h>0?.5:1,cursor:h>0?"not-allowed":"pointer"},children:e.jsx(ie,{size:14})})]})]}),d&&p&&e.jsx("div",{children:o.children.map(u=>e.jsx(L,{location:u,level:S+1,onEdit:g,onDelete:c,onAddChild:y,expandedIds:f,toggleExpand:C,itemCounts:v},u.id))})]})}),ue=l.memo(function({location:o,parentLocation:S,isNew:g,onSave:c,onCancel:y}){const[f,C]=l.useState(o?.name||""),[v,j]=l.useState(o?.type||"room"),[d,p]=l.useState(""),h=()=>{if(!f.trim()){p("Name is required");return}c({id:o?.id||`loc-${Date.now()}`,name:f.trim(),type:v,children:o?.children||[]})};return e.jsxs("div",{style:{padding:i[4],background:`${B(s.primary,5)}`,borderRadius:W.lg,border:`1px solid ${B(s.primary,20)}`,marginBottom:i[4]},children:[e.jsx("h4",{style:{margin:`0 0 ${i[3]}px`,color:s.textPrimary},children:g?S?`Add Sub-location to "${S.name}"`:"Add New Location":"Edit Location"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:i[3],marginBottom:i[3]},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{...w.label,color:!f||d?s.danger:void 0},children:["Name ",e.jsx("span",{style:{color:s.danger},children:"*"})]}),e.jsx("input",{type:"text",value:f,onChange:u=>{C(u.target.value),p("")},placeholder:"e.g., Studio A, Main Floor, Shelf 1",style:{...w.input,borderColor:!f||d?s.danger:s.border},autoFocus:!0}),d&&e.jsx("span",{style:{color:s.danger,fontSize:m.fontSize.xs},children:d})]}),e.jsxs("div",{children:[e.jsx("label",{style:w.label,children:"Type"}),e.jsx(Z,{value:v,onChange:u=>j(u.target.value),options:R,"aria-label":"Location type"})]})]}),e.jsxs("div",{style:{display:"flex",gap:i[2],justifyContent:"flex-end"},children:[e.jsx(I,{variant:"secondary",onClick:y,size:"sm",children:"Cancel"}),e.jsx(I,{onClick:h,icon:O,size:"sm",children:g?"Add Location":"Save Changes"})]})]})});function xe({locations:L,inventory:o,onSave:S,onClose:g}){const[c,y]=l.useState(structuredClone(L)),[f,C]=l.useState(new Set(["loc-studio-a","loc-studio-b"])),[v,j]=l.useState(null),[d,p]=l.useState(null),[h,u]=l.useState(!1),[z,q]=l.useState(""),$=l.useMemo(()=>{const n={},a={},r=(t,x="")=>{const b=x?`${x} - ${t.name}`:t.name;a[t.name.toLowerCase()]=t.id,a[b.toLowerCase()]=t.id,n[t.id]=0,t.children&&t.children.forEach(T=>r(T,b))};return c.forEach(t=>r(t)),o.forEach(t=>{if(t.location){const x=t.location.toLowerCase();a[x]?n[a[x]]++:Object.keys(a).forEach(b=>{(x.includes(b)||b.includes(x))&&n[a[b]]++})}}),n},[c,o]),H=l.useCallback(n=>{C(a=>{const r=new Set(a);return r.has(n)?r.delete(n):r.add(n),r})},[]),Q=n=>{p(n),j(null),u(!0)},M=()=>{p(null),j(null),u(!0)},Y=n=>{j(n),u(!1),p(null)},_=n=>{if(($[n.id]||0)>0)return;const a=r=>r.filter(t=>t.id===n.id?!1:(t.children&&(t.children=a(t.children)),!0));y(r=>a([...r]))},G=n=>{if(h)if(d){const a=r=>r.map(t=>t.id===d.id?{...t,children:[...t.children||[],n]}:t.children?{...t,children:a(t.children)}:t);y(r=>a([...r])),C(r=>new Set([...r,d.id]))}else y(a=>[...a,n]);else{const a=r=>r.map(t=>t.id===n.id?{...n,children:t.children}:t.children?{...t,children:a(t.children)}:t);y(r=>a([...r]))}j(null),u(!1),p(null)},J=()=>{j(null),u(!1),p(null)},P=l.useMemo(()=>{if(!z.trim())return c;const n=z.toLowerCase(),a=r=>r.reduce((t,x)=>{const b=x.name.toLowerCase().includes(n),T=x.children?a(x.children):[];return(b||T.length>0)&&t.push({...x,children:T}),t},[]);return a(c)},[c,z]),N=l.useMemo(()=>U(c),[c]),K=()=>{S(c),g&&g()};return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"Manage Locations",subtitle:"Organize storage in a hierarchy",onBack:g,backLabel:"Back to Admin",action:e.jsx(I,{onClick:K,icon:O,children:"Save Changes"})}),e.jsx("p",{style:{color:s.textSecondary,marginBottom:i[4],fontSize:m.fontSize.sm},children:"Organize your storage locations in a hierarchy (Building → Room → Shelf). Items can be assigned to any level."}),(h||v)&&e.jsx(ue,{location:v,parentLocation:d,isNew:h,onSave:G,onCancel:J}),e.jsxs("div",{className:"responsive-two-col",style:{display:"grid",gap:i[4]},children:[e.jsxs(E,{padding:!1,children:[e.jsxs("div",{style:{padding:i[3],borderBottom:`1px solid ${s.borderLight}`,display:"flex",gap:i[3],alignItems:"center"},children:[e.jsx(X,{value:z,onChange:q,placeholder:"Search locations...",style:{flex:1}}),e.jsx(I,{onClick:M,icon:A,size:"sm",children:"Add Location"})]}),e.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:P.length===0?e.jsxs("div",{style:{padding:i[6],textAlign:"center",color:s.textMuted},children:[e.jsx(k,{size:32,style:{marginBottom:i[2],opacity:.3}}),e.jsx("p",{style:{margin:0},children:z?"No locations match your search":"No locations defined yet"}),!z&&e.jsx(I,{variant:"secondary",onClick:M,icon:A,style:{marginTop:i[3]},children:"Add First Location"})]}):P.map(n=>e.jsx(he,{location:n,onEdit:Y,onDelete:_,onAddChild:Q,expandedIds:f,toggleExpand:H,itemCounts:$},n.id))})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:i[4]},children:[e.jsxs(E,{padding:!1,children:[e.jsx(F,{title:"Location Summary",icon:k}),e.jsxs("div",{style:{padding:i[4]},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:i[2]},children:[e.jsx("span",{style:{color:s.textSecondary},children:"Total Locations"}),e.jsx("span",{style:{color:s.textPrimary,fontWeight:m.fontWeight.medium},children:N.length})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:i[2]},children:[e.jsx("span",{style:{color:s.textSecondary},children:"Root Locations"}),e.jsx("span",{style:{color:s.textPrimary,fontWeight:m.fontWeight.medium},children:c.length})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:s.textSecondary},children:"Items Assigned"}),e.jsx("span",{style:{color:s.textPrimary,fontWeight:m.fontWeight.medium},children:o.filter(n=>n.location).length})]})]})]}),e.jsxs(E,{padding:!1,children:[e.jsx(F,{title:"Location Types"}),e.jsx("div",{style:{padding:i[4]},children:R.map(n=>{const a=N.filter(t=>t.type===n.value).length,r=D(n.value);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i[2],marginBottom:i[2]},children:[e.jsx(r,{size:14,color:s.textMuted}),e.jsx("span",{style:{flex:1,color:s.textSecondary,fontSize:m.fontSize.sm},children:n.label}),e.jsx("span",{style:{color:s.textPrimary,fontSize:m.fontSize.sm},children:a})]},n.value)})})]})]})]})]})}const ge=l.memo(xe);export{ge as default};
//# sourceMappingURL=LocationsManager-BzGn_lVG.js.map
