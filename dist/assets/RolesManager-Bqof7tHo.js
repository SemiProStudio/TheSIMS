import{j as e,a as t,c as s,t as r,B as f,C as M,A as z,F as d,s as E,i as S,w as D,d as N,G as V,l as O}from"./index-TtmnPN12.js";import{a as p,b as U,K as $,E as W,z as P,X as B,t as _,g as F,C as L,N as G,I as q,P as K,T as Q}from"./vendor-icons-B6HpBdFH.js";import"./vendor-react-DwPMHwnM.js";const T=j=>{switch(j){case d.EDIT:return s.success;case d.VIEW:return s.primary;case d.HIDE:return s.textMuted;default:return s.textMuted}},A=({level:j,size:i=16})=>{switch(j){case d.EDIT:return e.jsx($,{size:i});case d.VIEW:return e.jsx(W,{size:i});case d.HIDE:return e.jsx(P,{size:i});default:return e.jsx(P,{size:i})}},X=p.memo(function({level:i,isActive:x,onClick:u,disabled:l}){const a=T(i),g={[d.EDIT]:"Edit",[d.VIEW]:"View",[d.HIDE]:"Hide"};return e.jsxs("button",{onClick:u,disabled:l,style:{display:"flex",alignItems:"center",gap:t[1],padding:`${t[1]}px ${t[2]}px`,border:`1px solid ${x?a:s.border}`,borderRadius:S.md,background:x?D(a,20):"transparent",color:x?a:s.textMuted,cursor:l?"not-allowed":"pointer",fontSize:r.fontSize.xs,fontWeight:x?r.fontWeight.medium:r.fontWeight.normal,opacity:l?.5:1,transition:"all 0.15s ease"},children:[e.jsx(A,{level:i,size:12}),g[i]]})}),Y=p.memo(function({func:i,currentPermission:x,onChange:u,disabled:l}){return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${t[2]}px ${t[3]}px`,borderBottom:`1px solid ${s.border}`},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:r.fontWeight.medium,color:s.textPrimary,fontSize:r.fontSize.sm},children:i.name}),e.jsx("div",{style:{fontSize:r.fontSize.xs,color:s.textMuted},children:i.description})]}),e.jsx("div",{style:{display:"flex",gap:t[1]},children:Object.values(d).map(a=>e.jsx(X,{level:a,isActive:x===a,onClick:()=>u(i.id,a),disabled:l},a))})]})}),J=p.memo(function({role:i,onEdit:x,onDelete:u,onAssign:l,userCount:a}){const[g,b]=p.useState(!1),y=Object.values(i.permissions).reduce((n,h)=>(n[h]=(n[h]||0)+1,n),{});return e.jsxs(M,{style:{marginBottom:t[3]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:t[3]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t[3]},children:[e.jsx("button",{onClick:()=>b(!g),className:"role-btn",style:{background:"none",border:"none",padding:t[1],display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:s.textMuted,borderRadius:S.md},title:g?"Collapse permissions":"Expand permissions",children:g?e.jsx(F,{size:20}):e.jsx(L,{size:20})}),e.jsx("div",{style:{width:40,height:40,borderRadius:S.lg,background:`${D(s.primary,15)}`,display:"flex",alignItems:"center",justifyContent:"center",color:s.primary},children:e.jsx(G,{size:20})}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t[2]},children:[e.jsx("span",{style:{fontWeight:r.fontWeight.semibold,color:s.textPrimary},children:i.name}),i.isSystem&&e.jsx(N,{text:"System",color:s.textMuted,size:"xs"})]}),e.jsx("div",{style:{fontSize:r.fontSize.sm,color:s.textMuted,marginTop:2},children:i.description}),e.jsxs("div",{style:{display:"flex",gap:t[2],marginTop:t[1],fontSize:r.fontSize.xs},children:[e.jsxs("span",{style:{color:s.success},children:[y[d.EDIT]||0," Edit"]}),e.jsxs("span",{style:{color:s.primary},children:[y[d.VIEW]||0," View"]}),e.jsxs("span",{style:{color:s.textMuted},children:[y[d.HIDE]||0," Hidden"]}),e.jsxs("span",{style:{color:s.accent2},children:["â€¢ ",a," user",a!==1?"s":""]})]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t[2]},children:[e.jsx(f,{size:"sm",variant:"secondary",onClick:()=>l(i),icon:q,children:"Assign"}),e.jsx(f,{size:"sm",variant:"secondary",onClick:()=>x(i),icon:K,children:"Edit"}),!i.isSystem&&e.jsx(f,{size:"sm",variant:"secondary",danger:!0,onClick:()=>u(i),icon:Q,children:"Delete"})]})]}),g&&e.jsx("div",{style:{borderTop:`1px solid ${s.border}`,padding:t[3],background:s.bgDark},children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:t[2]},children:Object.values(z).map(n=>{const h=i.permissions[n.id]||d.HIDE;return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${t[1]}px ${t[2]}px`,background:s.bgLight,borderRadius:S.md},children:[e.jsx("span",{style:{fontSize:r.fontSize.sm,color:h===d.HIDE?s.textMuted:s.textPrimary},children:n.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t[1],color:T(h),fontSize:r.fontSize.xs},children:[e.jsx(A,{level:h,size:14}),e.jsx("span",{style:{textTransform:"capitalize"},children:h})]})]},n.id)})})})]})}),Z=p.memo(function({role:i,onSave:x,onCancel:u}){const[l,a]=p.useState(i?.name||""),[g,b]=p.useState(i?.description||""),[y,n]=p.useState(i?.permissions||Object.keys(z).reduce((c,o)=>(c[z[o].id]=d.VIEW,c),{})),h=!!i?.id,m=i?.isSystem,w=p.useCallback((c,o)=>{n(v=>({...v,[c]:o}))},[]),k=()=>{l.trim()&&x({id:i?.id||`role_${O()}`,name:l.trim(),description:g.trim(),isSystem:i?.isSystem||!1,permissions:y})},C=c=>{const o={};Object.values(z).forEach(v=>{o[v.id]=c}),n(o)},R=[{name:"Main Features",funcs:["dashboard","gear_list","item_details","schedule","pack_lists","clients","search","labels","reports"]},{name:"Administration",funcs:["admin_users","admin_categories","admin_specs","admin_locations","admin_themes","admin_layout","admin_notifications","admin_roles","admin_audit"]}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:t[4]},children:[e.jsx("h3",{style:{margin:0,color:s.textPrimary},children:h?"Edit Role":"Create New Role"}),e.jsx("button",{onClick:u,style:{background:"none",border:"none",cursor:"pointer",color:s.textMuted,padding:t[1]},children:e.jsx(B,{size:20})})]}),e.jsxs("div",{style:{marginBottom:t[4]},children:[e.jsxs("div",{style:{marginBottom:t[3]},children:[e.jsxs("label",{style:{...E.label,color:!l&&!m?s.danger:void 0},children:["Role Name ",e.jsx("span",{style:{color:s.danger},children:"*"})]}),e.jsx("input",{type:"text",value:l,onChange:c=>a(c.target.value),placeholder:"e.g., Equipment Manager",disabled:m,style:{...E.input,opacity:m?.7:1,borderColor:!l&&!m?s.danger:s.border}}),m&&e.jsx("p",{style:{fontSize:r.fontSize.xs,color:s.textMuted,margin:`${t[1]}px 0 0`},children:"System role names cannot be changed"})]}),e.jsxs("div",{children:[e.jsx("label",{style:E.label,children:"Description"}),e.jsx("input",{type:"text",value:g,onChange:c=>b(c.target.value),placeholder:"Brief description of this role",style:E.input})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t[2],marginBottom:t[3],padding:t[2],background:s.bgDark,borderRadius:S.md},children:[e.jsx("span",{style:{fontSize:r.fontSize.sm,color:s.textMuted},children:"Quick set all:"}),e.jsx(f,{size:"sm",variant:"secondary",onClick:()=>C(d.EDIT),children:"All Edit"}),e.jsx(f,{size:"sm",variant:"secondary",onClick:()=>C(d.VIEW),children:"All View"}),e.jsx(f,{size:"sm",variant:"secondary",onClick:()=>C(d.HIDE),children:"All Hide"})]}),e.jsx("div",{style:{border:`1px solid ${s.border}`,borderRadius:S.lg,overflow:"hidden",marginBottom:t[4]},children:R.map((c,o)=>e.jsxs("div",{children:[e.jsx("div",{style:{padding:`${t[2]}px ${t[3]}px`,background:s.bgDark,borderBottom:`1px solid ${s.border}`,borderTop:o>0?`1px solid ${s.border}`:"none"},children:e.jsx("span",{style:{fontWeight:r.fontWeight.semibold,color:s.textPrimary,fontSize:r.fontSize.sm},children:c.name})}),c.funcs.map(v=>{const I=Object.values(z).find(H=>H.id===v);return I?e.jsx(Y,{func:I,currentPermission:y[I.id]||d.HIDE,onChange:w,disabled:!1},I.id):null})]},c.name))}),e.jsxs("div",{style:{display:"flex",gap:t[3],justifyContent:"flex-end"},children:[e.jsx(f,{variant:"secondary",onClick:u,children:"Cancel"}),e.jsx(f,{onClick:k,disabled:!l.trim(),icon:_,children:h?"Save Changes":"Create Role"})]})]})}),ee=p.memo(function({role:i,users:x=[],onSave:u,onClose:l}){const[a,g]=p.useState(new Set((x||[]).filter(n=>n.roleId===i.id||n.role_id===i.id).map(n=>n.id))),b=n=>{g(h=>{const m=new Set(h);return m.has(n)?m.delete(n):m.add(n),m})},y=()=>{u(i.id,[...a]),l()};return e.jsx("div",{className:"modal-backdrop",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:V.modal},children:e.jsxs("div",{style:{background:s.bgLight,borderRadius:S.xl,width:"100%",maxWidth:500,maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:t[4],borderBottom:`1px solid ${s.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,color:s.textPrimary},children:"Assign Users to Role"}),e.jsx("p",{style:{margin:`${t[1]}px 0 0`,color:s.textMuted,fontSize:r.fontSize.sm},children:i.name})]}),e.jsx("button",{onClick:l,style:{background:"none",border:"none",cursor:"pointer",color:s.textMuted,padding:t[1]},children:e.jsx(B,{size:20})})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:t[3]},children:(x||[]).map(n=>e.jsxs("label",{className:"list-item-hover",style:{display:"flex",alignItems:"center",gap:t[3],padding:t[2],borderRadius:S.md,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:a.has(n.id),onChange:()=>b(n.id),style:{width:18,height:18}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:r.fontWeight.medium,color:s.textPrimary},children:n.name}),e.jsx("div",{style:{fontSize:r.fontSize.sm,color:s.textMuted},children:n.email})]})]},n.id))}),e.jsxs("div",{style:{padding:t[4],borderTop:`1px solid ${s.border}`,display:"flex",gap:t[3],justifyContent:"flex-end"},children:[e.jsx(f,{variant:"secondary",onClick:l,children:"Cancel"}),e.jsx(f,{onClick:y,icon:_,children:"Save Assignments"})]})]})})});function se({roles:j=[],users:i=[],onSaveRole:x,onDeleteRole:u,onAssignUsers:l,onBack:a}){const[g,b]=p.useState(null),[y,n]=p.useState(null),[h,m]=p.useState(!1),w=()=>{b(null),m(!0)},k=o=>{b(o),m(!0)},C=o=>{x?.(o),m(!1),b(null)},R=o=>{window.confirm(`Are you sure you want to delete the "${o.name}" role? Users with this role will need to be reassigned.`)&&u?.(o.id)},c=o=>(i||[]).filter(v=>v.roleId===o||v.role_id===o).length;return h?e.jsx(Z,{role:g,onSave:C,onCancel:()=>{m(!1),b(null)}}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:t[6]},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,color:s.textPrimary},children:"Roles & Permissions"}),e.jsx("p",{style:{margin:`${t[1]}px 0 0`,color:s.textMuted,fontSize:r.fontSize.sm},children:"Create and manage user roles with granular permission control"})]}),e.jsx(f,{onClick:w,icon:U,children:"Create Role"})]}),e.jsx(M,{style:{marginBottom:t[4],padding:t[3]},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t[4],flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:r.fontWeight.medium,color:s.textPrimary,fontSize:r.fontSize.sm},children:"Permission Levels:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t[1],color:s.success},children:[e.jsx($,{size:14}),e.jsx("span",{style:{fontSize:r.fontSize.sm},children:"Edit - Full access to view and modify"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t[1],color:s.primary},children:[e.jsx(W,{size:14}),e.jsx("span",{style:{fontSize:r.fontSize.sm},children:"View - Read-only access"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t[1],color:s.textMuted},children:[e.jsx(P,{size:14}),e.jsx("span",{style:{fontSize:r.fontSize.sm},children:"Hide - No access, hidden from navigation"})]})]})}),(j||[]).map(o=>e.jsx(J,{role:o,onEdit:k,onDelete:R,onAssign:n,userCount:c(o.id)},o.id)),y&&e.jsx(ee,{role:y,users:i||[],onSave:l,onClose:()=>n(null)})]})}const re=p.memo(se);export{re as default};
//# sourceMappingURL=RolesManager-Bqof7tHo.js.map
