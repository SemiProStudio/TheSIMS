import{j as t,a,i as j,t as f,c as i,B as v,w,J as m}from"./index-TtmnPN12.js";import{a as x,D as H,a0 as E}from"./vendor-icons-B6HpBdFH.js";import{M as _,a as G}from"./ModalBase-BgtxHV_N.js";import"./vendor-react-DwPMHwnM.js";const J=x.memo(function({categories:P,specs:V,onImport:B,onClose:b}){const[R,D]=x.useState(null),[d,$]=x.useState(null),[I,y]=x.useState(null),[S,C]=x.useState(!1),[Y,A]=x.useState({}),L=x.useRef(null),M=["name","category"],N=["brand","status","condition","location","purchaseDate","purchasePrice","currentValue","serialNumber","notes"],O=[...M,...N],q=()=>{const n=["name","brand","category","status","condition","location","purchaseDate","purchasePrice","currentValue","serialNumber","notes"],r=[];Object.entries(V).forEach(([u,g])=>{Array.isArray(g)&&g.forEach(W=>{const z=`spec:${W.name}`;r.includes(z)||r.push(z)})});const e=[...n,...r],o=[["Sony A7S III","Sony","Cameras","available","excellent","Studio A - Shelf 1","2023-06-15","3498","2800","SN-A7S3-001","Great condition"],["Canon RF 24-70mm f/2.8","Canon","Lenses","available","good","Lens Cabinet","2023-03-20","2399","2100","SN-RF2470-002",""],["Aputure 600d Pro","Aputure","Lighting","checked-out","excellent","Lighting Storage","2023-01-10","1699","1400","SN-600D-003",""]].map(u=>{for(;u.length<e.length;)u.push("");return u}),s=[e.join(","),...o.map(u=>u.map(g=>g.includes(",")||g.includes('"')?`"${g.replace(/"/g,'""')}"`:g).join(","))].join(`
`),l=new Blob([s],{type:"text/csv;charset=utf-8"}),p=URL.createObjectURL(l),h=document.createElement("a");h.href=p,h.download="sims-import-template.csv",h.click(),URL.revokeObjectURL(p)},F=n=>{const r=n.split(/\r?\n/).filter(s=>s.trim());if(r.length<2)throw new Error("CSV file must have a header row and at least one data row");const e=k(r[0]),c=M.filter(s=>!e.some(l=>l.toLowerCase()===s.toLowerCase()));if(c.length>0)throw new Error(`Missing required columns: ${c.join(", ")}`);const o=[];for(let s=1;s<r.length;s++){const l=k(r[s]);if(l.length===0||l.every(h=>!h.trim()))continue;const p={};e.forEach((h,u)=>{p[h.toLowerCase()]=l[u]||""}),o.push(p)}return{headers:e,rows:o}},k=n=>{const r=[];let e="",c=!1;for(let o=0;o<n.length;o++){const s=n[o],l=n[o+1];c?s==='"'&&l==='"'?(e+='"',o++):s==='"'?c=!1:e+=s:s==='"'?c=!0:s===","?(r.push(e.trim()),e=""):e+=s}return r.push(e.trim()),r},U=async n=>{const r=n.target.files?.[0];if(r){D(r),y(null),$(null);try{const e=await r.text(),c=F(e);$(c);const o={};c.headers.forEach(s=>{const l=s.toLowerCase();O.includes(l)?o[s]=l:l.startsWith("spec:")&&(o[s]=s)}),A(o)}catch(e){y(e.message)}}},T=async()=>{if(d){C(!0),y(null);try{const n=[],r=[];if(d.rows.forEach((e,c)=>{if(!e.name?.trim()){r.push(`Row ${c+2}: Missing name`);return}if(!e.category?.trim()){r.push(`Row ${c+2}: Missing category`);return}if(!P.includes(e.category)){r.push(`Row ${c+2}: Unknown category "${e.category}"`);return}const o={name:e.name.trim(),brand:e.brand?.trim()||"",category:e.category.trim(),status:e.status?.trim()||"available",condition:e.condition?.trim()||"excellent",location:e.location?.trim()||"",purchaseDate:e.purchasedate?.trim()||e.purchaseDate?.trim()||"",purchasePrice:parseFloat(e.purchaseprice||e.purchasePrice)||0,currentValue:parseFloat(e.currentvalue||e.currentValue)||0,serialNumber:e.serialnumber?.trim()||e.serialNumber?.trim()||"",notes:e.notes?.trim()?[{id:`imported_${Date.now()}_${c}`,user:"Import",date:new Date().toISOString().split("T")[0],text:e.notes.trim(),replies:[],deleted:!1}]:[],specs:{},reservations:[],reminders:[],viewCount:0,checkoutCount:0};Object.entries(e).forEach(([s,l])=>{if(s.startsWith("spec:")&&l?.trim()){const p=s.substring(5);o.specs[p]=l.trim()}}),n.push(o)}),r.length>0){y(`Import errors:
${r.slice(0,5).join(`
`)}${r.length>5?`
... and ${r.length-5} more`:""}`),C(!1);return}await B(n),b()}catch(n){y(n.message||"Import failed")}finally{C(!1)}}};return t.jsxs(_,{onClose:b,maxWidth:600,children:[t.jsx(G,{title:"Import from CSV",onClose:b}),t.jsxs("div",{style:{padding:a[4]},children:[t.jsxs("div",{style:{background:`${w(i.primary,10)}`,borderRadius:j.lg,padding:a[4],marginBottom:a[4]},children:[t.jsx("h4",{style:{margin:`0 0 ${a[2]}px`,color:i.textPrimary,fontSize:f.fontSize.base},children:"Need a template?"}),t.jsx("p",{style:{color:i.textSecondary,fontSize:f.fontSize.sm,marginBottom:a[3]},children:"Download our CSV template with all available columns and example data."}),t.jsx(v,{variant:"secondary",onClick:q,icon:H,children:"Download Template"})]}),t.jsxs("div",{onClick:()=>L.current?.click(),style:{border:`2px dashed ${i.border}`,borderRadius:j.lg,padding:a[6],textAlign:"center",cursor:"pointer",marginBottom:a[4],transition:"border-color 0.2s"},children:[t.jsx(E,{size:32,color:i.textMuted,style:{marginBottom:a[2]}}),t.jsx("p",{style:{color:i.textPrimary,margin:`0 0 ${a[1]}px`},children:R?R.name:"Click to select CSV file"}),t.jsx("p",{style:{color:i.textMuted,margin:0,fontSize:f.fontSize.sm},children:"or drag and drop"}),t.jsx("input",{ref:L,type:"file",accept:".csv,text/csv",onChange:U,style:{display:"none"}})]}),I&&t.jsx("div",{style:{background:`${w(i.danger,20)}`,border:`1px solid ${w(i.danger,50)}`,borderRadius:j.md,padding:a[3],marginBottom:a[4],color:i.danger,fontSize:f.fontSize.sm,whiteSpace:"pre-line"},children:I}),d&&t.jsxs("div",{style:{marginBottom:a[4]},children:[t.jsxs("h4",{style:{margin:`0 0 ${a[2]}px`,color:i.textPrimary},children:["Preview (",d.rows.length," items)"]}),t.jsxs("div",{style:{background:i.bgLight,borderRadius:j.md,maxHeight:200,overflowY:"auto"},children:[t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:f.fontSize.sm},children:[t.jsx("thead",{children:t.jsx("tr",{children:["name","brand","category","status"].map(n=>t.jsx("th",{style:{textAlign:"left",padding:a[2],borderBottom:`1px solid ${i.border}`,color:i.textMuted,fontWeight:f.fontWeight.medium},children:n},n))})}),t.jsx("tbody",{children:d.rows.slice(0,5).map((n,r)=>t.jsx("tr",{children:["name","brand","category","status"].map(e=>t.jsx("td",{style:{padding:a[2],borderBottom:`1px solid ${i.borderLight}`,color:i.textPrimary},children:n[e]||"-"},e))},r))})]}),d.rows.length>5&&t.jsxs("p",{style:{color:i.textMuted,fontSize:f.fontSize.xs,textAlign:"center",padding:a[2],margin:0},children:["... and ",d.rows.length-5," more items"]})]})]}),t.jsxs("div",{style:{display:"flex",gap:a[3],justifyContent:"flex-end"},children:[t.jsx(v,{variant:"secondary",onClick:b,children:"Cancel"}),t.jsx(v,{onClick:T,disabled:!d||S,icon:S?null:E,children:S?"Importing...":`Import ${d?.rows.length||0} Items`})]})]})]})});J.propTypes={categories:m.arrayOf(m.string).isRequired,specs:m.objectOf(m.arrayOf(m.shape({name:m.string.isRequired,required:m.bool}))),onImport:m.func.isRequired,onClose:m.func.isRequired};export{J as CSVImportModal};
//# sourceMappingURL=CSVImportModal-gEvdy65k.js.map
