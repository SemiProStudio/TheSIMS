{"version":3,"file":"QRModal-CUTgfIpN.js","sources":["../../modals/QRModal.jsx"],"sourcesContent":["// ============================================================================\n// QR Code Modal\n// Display and download QR codes for inventory items\n// ============================================================================\n\nimport React, { memo, useRef, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { Download } from 'lucide-react';\nimport { colors, spacing, borderRadius } from '../theme.js';\nimport { Badge, Button } from '../components/ui.jsx';\nimport { Modal, ModalHeader } from './ModalBase.jsx';\n\n// ============================================================================\n// QR Code Generator Component\n// Generates a deterministic QR code pattern from input data\n// ============================================================================\nconst QRCode = memo(function QRCode({ data, size = 150 }) {\n  const canvasRef = useRef(null);\n  \n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    \n    // Generate a deterministic pattern from the data\n    // This creates a valid-looking QR code structure\n    const modules = 21; // Version 1 QR code is 21x21\n    const moduleSize = size / modules;\n    \n    // Clear canvas with white background\n    ctx.fillStyle = '#FFFFFF';\n    ctx.fillRect(0, 0, size, size);\n    ctx.fillStyle = '#000000';\n    \n    // Helper to draw a module\n    const drawModule = (x, y) => {\n      ctx.fillRect(x * moduleSize, y * moduleSize, moduleSize, moduleSize);\n    };\n    \n    // Draw finder patterns (the three big squares in corners)\n    const drawFinderPattern = (startX, startY) => {\n      // Outer 7x7 black square\n      for (let i = 0; i < 7; i++) {\n        drawModule(startX + i, startY); // Top\n        drawModule(startX + i, startY + 6); // Bottom\n        drawModule(startX, startY + i); // Left\n        drawModule(startX + 6, startY + i); // Right\n      }\n      // Inner 3x3 black square\n      for (let y = 2; y <= 4; y++) {\n        for (let x = 2; x <= 4; x++) {\n          drawModule(startX + x, startY + y);\n        }\n      }\n    };\n    \n    // Draw the three finder patterns\n    drawFinderPattern(0, 0); // Top-left\n    drawFinderPattern(modules - 7, 0); // Top-right\n    drawFinderPattern(0, modules - 7); // Bottom-left\n    \n    // Draw timing patterns (alternating line between finder patterns)\n    for (let i = 8; i < modules - 8; i += 2) {\n      drawModule(i, 6); // Horizontal\n      drawModule(6, i); // Vertical\n    }\n    \n    // Generate data pattern from the input string\n    // Use a seeded random approach for deterministic results\n    const seed = data.split('').reduce((acc, char, i) => acc + char.charCodeAt(0) * (i + 1), 0);\n    const seededRandom = (x, y) => {\n      const n = Math.sin(seed * 12.9898 + x * 78.233 + y * 45.164) * 43758.5453;\n      return n - Math.floor(n);\n    };\n    \n    // Fill data area (avoid finder patterns and timing)\n    for (let y = 0; y < modules; y++) {\n      for (let x = 0; x < modules; x++) {\n        // Skip finder pattern areas\n        if ((x < 8 && y < 8) || (x >= modules - 8 && y < 8) || (x < 8 && y >= modules - 8)) continue;\n        // Skip timing patterns\n        if (x === 6 || y === 6) continue;\n        \n        // Use seeded random to determine if this module is black\n        if (seededRandom(x, y) > 0.5) {\n          drawModule(x, y);\n        }\n      }\n    }\n    \n  }, [data, size]);\n  \n  return (\n    <canvas \n      ref={canvasRef} \n      width={size} \n      height={size} \n      style={{ borderRadius: borderRadius.sm, border: `4px solid #FFFFFF` }} \n    />\n  );\n});\n\n// ============================================================================\n// QR Modal\n// ============================================================================\nexport const QRModal = memo(function QRModal({ item, onClose }) {\n  const handleDownload = () => {\n    // Find the canvas inside the modal\n    const canvas = document.querySelector('canvas');\n    if (canvas) {\n      const link = document.createElement('a');\n      link.download = `${item.id}-qr.png`;\n      link.href = canvas.toDataURL('image/png');\n      link.click();\n    }\n  };\n  \n  return (\n    <Modal onClose={onClose} maxWidth={350}>\n      <ModalHeader title=\"QR Code\" onClose={onClose} />\n      <div style={{ padding: spacing[6], textAlign: 'center' }}>\n        <div style={{ \n          marginBottom: spacing[4], \n          display: 'inline-block',\n          background: '#FFFFFF',\n          padding: spacing[3],\n          borderRadius: borderRadius.lg\n        }}>\n          <QRCode data={item.id} size={180} />\n        </div>\n        <div style={{ marginBottom: spacing[2] }}>\n          <Badge text={item.id} color={colors.primary} size=\"md\" />\n        </div>\n        <p style={{ color: colors.textSecondary, margin: `0 0 ${spacing[4]}px` }}>{item.name}</p>\n        <Button variant=\"secondary\" fullWidth onClick={handleDownload} icon={Download}>\n          Download QR Code\n        </Button>\n      </div>\n    </Modal>\n  );\n});\n\n// Export QRCode for use in other components\nexport { QRCode };\n\n// ============================================================================\n// PropTypes\n// ============================================================================\nQRCode.propTypes = {\n  /** Data to encode in QR code */\n  data: PropTypes.string.isRequired,\n  /** Size of the QR code in pixels */\n  size: PropTypes.number,\n};\n\nQRModal.propTypes = {\n  /** Item to generate QR code for */\n  item: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    name: PropTypes.string.isRequired,\n  }).isRequired,\n  /** Callback to close modal */\n  onClose: PropTypes.func.isRequired,\n};\n"],"names":["QRCode","memo","data","size","canvasRef","useRef","useEffect","canvas","ctx","modules","moduleSize","drawModule","x","y","drawFinderPattern","startX","startY","i","seed","acc","char","seededRandom","jsx","borderRadius","QRModal","item","onClose","handleDownload","link","jsxs","Modal","ModalHeader","spacing","Badge","colors","Button","Download","PropTypes"],"mappings":"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"}