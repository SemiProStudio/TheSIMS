import{R as F,j as e,a as l,c as s,s as h,t as u,i as S,w as k,S as H,T as ee,D as J,B as N,d as O,J as a}from"./index-TtmnPN12.js";import{a as c,c as L,d as U,t as te,b as V,$ as se,X as ne}from"./vendor-icons-B6HpBdFH.js";import{M as le,a as ae}from"./ModalBase-BgtxHV_N.js";import"./vendor-react-DwPMHwnM.js";const ie=c.memo(function({inventory:o,selectedItemIds:n,onAddItem:g,placeholder:b="Search items by name, ID, or brand..."}){const[y,v]=c.useState(""),[I,x]=c.useState(!1),C=c.useRef(null),m=c.useRef(null),w=c.useMemo(()=>{if(!y.trim())return[];const d=y.toLowerCase();return o.filter(r=>!n.includes(r.id)&&(r.status==="available"||r.status==="reserved")&&(r.name?.toLowerCase().includes(d)||r.id?.toLowerCase().includes(d)||r.brand?.toLowerCase().includes(d)||r.category?.toLowerCase().includes(d))).slice(0,10)},[y,o,n]);c.useEffect(()=>{const d=r=>{m.current&&!m.current.contains(r.target)&&C.current&&!C.current.contains(r.target)&&x(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const z=d=>{g(d),v(""),x(!1),C.current?.focus()};return e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(se,{size:16,style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:s.textMuted}}),e.jsx("input",{ref:C,type:"text",value:y,onChange:d=>{v(d.target.value),x(!0)},onFocus:()=>x(!0),placeholder:b,style:{...h.input,paddingLeft:40}})]}),I&&y.trim()&&e.jsx("div",{ref:m,style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:s.bgMedium,border:`1px solid ${s.border}`,borderRadius:S.lg,boxShadow:"0 4px 20px rgba(0,0,0,0.3)",zIndex:100,maxHeight:300,overflowY:"auto"},children:w.length===0?e.jsxs("div",{style:{padding:l[4],textAlign:"center",color:s.textMuted,fontSize:u.fontSize.sm},children:['No items found matching "',y,'"']}):w.map(d=>e.jsxs("div",{onClick:()=>z(d),style:{padding:l[3],display:"flex",alignItems:"center",gap:l[3],cursor:"pointer",borderBottom:`1px solid ${s.borderLight}`,transition:"background 0.15s ease"},onMouseEnter:r=>r.currentTarget.style.background=k(s.primary,15),onMouseLeave:r=>r.currentTarget.style.background="transparent",children:[d.image?e.jsx("img",{src:d.image,alt:"",style:{width:40,height:40,borderRadius:S.md,objectFit:"cover"}}):e.jsx("div",{style:{width:40,height:40,borderRadius:S.md,background:k(s.primary,15),display:"flex",alignItems:"center",justifyContent:"center",color:s.textMuted,fontSize:u.fontSize.xs},children:e.jsx(L,{size:16})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:u.fontWeight.medium,color:s.textPrimary,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:d.name}),e.jsxs("div",{style:{fontSize:u.fontSize.sm,color:s.textMuted,display:"flex",gap:l[2],alignItems:"center"},children:[e.jsx(O,{text:d.id,color:s.primary}),e.jsx("span",{children:d.brand}),d.status==="reserved"&&e.jsx(O,{text:"Has Reservations",color:s.warning})]})]}),e.jsx(V,{size:18,style:{color:s.primary}})]},d.id))})]})}),re=c.memo(function({item:o,onRemove:n,conflicts:g}){const b=g?.hasConflicts;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l[3],padding:l[3],background:b?k(s.warning,10):k(s.primary,10),border:`1px solid ${b?s.warning:k(s.primary,30)}`,borderRadius:S.md},children:[o.image?e.jsx("img",{src:o.image,alt:"",style:{width:48,height:48,borderRadius:S.md,objectFit:"cover"}}):e.jsx("div",{style:{width:48,height:48,borderRadius:S.md,background:s.bgDark,display:"flex",alignItems:"center",justifyContent:"center",color:s.textMuted},children:e.jsx(L,{size:20})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:u.fontWeight.medium,color:s.textPrimary,marginBottom:2},children:o.name}),e.jsxs("div",{style:{fontSize:u.fontSize.sm,color:s.textMuted,display:"flex",gap:l[2],alignItems:"center",flexWrap:"wrap"},children:[e.jsx(O,{text:o.id,color:s.primary}),e.jsxs("span",{children:[o.brand," â€¢ ",o.category]})]}),b&&e.jsxs("div",{style:{marginTop:l[1],fontSize:u.fontSize.xs,color:s.warning,display:"flex",alignItems:"center",gap:l[1]},children:[e.jsx(U,{size:12}),g.reservationConflicts?.length>0?`${g.reservationConflicts.length} scheduling conflict(s)`:"Item currently checked out"]})]}),n&&e.jsx("button",{onClick:()=>n(o.id),style:{background:"transparent",border:"none",padding:l[1],cursor:"pointer",color:s.textMuted,borderRadius:S.md,display:"flex",alignItems:"center",justifyContent:"center"},title:"Remove item",children:e.jsx(ne,{size:18})})]})}),de=c.memo(function({isEdit:o,reservationForm:n,setReservationForm:g,onSave:b,onClose:y,clients:v=[],inventory:I=[],item:x=null,editingReservationId:C=null}){const[m,w]=c.useState({}),[z,d]=c.useState(!1),[r,R]=c.useState([]);c.useEffect(()=>{if(x)R([x]);else if(n.itemIds?.length)R(I.filter(t=>n.itemIds.includes(t.id)));else if(n.itemId){const t=I.find(i=>i.id===n.itemId);R(t?[t]:[])}else R([])},[x,n.itemIds,n.itemId,I]);const X=c.useCallback(t=>{R(i=>[...i,t]),g(i=>({...i,itemIds:[...i.itemIds||[],t.id],itemId:t.id}))},[g]),_=c.useCallback(t=>{R(i=>i.filter(p=>p.id!==t)),g(i=>{const p=(i.itemIds||[]).filter(j=>j!==t);return{...i,itemIds:p,itemId:p[0]||""}})},[g]),f=(t,i)=>{if(w(p=>({...p,[t]:!0})),(t==="start"||t==="end")&&d(!1),t==="start"&&n.end&&i>n.end)g(p=>({...p,start:i,end:i}));else if(t==="clientId"&&i){const p=v.find(j=>j.id===i);g(p?j=>({...j,clientId:i,contactPhone:p.phone||j.contactPhone,contactEmail:p.email||j.contactEmail}):j=>({...j,[t]:i}))}else g(p=>({...p,[t]:i}))},A=t=>{w(i=>({...i,[t]:!0}))},E=c.useMemo(()=>{const t={};return n.start&&n.end&&r.forEach(i=>{t[i.id]=F(i,n.start,n.end,o?C:null)}),t},[r,n.start,n.end,o,C]),B=c.useMemo(()=>Object.values(E).some(t=>t.hasConflicts),[E]),G=n.start&&n.end&&n.end>=n.start,K=r.length>0&&n.project?.trim()&&G&&n.user?.trim(),W=n.start&&n.end&&n.end<n.start,T=K&&(!B||z),Z=c.useCallback(()=>{if(w({project:!0,start:!0,end:!0,user:!0,contactEmail:!0}),T){const t=r.map(i=>i.id);g(i=>({...i,itemIds:t,itemId:t[0]||""})),b()}},[T,b,r,g]),M=m.project&&!n.project,P=m.start&&!n.start,D=m.end&&(!n.end||W),$=m.user&&!n.user,Y=(t,i)=>({...h.input,borderColor:t||i?s.danger:s.border,boxShadow:t?`0 0 0 1px ${s.danger}`:void 0});return e.jsxs(le,{onClose:y,maxWidth:600,children:[e.jsx(ae,{title:o?"Edit Reservation":"Add Reservation",onClose:y}),e.jsxs("div",{style:{padding:l[4],maxHeight:"75vh",overflowY:"auto"},children:[e.jsxs("div",{style:{marginBottom:l[4],paddingBottom:l[4],borderBottom:`1px solid ${s.borderLight}`},children:[e.jsxs("label",{style:{...h.label,marginBottom:l[2],display:"flex",alignItems:"center",gap:l[2]},children:[e.jsx(L,{size:16}),x?"Item to Reserve":"Select Items to Reserve",r.length===0&&e.jsx("span",{style:{color:s.danger},children:"*"})]}),!o&&!x&&e.jsx(ie,{inventory:I,selectedItemIds:r.map(t=>t.id),onAddItem:X}),r.length>0&&e.jsxs("div",{style:{marginTop:l[3],display:"flex",flexDirection:"column",gap:l[2]},children:[!x&&r.length>1&&e.jsxs("div",{style:{fontSize:u.fontSize.sm,color:s.textMuted,marginBottom:l[1]},children:[r.length," items selected:"]}),r.map(t=>e.jsx(re,{item:t,onRemove:o||x?null:_,conflicts:E[t.id]},t.id))]}),r.length===0&&m.project&&e.jsx("p",{style:{color:s.danger,fontSize:u.fontSize.sm,marginTop:l[2]},children:"Please select at least one item to reserve"})]}),B&&e.jsxs("div",{style:{background:k(s.warning,15),border:`1px solid ${s.warning}`,borderRadius:S.lg,padding:l[3],marginBottom:l[4]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l[2],marginBottom:l[2],color:s.warning,fontWeight:u.fontWeight.semibold},children:[e.jsx(U,{size:18}),e.jsx("span",{children:"Scheduling Conflicts Detected"})]}),e.jsx("p",{style:{fontSize:u.fontSize.sm,color:s.textSecondary,marginBottom:l[2]},children:"One or more selected items have scheduling conflicts for the selected dates. You can still proceed if needed."}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:l[2],cursor:"pointer",fontSize:u.fontSize.sm,color:s.textSecondary},children:[e.jsx("input",{type:"checkbox",checked:z,onChange:t=>d(t.target.checked),style:{width:16,height:16}}),"I understand and want to proceed anyway"]})]}),v.length>0&&e.jsxs("div",{style:{marginBottom:l[3]},children:[e.jsx("label",{style:h.label,children:"Client (Optional)"}),e.jsx(H,{value:n.clientId||"",onChange:t=>f("clientId",t.target.value),options:[{value:"",label:"-- Select a client --"},...v.map(t=>({value:t.id,label:t.name+(t.company?` (${t.company})`:"")}))],"aria-label":"Client"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:l[3],marginBottom:l[3]},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{...h.label,color:M?s.danger:void 0},children:["Project Name ",e.jsx("span",{style:{color:s.danger},children:"*"})]}),e.jsx("input",{value:n.project||"",onChange:t=>f("project",t.target.value),onBlur:()=>A("project"),placeholder:"e.g., Wedding - Smith/Jones",style:Y(M,!n.project)}),M&&e.jsx("p",{style:{color:s.danger,fontSize:u.fontSize.xs,margin:`${l[1]}px 0 0`},children:"Required"})]}),e.jsxs("div",{children:[e.jsx("label",{style:h.label,children:"Project Type"}),e.jsx(H,{value:n.projectType||"Other",onChange:t=>f("projectType",t.target.value),options:ee.map(t=>({value:t,label:t})),"aria-label":"Project type"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:l[3],marginBottom:l[3]},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{...h.label,color:P?s.danger:void 0},children:["Start Date ",e.jsx("span",{style:{color:s.danger},children:"*"})]}),e.jsx(J,{value:n.start||"",onChange:t=>f("start",t.target.value),error:P,placeholder:"Select start date","aria-label":"Start date"}),P&&e.jsx("p",{style:{color:s.danger,fontSize:u.fontSize.xs,margin:`${l[1]}px 0 0`},children:"Required"})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{...h.label,color:D?s.danger:void 0},children:["End Date / Due Back ",e.jsx("span",{style:{color:s.danger},children:"*"})]}),e.jsx(J,{value:n.end||"",onChange:t=>f("end",t.target.value),min:n.start||void 0,error:D,placeholder:"Select end date","aria-label":"End date"}),W&&e.jsx("p",{style:{color:s.danger,fontSize:u.fontSize.xs,margin:`${l[1]}px 0 0`},children:"End date must be on or after start date"})]})]}),e.jsxs("div",{style:{marginBottom:l[3]},children:[e.jsxs("label",{style:{...h.label,color:$?s.danger:void 0},children:["Reserved By ",e.jsx("span",{style:{color:s.danger},children:"*"})]}),e.jsx("input",{value:n.user||"",onChange:t=>f("user",t.target.value),onBlur:()=>A("user"),placeholder:"e.g., John Smith",style:Y($,!n.user)}),$&&e.jsx("p",{style:{color:s.danger,fontSize:u.fontSize.xs,margin:`${l[1]}px 0 0`},children:"Required"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:l[3],marginBottom:l[3]},children:[e.jsxs("div",{children:[e.jsx("label",{style:h.label,children:"Contact Phone"}),e.jsx("input",{type:"tel",value:n.contactPhone||"",onChange:t=>f("contactPhone",t.target.value),placeholder:"555-123-4567",style:h.input})]}),e.jsxs("div",{children:[e.jsx("label",{style:h.label,children:"Contact Email"}),e.jsx("input",{type:"email",value:n.contactEmail||"",onChange:t=>f("contactEmail",t.target.value),placeholder:"email@example.com",style:h.input})]})]}),e.jsxs("div",{style:{marginBottom:l[4]},children:[e.jsx("label",{style:h.label,children:"Location"}),e.jsx("input",{value:n.location||"",onChange:t=>f("location",t.target.value),placeholder:"Address or venue name",style:h.input})]}),e.jsxs("div",{style:{display:"flex",gap:l[3],justifyContent:"flex-end"},children:[e.jsx(N,{variant:"secondary",onClick:y,children:"Cancel"}),e.jsx(N,{onClick:Z,disabled:!T,icon:o?te:V,style:B&&z?{background:s.warning}:void 0,children:o?"Save Changes":B&&z?"Save Anyway":`Add Reservation${r.length>1?` (${r.length} items)`:""}`})]})]})]})}),oe=a.shape({project:a.string,projectType:a.string,start:a.string,end:a.string,user:a.string,clientId:a.string,contactPhone:a.string,contactEmail:a.string,location:a.string,itemId:a.string,itemIds:a.arrayOf(a.string)}),ce=a.shape({id:a.string.isRequired,name:a.string.isRequired,company:a.string,phone:a.string,email:a.string}),Q=a.shape({id:a.string.isRequired,name:a.string,brand:a.string,category:a.string,image:a.string,status:a.string,reservations:a.array});de.propTypes={isEdit:a.bool,reservationForm:oe.isRequired,setReservationForm:a.func.isRequired,onSave:a.func.isRequired,onClose:a.func.isRequired,clients:a.arrayOf(ce),inventory:a.arrayOf(Q),item:Q,editingReservationId:a.string};export{de as ReservationModal};
//# sourceMappingURL=ReservationModal-BlRQRL7y.js.map
