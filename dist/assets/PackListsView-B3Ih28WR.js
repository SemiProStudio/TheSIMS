import{u as Ye,e as ne,l as Ke,m as ie,j as e,s as v,c as r,a as o,B as N,t as z,b as le,S as Ve,d as I,C as ke,h as Je,i as Ze,w as V,g as Ge,k as Se,E as Ue}from"./index-TtmnPN12.js";import{a as i,R as et,P as ve,b as Ne,e as tt,f as st,g as at,B as we,A as nt,D as it,T as Pe,C as lt,h as rt,i as ct}from"./vendor-icons-B6HpBdFH.js";import{o as ot}from"./printUtil-TDGEm20O.js";import"./vendor-react-DwPMHwnM.js";function dt({packLists:f,setPackLists:w,inventory:D,packages:p,categorySettings:re,onViewItem:$e,addAuditLog:g,currentUser:$,initialSelectedList:O=null,onListSelect:J}){const b=Ye(),[Le,ce]=i.useState(O),[Ee,L]=i.useState(!1),[qe,Z]=i.useState(!1),[Be,G]=i.useState(!1),[P,F]=i.useState({isOpen:!1,id:null,name:""}),x=i.useCallback(s=>{ce(s),J&&J(s)},[J]);et.useEffect(()=>{O&&ce(O)},[O]);const m=Le,[W,oe]=i.useState(""),[j,U]=i.useState(""),[de,T]=i.useState(""),[C,E]=i.useState([]),[u,M]=i.useState([]),[_,Q]=i.useState({}),[H,ee]=i.useState(""),[q,te]=i.useState(""),[B,me]=i.useState("all"),[ze,he]=i.useState(new Set),[y,pe]=i.useState(null),[k,Ie]=i.useState("category"),[A,De]=i.useState("M"),[R,Fe]=i.useState("print"),X=i.useMemo(()=>D.filter(s=>!s.isKit),[D]),Me=i.useMemo(()=>{const s=new Set(X.map(t=>t.category).filter(Boolean));return["all",...Array.from(s).sort()]},[X]),Oe=i.useCallback(s=>re?.[s.category]?.trackQuantity===!0,[re]),Y=i.useMemo(()=>{const s=new Map;return p.forEach(t=>{(t.items||[]).forEach(n=>{s.has(n)||s.set(n,[]),s.get(n).push(t.id)})}),s},[p]),ue=i.useMemo(()=>{if(!H.trim())return p;const s=H.toLowerCase();return p.filter(t=>t.name.toLowerCase().includes(s)||t.id.toLowerCase().includes(s))},[p,H]),xe=i.useMemo(()=>{if(!W.trim())return f;const s=W.toLowerCase();return f.filter(t=>t.name.toLowerCase().includes(s))},[f,W]),fe=i.useMemo(()=>{let s=X;if(B!=="all"&&(s=s.filter(t=>t.category===B)),q.trim()){const t=q.toLowerCase();s=s.filter(n=>n.name.toLowerCase().includes(t)||n.id.toLowerCase().includes(t)||n.category.toLowerCase().includes(t))}return s},[X,q,B]),se=i.useCallback(s=>{const t=p.find(a=>a.id===s);if(!t||!t.items||t.items.length===0)return"none";if(C.includes(s))return"full";const n=t.items.filter(a=>u.includes(a)).length;return n===0?"none":n===t.items.length?"full":"partial"},[p,C,u]),ge=i.useCallback(s=>{const t=p.find(a=>a.id===s);if(!t)return;se(s)==="full"?(E(a=>a.filter(l=>l!==s)),M(a=>a.filter(l=>!t.items.includes(l)))):(E(a=>a.includes(s)?a:[...a,s]),M(a=>[...new Set([...a,...t.items])]))},[p,se]),ye=i.useCallback(s=>{M(t=>{const n=t.includes(s)?t.filter(l=>l!==s):[...t,s];return(Y.get(s)||[]).forEach(l=>{const c=p.find(h=>h.id===l);if(!c)return;const d=c.items.every(h=>h===s?!t.includes(s):n.includes(h));d&&!t.includes(s)?E(h=>h.includes(l)?h:[...h,l]):!d&&C.includes(l)&&E(h=>h.filter(Xe=>Xe!==l))}),n})},[Y,p,C]),We=i.useCallback((s,t)=>{const n=parseInt(t,10);isNaN(n)||n<1?Q(a=>{const l={...a};return delete l[s],l}):Q(a=>({...a,[s]:n}))},[]),Te=i.useCallback((s,t)=>{t.stopPropagation(),he(n=>{const a=new Set(n);return a.has(s)?a.delete(s):a.add(s),a})},[]),S=i.useCallback(()=>{U(""),T(""),E([]),M([]),Q({}),ee(""),te(""),me("all"),he(new Set),pe(null)},[]),je=i.useCallback(()=>{if(y){const s=f.find(t=>t.id===y.id);s&&x(s)}L(!1),Z(!1),S()},[S,y,f,x]),Ce=i.useCallback(()=>{const s=j.trim();if(!s){T("Pack list name is required");return}if(f.some(n=>n.name.toLowerCase()===s.toLowerCase())){T("A pack list with this name already exists");return}Z(!1),L(!0)},[j,f]),_e=i.useCallback(()=>{S(),Z(!0)},[S]),Qe=i.useCallback(s=>{U(s.name),E(s.packages||[]);const t=(s.items||[]).map(a=>typeof a=="string"?a:a.id);M(t);const n={};(s.items||[]).forEach(a=>{typeof a=="object"&&a.id&&(n[a.id]=a.quantity||1)}),Q(n),pe(s),x(null),L(!0)},[x]),He=i.useCallback(async()=>{if(!(!j.trim()||u.length===0))if(y){const s={...y,name:j.trim(),packages:[...C],items:u.map(t=>({id:t,quantity:_[t]||1})),updatedAt:new Date().toISOString()};if(b?.updatePackList)try{await b.updatePackList(y.id,s)}catch(t){ne("Failed to update pack list:",t),w(n=>n.map(a=>a.id===y.id?s:a))}else w(t=>t.map(n=>n.id===y.id?s:n));g&&g({type:"pack_list_updated",description:`Pack list "${s.name}" updated with ${u.length} items`,user:$?.name||"Unknown",packListId:s.id}),S(),L(!1),x(s)}else{const s={name:j.trim(),packages:[...C],items:u.map(t=>({id:t,quantity:_[t]||1}))};if(b?.createPackList)try{const t=await b.createPackList(s);g&&g({type:"pack_list_created",description:`Pack list "${t.name}" created with ${u.length} items`,user:$?.name||"Unknown",packListId:t.id}),S(),L(!1),x(t)}catch(t){ne("Failed to create pack list:",t)}else{const t={...s,id:Ke(),createdAt:new Date().toISOString()};w(n=>[...n,t]),g&&g({type:"pack_list_created",description:`Pack list "${t.name}" created with ${u.length} items`,user:$?.name||"Unknown",packListId:t.id}),S(),L(!1),x(t)}}},[j,C,u,_,w,S,g,$,y,x,b]),be=i.useCallback(async s=>{const t=f.find(n=>n.id===s);if(b?.deletePackList)try{await b.deletePackList(s)}catch(n){ne("Failed to delete pack list:",n),w(a=>a.filter(l=>l.id!==s))}else w(n=>n.filter(a=>a.id!==s));g&&t&&g({type:"pack_list_deleted",description:`Pack list "${t.name}" deleted`,user:$?.name||"Unknown",packListId:s}),m?.id===s&&x(null),F({isOpen:!1,id:null,name:""})},[w,m,g,$,f,b]),K=i.useCallback(s=>(s.items||[]).map(t=>{const n=D.find(a=>a.id===(t.id||t));return n?{...n,quantity:t.quantity||1}:null}).filter(Boolean),[D]),ae=i.useCallback(s=>[...s].sort((t,n)=>k==="category"?t.category.localeCompare(n.category):k==="alphabetical"?t.name.localeCompare(n.name):0),[k]),Ae=i.useCallback(()=>{if(!m)return;const s=ae(K(m));if(R==="clipboard"){const t=s.map(n=>`${n.quantity}x	${n.id}	${n.name}	${n.category}`).join(`
`);navigator.clipboard.writeText(t),alert("Copied to clipboard!")}else{const t={XS:10,S:12,M:14,L:16,XL:18}[A];let n="";if(k==="category"){const l={};s.forEach(c=>{l[c.category]||(l[c.category]=[]),l[c.category].push(c)}),Object.entries(l).forEach(([c,d])=>{n+=`
            <tr class="category-header"><td colspan="4"><strong>${c}</strong></td></tr>
            ${d.map(h=>`
              <tr>
                <td class="check">☐</td>
                <td class="qty">${h.quantity}</td>
                <td>${h.id}</td>
                <td>${h.name}</td>
              </tr>
            `).join("")}
          `})}else n=s.map(l=>`
          <tr>
            <td class="check">☐</td>
            <td class="qty">${l.quantity}</td>
            <td>${l.id}</td>
            <td>${l.name}</td>
            <td>${l.category}</td>
          </tr>
        `).join("");const a=k!=="category"?"<th>Category</th>":"";ot({title:m.name,styles:`
          body { font-family: system-ui; font-size: ${t}px; padding: 20px; }
          table { width: 100%; border-collapse: collapse; }
          th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
          th { background: #f5f5f5; }
          .qty { width: 60px; text-align: center; }
          .check { width: 30px; }
          .category-header { 
            background: #e8e8e8; 
            page-break-after: avoid;
          }
          .category-header td {
            padding: 12px 8px;
            border-bottom: 2px solid #ccc;
          }
          @media print {
            .category-header { break-after: avoid; }
            tr { break-inside: avoid; }
          }
        `,body:`
          <h1>${m.name}</h1>
          <p>Created: ${ie(m.createdAt)} | Items: ${s.length}</p>
          <table>
            <thead><tr><th class="check">✓</th><th class="qty">Qty</th><th>ID</th><th>Name</th>${a}</tr></thead>
            <tbody>${n}</tbody>
          </table>
        `,delay:0})}G(!1)},[m,K,ae,R,A,k]),Re=i.useCallback(s=>(Y.get(s)||[]).map(t=>p.find(n=>n.id===t)).filter(Boolean),[Y,p]);if(qe){const s=!j.trim();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-header",children:e.jsx("h2",{className:"page-title",children:"Pack Lists"})}),e.jsx("div",{className:"modal-backdrop",style:v.modal,children:e.jsxs("div",{style:{...v.modalBox,maxWidth:400},onClick:t=>t.stopPropagation(),children:[e.jsx("div",{style:{padding:o[4],borderBottom:`1px solid ${r.borderLight}`},children:e.jsx("h3",{style:{margin:0,color:r.textPrimary},children:"New Pack List"})}),e.jsxs("div",{style:{padding:o[4]},children:[e.jsxs("label",{className:`form-label ${s?"label-required-empty":""}`,children:["Pack List Name ",e.jsx("span",{className:"required-indicator",children:"*"})]}),e.jsx("input",{type:"text",value:j,onChange:t=>{U(t.target.value),T("")},onKeyDown:t=>t.key==="Enter"&&Ce(),placeholder:"e.g., Smith Wedding - Jan 15",className:`input ${s?"input-required-empty":""}`,autoFocus:!0}),de&&e.jsx("span",{className:"required-error-text",children:de})]}),e.jsxs("div",{style:{padding:o[4],paddingTop:0,display:"flex",gap:o[2],justifyContent:"flex-end"},children:[e.jsx(N,{variant:"secondary",onClick:je,children:"Cancel"}),e.jsx(N,{onClick:Ce,disabled:s,children:"Continue"})]})]})})]})}if(Ee){const s=y!==null;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"calc(100vh - 60px)",overflow:"hidden",padding:o[4]},children:[e.jsxs("div",{className:"page-header",style:{flexShrink:0,marginBottom:o[4]},children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"page-title",children:[s?"Edit":"Create"," Pack List: ",j]}),e.jsxs("div",{style:{fontSize:z.fontSize.sm,color:r.textMuted,marginTop:4},children:[C.length," packages, ",u.length," items selected"]})]}),e.jsxs("div",{style:{display:"flex",gap:o[2]},children:[e.jsx(N,{variant:"secondary",onClick:je,children:"Cancel"}),e.jsx(N,{onClick:He,disabled:u.length===0,icon:s?ve:Ne,children:s?"Save Changes":"Create Pack List"})]})]}),e.jsxs("div",{style:{flex:1,minHeight:0,display:"grid",gridTemplateColumns:"1fr 1fr",gap:o[4]},children:[e.jsxs("div",{className:"selection-panel",style:{display:"flex",flexDirection:"column",overflow:"hidden",minHeight:0},children:[e.jsxs("div",{className:"panel-header",style:{flexShrink:0},children:[e.jsxs("div",{className:"panel-header-title",children:[e.jsx(tt,{size:16,color:r.primary}),e.jsx("strong",{children:"Packages"}),e.jsxs("span",{className:"panel-header-count",children:[C.length," selected"]})]}),e.jsx(le,{value:H,onChange:ee,onClear:()=>ee(""),placeholder:"Search packages..."})]}),e.jsxs("div",{className:"selection-list",style:{flex:"1 1 auto",overflowY:"auto",minHeight:0},children:[ue.map(t=>{const n=se(t.id),a=ze.has(t.id),l=t.items?.map(d=>D.find(h=>h.id===d)).filter(Boolean)||[];let c="selection-item";return n==="full"?c+=" selected":n==="partial"&&(c+=" partial"),e.jsxs("div",{children:[e.jsxs("div",{className:c,children:[e.jsx("input",{type:"checkbox",checked:n==="full",ref:d=>{d&&(d.indeterminate=n==="partial")},onChange:()=>ge(t.id)}),e.jsxs("div",{className:"selection-item-info",onClick:()=>ge(t.id),style:{cursor:"pointer"},children:[e.jsx("div",{className:"selection-item-name",children:t.name}),e.jsxs("div",{className:"selection-item-meta",children:[l.length," items",n==="partial"&&e.jsxs("span",{style:{color:r.primary,marginLeft:8},children:["(",t.items.filter(d=>u.includes(d)).length," selected)"]})]})]}),e.jsx("button",{className:"btn-icon",onClick:d=>Te(t.id,d),children:a?e.jsx(st,{size:16}):e.jsx(at,{size:16})})]}),a&&e.jsx("div",{className:"package-expand-content",children:l.map(d=>e.jsxs("div",{className:"package-expand-item",children:["• ",d.name," (",d.id,")",u.includes(d.id)&&e.jsx("span",{style:{color:r.primary},children:" ✓"})]},d.id))})]},t.id)}),ue.length===0&&e.jsx("p",{style:{color:r.textMuted,textAlign:"center",padding:16},children:"No packages found"})]})]}),e.jsxs("div",{className:"selection-panel",style:{display:"flex",flexDirection:"column",overflow:"hidden",minHeight:0},children:[e.jsxs("div",{className:"panel-header",style:{flexShrink:0,flexWrap:"wrap",gap:o[2]},children:[e.jsxs("div",{className:"panel-header-title",children:[e.jsx(we,{size:16,color:r.primary}),e.jsx("strong",{children:"Individual Items"}),e.jsxs("span",{className:"panel-header-count",children:[u.length," selected"]})]}),e.jsxs("div",{style:{display:"flex",gap:o[2],alignItems:"center",flexWrap:"wrap"},children:[e.jsx(Ve,{value:B,onChange:t=>me(t.target.value),options:Me.map(t=>({value:t,label:t==="all"?"All Categories":t})),style:{minWidth:"160px"}}),e.jsx(le,{value:q,onChange:te,onClear:()=>te(""),placeholder:"Search items..."})]})]}),e.jsx("div",{className:"selection-list",style:{flex:"1 1 auto",overflowY:"auto",minHeight:0},children:fe.length===0?e.jsxs("div",{style:{padding:o[4],textAlign:"center",color:r.textMuted},children:["No items found",B!=="all"?` in ${B}`:"",q&&` matching "${q}"`]}):fe.map(t=>{const n=u.includes(t.id),a=Re(t.id),l=Oe(t);return e.jsxs("div",{className:`selection-item ${n?"selected":""}`,onClick:()=>ye(t.id),style:{cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>ye(t.id),onClick:c=>c.stopPropagation()}),e.jsxs("div",{className:"selection-item-info",children:[e.jsx("div",{className:"selection-item-name",children:t.name}),e.jsxs("div",{className:"selection-item-meta",children:[t.id," • ",t.category,a.length>0&&e.jsxs("span",{className:"from-package",children:["(in: ",a.map(c=>c.name).join(", "),")"]})]})]}),l&&n&&e.jsxs("div",{className:"quantity-input-wrapper",onClick:c=>c.stopPropagation(),children:[e.jsx("label",{children:"Qty:"}),e.jsx("input",{type:"number",min:"1",value:_[t.id]||1,onChange:c=>We(t.id,c.target.value),style:v.input})]})]},t.id)})})]})]})]})}if(m){const s=K(m),t=ae(s),n=(m.packages||[]).map(a=>p.find(l=>l.id===a)).filter(Boolean);return e.jsxs("div",{className:"view-container",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("div",{className:"detail-header-left",children:[e.jsx("button",{className:"btn-icon",onClick:()=>x(null),children:e.jsx(nt,{size:18})}),e.jsxs("div",{className:"detail-header-info",children:[e.jsx("h2",{children:m.name}),e.jsxs("div",{className:"detail-header-meta",children:["Created ",ie(m.createdAt)," • ",s.length," items",n.length>0&&` • ${n.length} packages`]})]})]}),e.jsxs("div",{className:"detail-header-actions",children:[e.jsx(N,{variant:"secondary",onClick:()=>Qe(m),icon:ve,children:"Edit"}),e.jsx(N,{onClick:()=>G(!0),icon:it,children:"Export / Print"}),e.jsx("button",{className:"btn-icon danger",onClick:()=>F({isOpen:!0,id:m.id,name:m.name}),children:e.jsx(Pe,{size:16})})]})]}),n.length>0&&e.jsxs("div",{style:{marginBottom:o[4]},children:[e.jsx("h4",{style:{margin:`0 0 ${o[2]}px`,color:r.textSecondary,fontSize:z.fontSize.sm},children:"Packages Included:"}),e.jsx("div",{style:{display:"flex",gap:o[2],flexWrap:"wrap"},children:n.map(a=>e.jsx(I,{text:a.name,color:r.accent2},a.id))})]}),e.jsxs(ke,{padding:!1,style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:[e.jsx(Je,{title:`Items (${s.length})`}),e.jsx("div",{style:{flex:1,overflowY:"auto"},children:t.map(a=>e.jsxs("div",{className:"list-item",onClick:()=>$e(a.id,{returnTo:"packList",packListId:m?.id,backLabel:"Back to Pack List"}),children:[a.quantity>1&&e.jsxs("div",{style:{minWidth:32,height:32,borderRadius:Ze.md,background:V(r.primary,20),display:"flex",alignItems:"center",justifyContent:"center",fontWeight:z.fontWeight.semibold,color:r.primary,fontSize:z.fontSize.base},children:[a.quantity,"x"]}),e.jsxs("div",{className:"list-item-content",children:[e.jsxs("div",{className:"list-item-badges",children:[e.jsx(I,{text:a.id,color:r.primary}),e.jsx(I,{text:a.category,color:r.accent2})]}),e.jsx("div",{className:"list-item-title",children:a.name})]}),e.jsx(I,{text:a.status,color:Ge(a.status)}),e.jsx(lt,{size:16,color:r.textMuted})]},a.id))})]}),Be&&e.jsx("div",{className:"modal-backdrop",style:v.modal,onClick:()=>G(!1),children:e.jsxs("div",{onClick:a=>a.stopPropagation(),style:{...v.modalBox,maxWidth:450},children:[e.jsx("div",{style:{padding:o[4],borderBottom:`1px solid ${r.borderLight}`},children:e.jsx("h3",{style:{margin:0,color:r.textPrimary},children:"Export Pack List"})}),e.jsxs("div",{style:{padding:o[4]},children:[e.jsxs("div",{className:"form-section",children:[e.jsx("label",{className:"form-label",children:"Sort By"}),e.jsx("div",{style:{display:"flex",gap:8},children:[["category","Category"],["alphabetical","A-Z"]].map(([a,l])=>e.jsx("button",{onClick:()=>Ie(a),style:{...v.btnSec,flex:1,justifyContent:"center",background:k===a?V(r.primary,30):"transparent",borderColor:k===a?r.primary:r.border},children:l},a))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{className:"form-label",children:"Font Size"}),e.jsx("div",{style:{display:"flex",gap:8},children:["XS","S","M","L","XL"].map(a=>e.jsx("button",{onClick:()=>De(a),style:{...v.btnSec,flex:1,justifyContent:"center",background:A===a?V(r.primary,30):"transparent",borderColor:A===a?r.primary:r.border},children:a},a))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{className:"form-label",children:"Format"}),e.jsx("div",{style:{display:"flex",gap:8},children:[["print","Print",rt],["clipboard","Copy",ct]].map(([a,l,c])=>e.jsxs("button",{onClick:()=>Fe(a),style:{...v.btnSec,flex:1,justifyContent:"center",gap:8,background:R===a?V(r.primary,30):"transparent",borderColor:R===a?r.primary:r.border},children:[e.jsx(c,{size:14}),l]},a))})]}),e.jsx(N,{fullWidth:!0,onClick:Ae,children:"Export"})]})]})}),P.isOpen&&e.jsx(Se,{isOpen:P.isOpen,title:"Delete Pack List",message:`Are you sure you want to delete "${P.name}"? This action cannot be undone.`,onConfirm:()=>{be(P.id),x(null)},onCancel:()=>F({isOpen:!1,id:null,name:""})})]})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{className:"page-title",children:"Pack Lists"}),e.jsx(N,{onClick:_e,icon:Ne,children:"Create Pack List"})]}),e.jsx("div",{style:{marginBottom:o[4],maxWidth:300},children:e.jsx(le,{value:W,onChange:oe,onClear:()=>oe(""),placeholder:"Search pack lists..."})}),e.jsx("div",{style:{borderBottom:`1px solid ${r.border}`,marginBottom:o[4]}}),xe.length===0?e.jsx(Ue,{icon:we,title:f.length===0?"No Pack Lists Yet":"No Pack Lists Found",description:f.length===0?"Create a pack list to build a checklist of packages and items for a specific job or project.":"No pack lists match your search."}):e.jsx("div",{className:"card-grid",children:xe.map(s=>{const t=K(s),n=(s.packages||[]).map(a=>p.find(l=>l.id===a)).filter(Boolean);return e.jsxs(ke,{onClick:()=>x(s),className:"card-clickable",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:o[3]},children:[e.jsx("h3",{style:{margin:0,fontSize:z.fontSize.lg,color:r.textPrimary},children:s.name}),e.jsx("button",{className:"btn-icon danger",onClick:a=>{a.stopPropagation(),F({isOpen:!0,id:s.id,name:s.name})},children:e.jsx(Pe,{size:16})})]}),e.jsxs("div",{style:{display:"flex",gap:o[2],marginBottom:o[2],flexWrap:"wrap"},children:[e.jsx(I,{text:`${t.length} items`,color:r.primary}),n.length>0&&e.jsx(I,{text:`${n.length} packages`,color:r.accent2})]}),e.jsxs("div",{style:{fontSize:z.fontSize.sm,color:r.textMuted},children:["Created ",ie(s.createdAt)]})]},s.id)})}),e.jsx(Se,{isOpen:P.isOpen,title:"Delete Pack List",message:`Are you sure you want to delete "${P.name}"? This action cannot be undone.`,onConfirm:()=>be(P.id),onCancel:()=>F({isOpen:!1,id:null,name:""})})]})}const xt=i.memo(dt);export{xt as default};
//# sourceMappingURL=PackListsView-B3Ih28WR.js.map
