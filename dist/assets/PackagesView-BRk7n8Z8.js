import{u as we,e as G,j as e,s as ce,c as i,a as r,B as y,t as b,C as M,S as Pe,b as oe,d as v,g as de,f as me,h as he,O as ze,i as De,k as Ae,E as Ie}from"./index-TtmnPN12.js";import{a as t,P as xe,b as q,c as z,A as $e,T as Le,d as ue,C as Fe,L as Be}from"./vendor-icons-B6HpBdFH.js";import"./vendor-react-DwPMHwnM.js";function Ee({packages:h,setPackages:p,inventory:C,onViewItem:O,initialSelectedPackage:D=null,onPackageSelect:W}){const j=we(),[o,_]=t.useState(D),[ge,S]=t.useState(!1),[fe,A]=t.useState(!1),[x,I]=t.useState(null),[$,J]=t.useState(""),[L,H]=t.useState({isOpen:!1,id:null,name:""}),[u,T]=t.useState(""),[N,R]=t.useState(""),[F,V]=t.useState(""),[g,K]=t.useState([]),[k,Y]=t.useState(""),[Q,B]=t.useState(""),d=t.useCallback(s=>{_(s),W&&W(s)},[W]);t.useEffect(()=>{D&&_(D)},[D]);const E=t.useMemo(()=>C.filter(s=>!s.isKit),[C]),U=t.useMemo(()=>{if(!$.trim())return h;const s=$.toLowerCase();return h.filter(a=>a.name.toLowerCase().includes(s)||a.id.toLowerCase().includes(s)||a.description&&a.description.toLowerCase().includes(s))},[h,$]),pe=t.useMemo(()=>{const s=new Set(E.map(a=>a.category).filter(Boolean));return["all",...Array.from(s).sort()]},[E]),[w,X]=t.useState("all"),Z=t.useMemo(()=>{let s=E;if(w!=="all"&&(s=s.filter(a=>a.category===w)),k.trim()){const a=k.toLowerCase();s=s.filter(l=>l.name.toLowerCase().includes(a)||l.id.toLowerCase().includes(a)||l.category.toLowerCase().includes(a))}return s},[E,k,w]),ee=t.useCallback(s=>s.items?s.items.map(a=>C.find(l=>l.id===a)).filter(Boolean):[],[C]),je=t.useCallback(s=>{const a=new Set(s.items||[]),l=[],c=new Set;return s.items?.forEach(n=>{const m=C.find(P=>P.id===n);m&&m.requiredAccessories&&m.requiredAccessories.length>0&&m.requiredAccessories.forEach(P=>{if(!a.has(P)&&!c.has(P)){const re=C.find(ke=>ke.id===P);re&&(l.push({item:re,reason:`Required for ${m.name}`}),c.add(P))}})}),l},[C]),se=t.useCallback(s=>s.reduce((a,l)=>a+(l.currentValue||0),0),[]),ae=t.useCallback(s=>s.every(a=>a.status==="available"),[]),f=t.useCallback(()=>{T(""),R(""),V(""),K([]),Y(""),X("all"),B("")},[]),te=t.useCallback(()=>{f(),I(null),A(!0)},[f]),le=t.useCallback(()=>{const s=u.trim();if(!s){B("Package name is required");return}if(h.some(l=>l.name.toLowerCase()===s.toLowerCase())){B("A package with this name already exists");return}A(!1),S(!0)},[u,h]),ye=t.useCallback(s=>{T(s.name),R(s.description||""),V(s.category||""),K([...s.items]),I(s),S(!0),d(null)},[d]),ve=t.useCallback(()=>{if(x){const s=h.find(a=>a.id===x.id);s&&d(s)}S(!1),A(!1),I(null),f()},[f,x,h,d]),ie=t.useCallback(s=>{K(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s])},[]),Ce=t.useCallback(async()=>{if(!(!u.trim()||g.length===0))if(x){const s={name:u.trim(),description:N.trim(),category:F.trim(),items:g};if(j?.updatePackage)try{await j.updatePackage(x.id,s)}catch(a){G("Failed to update package:",a)}else p(a=>a.map(l=>l.id===x.id?{...l,...s}:l));d({...x,...s}),S(!1),I(null),f()}else{const s={name:u.trim(),description:N.trim(),category:F.trim(),items:g,notes:[]};if(j?.createPackage)try{const a=await j.createPackage(s);d(a),S(!1),f()}catch(a){G("Failed to create package:",a)}else{const a=h.map(m=>m.id?.match?.(/^PKG-(\d+)$/)).filter(Boolean).map(m=>parseInt(m[1],10)),l=a.length>0?Math.max(...a)+1:1,c=`PKG-${String(l).padStart(3,"0")}`,n={...s,id:c};p(m=>[...m,n]),d(n),S(!1),f()}}},[u,N,F,g,x,p,d,f,h,j]),be=t.useCallback(s=>{H({isOpen:!0,id:s.id,name:s.name})},[]),Se=t.useCallback(async()=>{const{id:s}=L;if(j?.deletePackage)try{await j.deletePackage(s)}catch(a){G("Failed to delete package:",a),p(l=>l.filter(c=>c.id!==s))}else p(a=>a.filter(l=>l.id!==s));d(null),H({isOpen:!1,id:null,name:""})},[L,p,d,j]),Ne=t.useCallback(s=>{if(!o)return;const a=[...o.items,s];p(l=>l.map(c=>c.id===o.id?{...c,items:a}:c)),d(l=>({...l,items:a}))},[o,p,d]),ne=t.useCallback(s=>{O&&O(s,{returnTo:"package",packageId:o?.id,backLabel:"Back to Package"})},[O,o]);if(fe){const s=!u.trim();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-header",children:e.jsx("h2",{className:"page-title",children:"Packages"})}),e.jsx("div",{className:"modal-backdrop",style:ce.modal,children:e.jsxs("div",{style:{...ce.modalBox,maxWidth:450},onClick:a=>a.stopPropagation(),children:[e.jsx("div",{style:{padding:r[4],borderBottom:`1px solid ${i.borderLight}`},children:e.jsx("h3",{style:{margin:0,color:i.textPrimary},children:"New Package"})}),e.jsxs("div",{style:{padding:r[4]},children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("label",{className:`form-label ${s?"label-required-empty":""}`,children:["Package Name ",e.jsx("span",{className:"required-indicator",children:"*"})]}),e.jsx("input",{type:"text",value:u,onChange:a=>{T(a.target.value),B("")},onKeyDown:a=>a.key==="Enter"&&le(),placeholder:"e.g., Wedding Photography Package",className:`input ${s?"input-required-empty":""}`,autoFocus:!0}),Q&&e.jsx("span",{className:"required-error-text",children:Q})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{value:N,onChange:a=>R(a.target.value),placeholder:"Describe what this package is for...",rows:3,className:"input",style:{resize:"vertical"}})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx("input",{type:"text",value:F,onChange:a=>V(a.target.value),placeholder:"e.g., Cameras, Audio, Lighting",className:"input"})]})]}),e.jsxs("div",{style:{padding:r[4],paddingTop:0,display:"flex",gap:r[2],justifyContent:"flex-end"},children:[e.jsx(y,{variant:"secondary",onClick:()=>{A(!1),f()},children:"Cancel"}),e.jsx(y,{onClick:le,disabled:s,children:"Continue to Select Items"})]})]})})]})}if(ge)return e.jsxs("div",{className:"view-container",style:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"calc(100vh - 60px)",overflow:"hidden"},children:[e.jsxs("div",{className:"page-header",style:{flexShrink:0},children:[e.jsxs("div",{children:[e.jsx("h2",{className:"page-title",children:x?`Edit: ${u}`:`Create: ${u}`}),e.jsxs("div",{style:{fontSize:b.fontSize.sm,color:i.textMuted,marginTop:4},children:[g.length," items selected",N&&e.jsxs("span",{children:[" • ",N]})]})]}),e.jsxs("div",{style:{display:"flex",gap:r[2]},children:[e.jsx(y,{variant:"secondary",onClick:ve,children:"Cancel"}),e.jsx(y,{onClick:Ce,disabled:g.length===0,icon:x?xe:q,children:x?"Save Changes":"Create Package"})]})]}),e.jsxs(M,{padding:!1,style:{flex:"1 1 auto",display:"flex",flexDirection:"column",minHeight:0,maxHeight:"calc(100vh - 180px)",overflow:"hidden"},children:[e.jsxs("div",{className:"panel-header",style:{flexShrink:0,flexWrap:"wrap",gap:r[2]},children:[e.jsxs("div",{className:"panel-header-title",children:[e.jsx(z,{size:16,color:i.primary}),e.jsx("strong",{children:"Select Items"}),e.jsxs("span",{className:"panel-header-count",children:[g.length," selected"]})]}),e.jsxs("div",{style:{display:"flex",gap:r[2],alignItems:"center",flexWrap:"wrap"},children:[e.jsx(Pe,{value:w,onChange:s=>X(s.target.value),options:pe.map(s=>({value:s,label:s==="all"?"All Categories":s})),style:{minWidth:"160px"}}),e.jsx(oe,{value:k,onChange:Y,onClear:()=>Y(""),placeholder:"Search items..."})]})]}),e.jsx("div",{className:"selection-list",style:{flex:"1 1 auto",overflowY:"auto",minHeight:0},children:Z.length===0?e.jsxs("div",{style:{padding:r[4],textAlign:"center",color:i.textMuted},children:["No items found",w!=="all"?` in ${w}`:"",k&&` matching "${k}"`]}):Z.map(s=>e.jsxs("div",{className:`selection-item ${g.includes(s.id)?"selected":""}`,onClick:()=>ie(s.id),style:{cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:g.includes(s.id),onChange:()=>ie(s.id)}),e.jsxs("div",{className:"selection-item-info",children:[e.jsx("div",{className:"selection-item-name",children:s.name}),e.jsxs("div",{className:"selection-item-meta",children:[s.id," • ",s.category]})]}),e.jsx(v,{text:s.status,color:de(s.status),size:"sm"})]},s.id))})]})]});if(o){const s=ee(o),a=se(s),l=ae(s),c=je(o);return e.jsxs("div",{className:"view-container",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("div",{className:"detail-header-left",children:[e.jsx("button",{className:"btn-icon",onClick:()=>d(null),children:e.jsx($e,{size:18})}),e.jsxs("div",{className:"detail-header-info",children:[e.jsxs("h2",{children:[o.name,e.jsx(v,{text:"Package",color:i.accent2,style:{marginLeft:8}})]}),e.jsxs("div",{className:"detail-header-meta",children:[o.id," • ",s.length," items • ",me(a)," total value"]})]})]}),e.jsxs("div",{className:"detail-header-actions",children:[e.jsx(y,{variant:"secondary",onClick:()=>ye(o),icon:xe,children:"Edit"}),e.jsx("button",{className:"btn-icon danger",onClick:()=>be(o),children:e.jsx(Le,{size:16})})]})]}),o.description&&e.jsx("p",{style:{color:i.textSecondary,marginBottom:r[4],fontSize:b.fontSize.sm},children:o.description}),!l&&e.jsxs("div",{className:"alert-warning",children:[e.jsx(ue,{size:16}),e.jsx("span",{children:"Some items in this package are not available"})]}),e.jsxs("div",{style:{display:"flex",gap:r[4],flex:1,minHeight:0},children:[e.jsxs(M,{padding:!1,style:{flex:2,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:[e.jsx(he,{title:`Package Contents (${s.length})`,icon:z}),e.jsx("div",{style:{flex:1,overflowY:"auto"},children:s.map(n=>e.jsxs("div",{className:"list-item",onClick:()=>ne(n.id),children:[n.image?e.jsx(ze,{src:n.image,alt:n.name,size:"thumbnail",width:40,height:40,style:{borderRadius:De.md,flexShrink:0},objectFit:"cover"}):e.jsx("div",{className:"list-item-image-placeholder",children:e.jsx(z,{size:16,color:i.textMuted})}),e.jsxs("div",{className:"list-item-content",children:[e.jsxs("div",{className:"list-item-badges",children:[e.jsx(v,{text:n.id,color:i.primary}),e.jsx(v,{text:n.category,color:i.accent2})]}),e.jsx("div",{className:"list-item-title",children:n.name})]}),e.jsx(v,{text:n.status,color:de(n.status)}),e.jsx(Fe,{size:16,color:i.textMuted})]},n.id))})]}),c.length>0&&e.jsxs(M,{padding:!1,style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:[e.jsx(he,{title:`Suggested Accessories (${c.length})`,icon:Be}),e.jsx("div",{style:{flex:1,overflowY:"auto"},children:c.map(({item:n,reason:m})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r[2],padding:`${r[3]}px ${r[4]}px`,borderBottom:`1px solid ${i.borderLight}`},children:[e.jsxs("div",{style:{flex:1,cursor:"pointer"},onClick:()=>ne(n.id),children:[e.jsx("div",{style:{fontWeight:b.fontWeight.medium,color:i.textPrimary,fontSize:b.fontSize.sm},children:n.name}),e.jsx("div",{style:{fontSize:b.fontSize.xs,color:i.textMuted},children:m})]}),e.jsx(y,{size:"sm",variant:"secondary",onClick:()=>Ne(n.id),icon:q,children:"Add"})]},n.id))})]})]}),e.jsx(Ae,{isOpen:L.isOpen,title:"Delete Package",message:`Are you sure you want to delete "${L.name}"? This action cannot be undone.`,onConfirm:Se,onCancel:()=>H({isOpen:!1,id:null,name:""})})]})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{className:"page-title",children:"Packages"}),e.jsx(y,{onClick:te,icon:q,children:"Create Package"})]}),e.jsx("div",{style:{marginBottom:r[4],maxWidth:300},children:e.jsx(oe,{value:$,onChange:J,onClear:()=>J(""),placeholder:"Search packages..."})}),e.jsx("div",{style:{borderBottom:`1px solid ${i.border}`,marginBottom:r[4]}}),U.length===0?e.jsx(Ie,{icon:z,title:"No Packages Found",description:h.length===0?"Packages group individual items together for specific jobs or purposes.":"No packages match your search.",action:h.length===0&&e.jsx(y,{onClick:te,icon:q,children:"Create Your First Package"})}):e.jsx("div",{className:"card-grid",children:U.map(s=>{const a=ee(s),l=se(a),c=ae(a);return e.jsxs(M,{onClick:()=>d(s),className:"card-clickable",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:r[3]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r[2]},children:[e.jsx(z,{size:18,color:i.accent2}),e.jsx("h3",{style:{margin:0,fontSize:b.fontSize.lg,color:i.textPrimary},children:s.name})]}),!c&&e.jsx(ue,{size:16,color:i.checkedOut})]}),e.jsxs("div",{style:{display:"flex",gap:r[2],marginBottom:r[2],flexWrap:"wrap"},children:[e.jsx(v,{text:s.id,color:i.accent2}),e.jsx(v,{text:`${a.length} items`,color:i.accent1}),e.jsx(v,{text:me(l),color:i.available})]}),s.description&&e.jsx("div",{style:{fontSize:b.fontSize.sm,color:i.textMuted,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.description})]},s.id)})})]})}const We=t.memo(Ee);export{We as default};
//# sourceMappingURL=PackagesView-BRk7n8Z8.js.map
