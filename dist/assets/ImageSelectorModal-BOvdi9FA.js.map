{"version":3,"mappings":"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","names":["ImageSelectorModal","memo","images","currentImage","itemId","onSelect","onClose","uploadedImage","setUploadedImage","useState","cropSrc","setCropSrc","uploading","setUploading","error","setError","fileInputRef","useRef","selectedFileRef","handleFileUpload","e","file","reader","ev","handleCropComplete","croppedDataUrl","handleCropCancel","handleUseImage","storageService","__vitePreload","n","result","err","logError","jsxs","Modal","jsx","ModalHeader","spacing","borderRadius","colors","ImageCropEditor","Fragment","Upload","styles","Button","Image","typography","Trash2","PropTypes"],"ignoreList":[],"sources":["../../modals/ImageSelectorModal.jsx"],"sourcesContent":["// ============================================================================\n// Image Selector Modal\n// Upload and manage item images with storage integration\n// ============================================================================\n\nimport React, { memo, useState, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { Upload, Image, Trash2 } from 'lucide-react';\nimport { colors, styles, spacing, borderRadius, typography } from '../theme.js';\nimport { Button } from '../components/ui.jsx';\nimport { Modal, ModalHeader } from './ModalBase.jsx';\nimport ImageCropEditor from '../components/ImageCropEditor.jsx';\n\nimport { error as logError } from '../lib/logger.js';\n\nexport const ImageSelectorModal = memo(function ImageSelectorModal({ \n  images, \n  currentImage, \n  itemId,\n  onSelect, \n  onClose \n}) {\n  const [uploadedImage, setUploadedImage] = useState(null);\n  const [cropSrc, setCropSrc] = useState(null);\n  const [uploading, setUploading] = useState(false);\n  const [error, setError] = useState(null);\n  const fileInputRef = useRef(null);\n  const selectedFileRef = useRef(null);\n\n  const handleFileUpload = (e) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      // Validate file size (5MB max)\n      if (file.size > 5 * 1024 * 1024) {\n        setError('Image must be smaller than 5MB');\n        return;\n      }\n      \n      // Validate file type\n      if (!file.type.startsWith('image/')) {\n        setError('Please select an image file');\n        return;\n      }\n      \n      setError(null);\n      selectedFileRef.current = file;\n      \n      // Open crop editor\n      const reader = new FileReader();\n      reader.onload = (ev) => setCropSrc(ev.target.result);\n      reader.readAsDataURL(file);\n    }\n    // Reset input so same file can be re-selected\n    if (e.target) e.target.value = '';\n  };\n\n  const handleCropComplete = (croppedDataUrl) => {\n    setUploadedImage(croppedDataUrl);\n    setCropSrc(null);\n  };\n\n  const handleCropCancel = () => {\n    setCropSrc(null);\n  };\n  \n  const handleUseImage = async () => {\n    if (!uploadedImage) return;\n    \n    setUploading(true);\n    setError(null);\n    \n    try {\n      // Import storage service dynamically to avoid circular deps\n      const { storageService } = await import('../lib/index.js');\n      \n      if (!itemId) {\n        // No itemId, just use the data URL\n        onSelect(uploadedImage);\n      } else {\n        // Upload to Supabase Storage\n        const result = await storageService.uploadFromDataUrl(uploadedImage, itemId);\n        onSelect(result.url);\n      }\n    } catch (err) {\n      logError('Image upload error:', err);\n      setError(err.message || 'Failed to upload image');\n      // Fall back to data URL if upload fails\n      onSelect(uploadedImage);\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  return (\n    <Modal onClose={onClose} maxWidth={500}>\n      <ModalHeader title=\"Select Image\" onClose={onClose} />\n      <div style={{ padding: cropSrc ? 0 : spacing[4] }}>\n        {error && (\n          <div style={{\n            background: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid rgba(239, 68, 68, 0.3)',\n            borderRadius: borderRadius.md,\n            padding: spacing[3],\n            margin: cropSrc ? spacing[4] : 0,\n            marginBottom: spacing[4],\n            fontSize: '14px',\n            color: colors.danger,\n          }}>\n            {error}\n          </div>\n        )}\n        \n        {cropSrc ? (\n          /* Crop editor step */\n          <ImageCropEditor\n            imageSrc={cropSrc}\n            onCropComplete={handleCropComplete}\n            onCancel={handleCropCancel}\n            outputSize={600}\n            cropShape=\"square\"\n            title=\"Crop your image\"\n          />\n        ) : (\n          <>\n            <div \n              onClick={() => !uploading && fileInputRef.current?.click()} \n              style={{ \n                border: `2px dashed ${colors.border}`, \n                borderRadius: borderRadius.lg, \n                padding: spacing[6], \n                textAlign: 'center', \n                cursor: uploading ? 'not-allowed' : 'pointer', \n                marginBottom: spacing[4],\n                opacity: uploading ? 0.6 : 1,\n              }}\n            >\n              <Upload size={32} color={colors.textMuted} style={{ marginBottom: spacing[2] }} />\n              <p style={{ color: colors.textMuted, margin: 0 }}>\n                {uploading ? 'Uploading...' : 'Click to upload an image'}\n              </p>\n              <p style={{ color: colors.textMuted, margin: '8px 0 0', fontSize: '12px' }}>\n                Max size: 5MB. Formats: JPG, PNG, WebP, GIF\n              </p>\n              <input \n                ref={fileInputRef} \n                type=\"file\" \n                accept=\"image/jpeg,image/png,image/webp,image/gif\" \n                onChange={handleFileUpload} \n                style={{ display: 'none' }} \n                disabled={uploading}\n              />\n            </div>\n            \n            {uploadedImage && (\n              <div style={{ marginBottom: spacing[4] }}>\n                <p style={{ ...styles.label, marginBottom: spacing[2] }}>Preview</p>\n                <div style={{ display: 'flex', alignItems: 'center', gap: spacing[3] }}>\n                  <img \n                    src={uploadedImage} \n                    alt=\"Preview\" \n                    style={{ \n                      width: 80, \n                      height: 80, \n                      objectFit: 'cover', \n                      borderRadius: borderRadius.md \n                    }} \n                  />\n                  <div style={{ display: 'flex', flexDirection: 'column', gap: spacing[2] }}>\n                    <Button \n                      onClick={handleUseImage} \n                      icon={uploading ? null : Image}\n                      disabled={uploading}\n                    >\n                      {uploading ? 'Uploading...' : 'Use This Image'}\n                    </Button>\n                    <button\n                      onClick={() => setCropSrc(uploadedImage)}\n                      style={{\n                        background: 'none',\n                        border: 'none',\n                        color: colors.primary,\n                        cursor: 'pointer',\n                        fontSize: typography.fontSize.sm,\n                        textAlign: 'left',\n                      }}\n                    >\n                      Resize / Crop again\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n            \n            {currentImage && (\n              <Button \n                variant=\"secondary\" \n                danger \n                fullWidth \n                onClick={() => onSelect(null)} \n                icon={Trash2}\n                disabled={uploading}\n              >\n                Remove Current Image\n              </Button>\n            )}\n          </>\n        )}\n      </div>\n    </Modal>\n  );\n});\n\n// ============================================================================\n// PropTypes\n// ============================================================================\nImageSelectorModal.propTypes = {\n  /** Array of available image URLs (unused in current implementation) */\n  images: PropTypes.arrayOf(PropTypes.string),\n  /** Current image URL */\n  currentImage: PropTypes.string,\n  /** Item ID for storage upload */\n  itemId: PropTypes.string,\n  /** Callback when image is selected */\n  onSelect: PropTypes.func.isRequired,\n  /** Callback to close modal */\n  onClose: PropTypes.func.isRequired,\n};\n"],"file":"ImageSelectorModal-BOvdi9FA.js"}