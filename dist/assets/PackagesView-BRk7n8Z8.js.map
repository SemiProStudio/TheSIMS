{"version":3,"file":"PackagesView-BRk7n8Z8.js","sources":["../../views/PackagesView.jsx"],"sourcesContent":["// ============================================================================\n// Packages View Component\n// Manages package templates - create, edit, view packages\n// ============================================================================\n\nimport React, { memo, useState, useCallback, useMemo, useEffect } from 'react';\nimport { Plus, Package, Trash2, ArrowLeft, ChevronRight, Edit2, AlertTriangle, Lightbulb } from 'lucide-react';\nimport { colors, styles, spacing, borderRadius, typography, withOpacity } from '../theme.js';\nimport { formatMoney, getStatusColor } from '../utils.js';\nimport { Badge, Card, CardHeader, Button, SearchInput, EmptyState, ConfirmDialog } from '../components/ui.jsx';\nimport { Select } from '../components/Select.jsx';\nimport { OptimizedImage } from '../components/OptimizedImage.jsx';\nimport { useData } from '../lib/DataContext.jsx';\n\nimport { error as logError } from '../lib/logger.js';\n\nfunction PackagesView({ \n  packages, \n  setPackages, \n  inventory, \n  onViewItem,\n  initialSelectedPackage = null,\n  onPackageSelect,\n}) {\n  const dataContext = useData();\n  const [selectedPackage, setSelectedPackageInternal] = useState(initialSelectedPackage);\n  const [showCreate, setShowCreate] = useState(false);\n  const [showDetailsPrompt, setShowDetailsPrompt] = useState(false); // Details popup\n  const [editingPackage, setEditingPackage] = useState(null);\n  const [packageSearch, setPackageSearch] = useState('');\n  const [confirmDelete, setConfirmDelete] = useState({ isOpen: false, id: null, name: '' });\n  \n  // Form state for create/edit\n  const [formName, setFormName] = useState('');\n  const [formDescription, setFormDescription] = useState('');\n  const [formCategory, setFormCategory] = useState('');\n  const [formItems, setFormItems] = useState([]);\n  const [itemSearch, setItemSearch] = useState('');\n  const [nameError, setNameError] = useState('');\n\n  // Wrapper to sync with parent state\n  const setSelectedPackage = useCallback((pkg) => {\n    setSelectedPackageInternal(pkg);\n    if (onPackageSelect) onPackageSelect(pkg);\n  }, [onPackageSelect]);\n\n  // Sync with initialSelectedPackage prop changes\n  useEffect(() => {\n    if (initialSelectedPackage) {\n      setSelectedPackageInternal(initialSelectedPackage);\n    }\n  }, [initialSelectedPackage]);\n\n  // Get individual items (non-kits) for selection\n  const individualItems = useMemo(() => inventory.filter(item => !item.isKit), [inventory]);\n\n  // Filter packages by search\n  const filteredPackages = useMemo(() => {\n    if (!packageSearch.trim()) return packages;\n    const q = packageSearch.toLowerCase();\n    return packages.filter(pkg => \n      pkg.name.toLowerCase().includes(q) || \n      pkg.id.toLowerCase().includes(q) ||\n      (pkg.description && pkg.description.toLowerCase().includes(q))\n    );\n  }, [packages, packageSearch]);\n\n  // Get unique categories from inventory for filter dropdown\n  const availableCategories = useMemo(() => {\n    const cats = new Set(individualItems.map(item => item.category).filter(Boolean));\n    return ['all', ...Array.from(cats).sort()];\n  }, [individualItems]);\n\n  // Category filter state for item selection\n  const [itemCategoryFilter, setItemCategoryFilter] = useState('all');\n\n  // Filter items for selection (by search AND category)\n  const filteredItemsForSelect = useMemo(() => {\n    let items = individualItems;\n    \n    // Filter by category first\n    if (itemCategoryFilter !== 'all') {\n      items = items.filter(item => item.category === itemCategoryFilter);\n    }\n    \n    // Then filter by search\n    if (itemSearch.trim()) {\n      const q = itemSearch.toLowerCase();\n      items = items.filter(item => \n        item.name.toLowerCase().includes(q) || \n        item.id.toLowerCase().includes(q) ||\n        item.category.toLowerCase().includes(q)\n      );\n    }\n    \n    return items;\n  }, [individualItems, itemSearch, itemCategoryFilter]);\n\n  // Get items for a package\n  const getPackageItems = useCallback((pkg) => {\n    if (!pkg.items) return [];\n    return pkg.items.map(id => inventory.find(i => i.id === id)).filter(Boolean);\n  }, [inventory]);\n\n  // Get suggested accessories for a package based on requiredAccessories\n  const getSuggestedAccessories = useCallback((pkg) => {\n    const packageItemIds = new Set(pkg.items || []);\n    const suggestions = [];\n    const seenIds = new Set();\n\n    pkg.items?.forEach(itemId => {\n      const item = inventory.find(i => i.id === itemId);\n      if (!item) return;\n\n      if (item.requiredAccessories && item.requiredAccessories.length > 0) {\n        item.requiredAccessories.forEach(accId => {\n          if (!packageItemIds.has(accId) && !seenIds.has(accId)) {\n            const accessory = inventory.find(i => i.id === accId);\n            if (accessory) {\n              suggestions.push({ item: accessory, reason: `Required for ${item.name}` });\n              seenIds.add(accId);\n            }\n          }\n        });\n      }\n    });\n\n    return suggestions;\n  }, [inventory]);\n\n  const calculateValue = useCallback((items) => {\n    return items.reduce((sum, item) => sum + (item.currentValue || 0), 0);\n  }, []);\n\n  const allItemsAvailable = useCallback((items) => {\n    return items.every(item => item.status === 'available');\n  }, []);\n\n  // Reset form\n  const resetForm = useCallback(() => {\n    setFormName('');\n    setFormDescription('');\n    setFormCategory('');\n    setFormItems([]);\n    setItemSearch('');\n    setItemCategoryFilter('all');\n    setNameError('');\n  }, []);\n\n  // Open create mode - show details prompt first\n  const handleStartCreate = useCallback(() => {\n    resetForm();\n    setEditingPackage(null);\n    setShowDetailsPrompt(true);\n  }, [resetForm]);\n\n  // Handle details prompt submission\n  const handleDetailsSubmit = useCallback(() => {\n    const trimmedName = formName.trim();\n    if (!trimmedName) {\n      setNameError('Package name is required');\n      return;\n    }\n    // Check for duplicate name (case-insensitive)\n    const isDuplicate = packages.some(pkg => \n      pkg.name.toLowerCase() === trimmedName.toLowerCase()\n    );\n    if (isDuplicate) {\n      setNameError('A package with this name already exists');\n      return;\n    }\n    setShowDetailsPrompt(false);\n    setShowCreate(true);\n  }, [formName, packages]);\n\n  // Open edit mode - go straight to item selection (details already exist)\n  const handleStartEdit = useCallback((pkg) => {\n    setFormName(pkg.name);\n    setFormDescription(pkg.description || '');\n    setFormCategory(pkg.category || '');\n    setFormItems([...pkg.items]);\n    setEditingPackage(pkg);\n    setShowCreate(true);\n    setSelectedPackage(null);\n  }, [setSelectedPackage]);\n\n  // Cancel create/edit - return to package detail if editing\n  const handleCancel = useCallback(() => {\n    if (editingPackage) {\n      // Return to the package detail view\n      const pkg = packages.find(p => p.id === editingPackage.id);\n      if (pkg) {\n        setSelectedPackage(pkg);\n      }\n    }\n    setShowCreate(false);\n    setShowDetailsPrompt(false);\n    setEditingPackage(null);\n    resetForm();\n  }, [resetForm, editingPackage, packages, setSelectedPackage]);\n\n  // Toggle item selection\n  const handleToggleItem = useCallback((itemId) => {\n    setFormItems(prev => \n      prev.includes(itemId) \n        ? prev.filter(id => id !== itemId)\n        : [...prev, itemId]\n    );\n  }, []);\n\n  // Save package (create or update)\n  const handleSave = useCallback(async () => {\n    if (!formName.trim() || formItems.length === 0) return;\n\n    if (editingPackage) {\n      // Update existing\n      const updates = { \n        name: formName.trim(), \n        description: formDescription.trim(), \n        category: formCategory.trim(), \n        items: formItems \n      };\n      \n      // Persist to Supabase via DataContext\n      if (dataContext?.updatePackage) {\n        try {\n          await dataContext.updatePackage(editingPackage.id, updates);\n        } catch (err) {\n          logError('Failed to update package:', err);\n        }\n      } else {\n        // Fallback to local state\n        setPackages(prev => prev.map(pkg => \n          pkg.id === editingPackage.id ? { ...pkg, ...updates } : pkg\n        ));\n      }\n      \n      // Return to the updated package detail\n      setSelectedPackage({ ...editingPackage, ...updates });\n      setShowCreate(false);\n      setEditingPackage(null);\n      resetForm();\n    } else {\n      // Create new package - let DB generate the ID\n      const newPackage = {\n        name: formName.trim(),\n        description: formDescription.trim(),\n        category: formCategory.trim(),\n        items: formItems,\n        notes: [],\n      };\n      \n      // Persist to Supabase via DataContext\n      if (dataContext?.createPackage) {\n        try {\n          const createdPackage = await dataContext.createPackage(newPackage);\n          // Show the new package with DB-generated ID\n          setSelectedPackage(createdPackage);\n          setShowCreate(false);\n          resetForm();\n        } catch (err) {\n          logError('Failed to create package:', err);\n        }\n      } else {\n        // Fallback - generate local ID if no DB\n        const existingNumbers = packages\n          .map(p => p.id?.match?.(/^PKG-(\\d+)$/))\n          .filter(Boolean)\n          .map(m => parseInt(m[1], 10));\n        const nextNum = existingNumbers.length > 0 ? Math.max(...existingNumbers) + 1 : 1;\n        const localId = `PKG-${String(nextNum).padStart(3, '0')}`;\n        const localPackage = { ...newPackage, id: localId };\n        setPackages(prev => [...prev, localPackage]);\n        setSelectedPackage(localPackage);\n        setShowCreate(false);\n        resetForm();\n      }\n    }\n  }, [formName, formDescription, formCategory, formItems, editingPackage, setPackages, setSelectedPackage, resetForm, packages, dataContext]);\n\n  // Delete package - close detail first, then show confirm\n  const handleDeleteClick = useCallback((pkg) => {\n    setConfirmDelete({ isOpen: true, id: pkg.id, name: pkg.name });\n  }, []);\n\n  const handleDeleteConfirm = useCallback(async () => {\n    const { id } = confirmDelete;\n    \n    // Persist to Supabase via DataContext\n    if (dataContext?.deletePackage) {\n      try {\n        await dataContext.deletePackage(id);\n      } catch (err) {\n        logError('Failed to delete package:', err);\n        // Fallback to local state\n        setPackages(prev => prev.filter(p => p.id !== id));\n      }\n    } else {\n      setPackages(prev => prev.filter(p => p.id !== id));\n    }\n    \n    setSelectedPackage(null);\n    setConfirmDelete({ isOpen: false, id: null, name: '' });\n  }, [confirmDelete, setPackages, setSelectedPackage, dataContext]);\n\n  // Add suggested accessory to package\n  const handleAddSuggested = useCallback((itemId) => {\n    if (!selectedPackage) return;\n    const newItems = [...selectedPackage.items, itemId];\n    setPackages(prev => prev.map(pkg => \n      pkg.id === selectedPackage.id \n        ? { ...pkg, items: newItems }\n        : pkg\n    ));\n    setSelectedPackage(prev => ({ ...prev, items: newItems }));\n  }, [selectedPackage, setPackages, setSelectedPackage]);\n\n  // Handle viewing item with proper back context\n  const handleViewItem = useCallback((itemId) => {\n    if (onViewItem) {\n      onViewItem(itemId, { \n        returnTo: 'package', \n        packageId: selectedPackage?.id,\n        backLabel: 'Back to Package'\n      });\n    }\n  }, [onViewItem, selectedPackage]);\n\n  // ============================================================================\n  // Details Prompt Modal (for Create)\n  // ============================================================================\n  if (showDetailsPrompt) {\n    const isNameEmpty = !formName.trim();\n    return (\n      <>\n        <div className=\"page-header\">\n          <h2 className=\"page-title\">Packages</h2>\n        </div>\n        \n        <div className=\"modal-backdrop\" style={styles.modal}>\n          <div style={{ ...styles.modalBox, maxWidth: 450 }} onClick={e => e.stopPropagation()}>\n            <div style={{ padding: spacing[4], borderBottom: `1px solid ${colors.borderLight}` }}>\n              <h3 style={{ margin: 0, color: colors.textPrimary }}>New Package</h3>\n            </div>\n            <div style={{ padding: spacing[4] }}>\n              <div className=\"form-section\">\n                <label className={`form-label ${isNameEmpty ? 'label-required-empty' : ''}`}>\n                  Package Name <span className=\"required-indicator\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={formName}\n                  onChange={e => { setFormName(e.target.value); setNameError(''); }}\n                  onKeyDown={e => e.key === 'Enter' && handleDetailsSubmit()}\n                  placeholder=\"e.g., Wedding Photography Package\"\n                  className={`input ${isNameEmpty ? 'input-required-empty' : ''}`}\n                  autoFocus\n                />\n                {nameError && <span className=\"required-error-text\">{nameError}</span>}\n              </div>\n\n              <div className=\"form-section\">\n                <label className=\"form-label\">Description</label>\n                <textarea\n                  value={formDescription}\n                  onChange={e => setFormDescription(e.target.value)}\n                  placeholder=\"Describe what this package is for...\"\n                  rows={3}\n                  className=\"input\"\n                  style={{ resize: 'vertical' }}\n                />\n              </div>\n\n              <div className=\"form-section\">\n                <label className=\"form-label\">Category</label>\n                <input\n                  type=\"text\"\n                  value={formCategory}\n                  onChange={e => setFormCategory(e.target.value)}\n                  placeholder=\"e.g., Cameras, Audio, Lighting\"\n                  className=\"input\"\n                />\n              </div>\n            </div>\n            <div style={{ padding: spacing[4], paddingTop: 0, display: 'flex', gap: spacing[2], justifyContent: 'flex-end' }}>\n              <Button variant=\"secondary\" onClick={() => { setShowDetailsPrompt(false); resetForm(); }}>Cancel</Button>\n              <Button onClick={handleDetailsSubmit} disabled={isNameEmpty}>Continue to Select Items</Button>\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n\n  // ============================================================================\n  // Create/Edit View (Item Selection Only)\n  // ============================================================================\n  if (showCreate) {\n    return (\n      <div className=\"view-container\" style={{ \n        display: 'flex', \n        flexDirection: 'column', \n        height: '100%',\n        maxHeight: 'calc(100vh - 60px)', \n        overflow: 'hidden' \n      }}>\n        <div className=\"page-header\" style={{ flexShrink: 0 }}>\n          <div>\n            <h2 className=\"page-title\">{editingPackage ? `Edit: ${formName}` : `Create: ${formName}`}</h2>\n            <div style={{ fontSize: typography.fontSize.sm, color: colors.textMuted, marginTop: 4 }}>\n              {formItems.length} items selected\n              {formDescription && <span> • {formDescription}</span>}\n            </div>\n          </div>\n          <div style={{ display: 'flex', gap: spacing[2] }}>\n            <Button variant=\"secondary\" onClick={handleCancel}>Cancel</Button>\n            <Button \n              onClick={handleSave} \n              disabled={formItems.length === 0}\n              icon={editingPackage ? Edit2 : Plus}\n            >\n              {editingPackage ? 'Save Changes' : 'Create Package'}\n            </Button>\n          </div>\n        </div>\n\n        <Card padding={false} style={{ \n          flex: '1 1 auto', \n          display: 'flex', \n          flexDirection: 'column', \n          minHeight: 0, \n          maxHeight: 'calc(100vh - 180px)',\n          overflow: 'hidden' \n        }}>\n          <div className=\"panel-header\" style={{ flexShrink: 0, flexWrap: 'wrap', gap: spacing[2] }}>\n            <div className=\"panel-header-title\">\n              <Package size={16} color={colors.primary} />\n              <strong>Select Items</strong>\n              <span className=\"panel-header-count\">{formItems.length} selected</span>\n            </div>\n            <div style={{ display: 'flex', gap: spacing[2], alignItems: 'center', flexWrap: 'wrap' }}>\n              <Select\n                value={itemCategoryFilter}\n                onChange={e => setItemCategoryFilter(e.target.value)}\n                options={availableCategories.map(cat => ({\n                  value: cat,\n                  label: cat === 'all' ? 'All Categories' : cat\n                }))}\n                style={{ minWidth: '160px' }}\n              />\n              <SearchInput \n                value={itemSearch} \n                onChange={setItemSearch} \n                onClear={() => setItemSearch('')}\n                placeholder=\"Search items...\" \n              />\n            </div>\n          </div>\n          <div className=\"selection-list\" style={{ flex: '1 1 auto', overflowY: 'auto', minHeight: 0 }}>\n            {filteredItemsForSelect.length === 0 ? (\n              <div style={{ padding: spacing[4], textAlign: 'center', color: colors.textMuted }}>\n                No items found{itemCategoryFilter !== 'all' ? ` in ${itemCategoryFilter}` : ''}\n                {itemSearch && ` matching \"${itemSearch}\"`}\n              </div>\n            ) : (\n              filteredItemsForSelect.map(item => (\n                <div \n                  key={item.id}\n                  className={`selection-item ${formItems.includes(item.id) ? 'selected' : ''}`}\n                  onClick={() => handleToggleItem(item.id)}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={formItems.includes(item.id)}\n                    onChange={() => handleToggleItem(item.id)}\n                  />\n                  <div className=\"selection-item-info\">\n                    <div className=\"selection-item-name\">{item.name}</div>\n                    <div className=\"selection-item-meta\">{item.id} • {item.category}</div>\n                  </div>\n                  <Badge text={item.status} color={getStatusColor(item.status)} size=\"sm\" />\n                </div>\n              ))\n            )}\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  // ============================================================================\n  // Package Detail View\n  // ============================================================================\n  if (selectedPackage) {\n    const packageItems = getPackageItems(selectedPackage);\n    const packageValue = calculateValue(packageItems);\n    const allAvailable = allItemsAvailable(packageItems);\n    const suggestedAccessories = getSuggestedAccessories(selectedPackage);\n\n    return (\n      <div className=\"view-container\">\n        <div className=\"detail-header\">\n          <div className=\"detail-header-left\">\n            <button className=\"btn-icon\" onClick={() => setSelectedPackage(null)}>\n              <ArrowLeft size={18} />\n            </button>\n            <div className=\"detail-header-info\">\n              <h2>\n                {selectedPackage.name}\n                <Badge text=\"Package\" color={colors.accent2} style={{ marginLeft: 8 }} />\n              </h2>\n              <div className=\"detail-header-meta\">\n                {selectedPackage.id} • {packageItems.length} items • {formatMoney(packageValue)} total value\n              </div>\n            </div>\n          </div>\n          <div className=\"detail-header-actions\">\n            <Button variant=\"secondary\" onClick={() => handleStartEdit(selectedPackage)} icon={Edit2}>Edit</Button>\n            <button className=\"btn-icon danger\" onClick={() => handleDeleteClick(selectedPackage)}>\n              <Trash2 size={16} />\n            </button>\n          </div>\n        </div>\n\n        {selectedPackage.description && (\n          <p style={{ color: colors.textSecondary, marginBottom: spacing[4], fontSize: typography.fontSize.sm }}>{selectedPackage.description}</p>\n        )}\n\n        {!allAvailable && (\n          <div className=\"alert-warning\">\n            <AlertTriangle size={16} />\n            <span>Some items in this package are not available</span>\n          </div>\n        )}\n        \n        <div style={{ display: 'flex', gap: spacing[4], flex: 1, minHeight: 0 }}>\n          {/* Package Contents */}\n          <Card padding={false} style={{ flex: 2, display: 'flex', flexDirection: 'column', minHeight: 0, overflow: 'hidden' }}>\n            <CardHeader title={`Package Contents (${packageItems.length})`} icon={Package} />\n            <div style={{ flex: 1, overflowY: 'auto' }}>\n              {packageItems.map(item => (\n                <div key={item.id} className=\"list-item\" onClick={() => handleViewItem(item.id)}>\n                  {item.image ? (\n                    <OptimizedImage \n                      src={item.image} \n                      alt={item.name} \n                      size=\"thumbnail\"\n                      width={40} \n                      height={40}\n                      style={{ borderRadius: borderRadius.md, flexShrink: 0 }}\n                      objectFit=\"cover\"\n                    />\n                  ) : (\n                    <div className=\"list-item-image-placeholder\">\n                      <Package size={16} color={colors.textMuted} />\n                    </div>\n                  )}\n                  <div className=\"list-item-content\">\n                    <div className=\"list-item-badges\">\n                      <Badge text={item.id} color={colors.primary} />\n                      <Badge text={item.category} color={colors.accent2} />\n                    </div>\n                    <div className=\"list-item-title\">{item.name}</div>\n                  </div>\n                  <Badge text={item.status} color={getStatusColor(item.status)} />\n                  <ChevronRight size={16} color={colors.textMuted} />\n                </div>\n              ))}\n            </div>\n          </Card>\n\n          {/* Suggested Accessories */}\n          {suggestedAccessories.length > 0 && (\n            <Card padding={false} style={{ flex: 1, display: 'flex', flexDirection: 'column', minHeight: 0, overflow: 'hidden' }}>\n              <CardHeader title={`Suggested Accessories (${suggestedAccessories.length})`} icon={Lightbulb} />\n              <div style={{ flex: 1, overflowY: 'auto' }}>\n                {suggestedAccessories.map(({ item, reason }) => (\n                  <div key={item.id} style={{ display: 'flex', alignItems: 'center', gap: spacing[2], padding: `${spacing[3]}px ${spacing[4]}px`, borderBottom: `1px solid ${colors.borderLight}` }}>\n                    <div style={{ flex: 1, cursor: 'pointer' }} onClick={() => handleViewItem(item.id)}>\n                      <div style={{ fontWeight: typography.fontWeight.medium, color: colors.textPrimary, fontSize: typography.fontSize.sm }}>{item.name}</div>\n                      <div style={{ fontSize: typography.fontSize.xs, color: colors.textMuted }}>{reason}</div>\n                    </div>\n                    <Button size=\"sm\" variant=\"secondary\" onClick={() => handleAddSuggested(item.id)} icon={Plus}>\n                      Add\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            </Card>\n          )}\n        </div>\n\n        {/* Confirm dialog rendered here so it shows properly */}\n        <ConfirmDialog\n          isOpen={confirmDelete.isOpen}\n          title=\"Delete Package\"\n          message={`Are you sure you want to delete \"${confirmDelete.name}\"? This action cannot be undone.`}\n          onConfirm={handleDeleteConfirm}\n          onCancel={() => setConfirmDelete({ isOpen: false, id: null, name: '' })}\n        />\n      </div>\n    );\n  }\n\n  // ============================================================================\n  // Package List View\n  // ============================================================================\n  return (\n    <>\n      <div className=\"page-header\">\n        <h2 className=\"page-title\">Packages</h2>\n        <Button onClick={handleStartCreate} icon={Plus}>Create Package</Button>\n      </div>\n\n      <div style={{ marginBottom: spacing[4], maxWidth: 300 }}>\n        <SearchInput value={packageSearch} onChange={setPackageSearch} onClear={() => setPackageSearch('')} placeholder=\"Search packages...\" />\n      </div>\n\n      <div style={{ borderBottom: `1px solid ${colors.border}`, marginBottom: spacing[4] }} />\n      \n      {filteredPackages.length === 0 ? (\n        <EmptyState \n          icon={Package} \n          title=\"No Packages Found\" \n          description={packages.length === 0 ? \"Packages group individual items together for specific jobs or purposes.\" : \"No packages match your search.\"} \n          action={packages.length === 0 && <Button onClick={handleStartCreate} icon={Plus}>Create Your First Package</Button>}\n        />\n      ) : (\n        <div className=\"card-grid\">\n          {filteredPackages.map(pkg => {\n            const packageItems = getPackageItems(pkg);\n            const packageValue = calculateValue(packageItems);\n            const allAvailable = allItemsAvailable(packageItems);\n            return (\n              <Card key={pkg.id} onClick={() => setSelectedPackage(pkg)} className=\"card-clickable\">\n                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: spacing[3] }}>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: spacing[2] }}>\n                    <Package size={18} color={colors.accent2} />\n                    <h3 style={{ margin: 0, fontSize: typography.fontSize.lg, color: colors.textPrimary }}>{pkg.name}</h3>\n                  </div>\n                  {!allAvailable && <AlertTriangle size={16} color={colors.checkedOut} />}\n                </div>\n                <div style={{ display: 'flex', gap: spacing[2], marginBottom: spacing[2], flexWrap: 'wrap' }}>\n                  <Badge text={pkg.id} color={colors.accent2} />\n                  <Badge text={`${packageItems.length} items`} color={colors.accent1} />\n                  <Badge text={formatMoney(packageValue)} color={colors.available} />\n                </div>\n                {pkg.description && (\n                  <div style={{ fontSize: typography.fontSize.sm, color: colors.textMuted, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{pkg.description}</div>\n                )}\n              </Card>\n            );\n          })}\n        </div>\n      )}\n    </>\n  );\n}\n\nexport default memo(PackagesView);\n"],"names":["PackagesView","packages","setPackages","inventory","onViewItem","initialSelectedPackage","onPackageSelect","dataContext","useData","selectedPackage","setSelectedPackageInternal","useState","showCreate","setShowCreate","showDetailsPrompt","setShowDetailsPrompt","editingPackage","setEditingPackage","packageSearch","setPackageSearch","confirmDelete","setConfirmDelete","formName","setFormName","formDescription","setFormDescription","formCategory","setFormCategory","formItems","setFormItems","itemSearch","setItemSearch","nameError","setNameError","setSelectedPackage","useCallback","pkg","useEffect","individualItems","useMemo","item","filteredPackages","q","availableCategories","cats","itemCategoryFilter","setItemCategoryFilter","filteredItemsForSelect","items","getPackageItems","id","i","getSuggestedAccessories","packageItemIds","suggestions","seenIds","itemId","accId","accessory","calculateValue","sum","allItemsAvailable","resetForm","handleStartCreate","handleDetailsSubmit","trimmedName","handleStartEdit","handleCancel","p","handleToggleItem","prev","handleSave","updates","err","logError","newPackage","createdPackage","existingNumbers","nextNum","localId","localPackage","handleDeleteClick","handleDeleteConfirm","handleAddSuggested","newItems","handleViewItem","isNameEmpty","jsxs","Fragment","jsx","styles","e","spacing","colors","Button","typography","Edit2","Plus","Card","Package","Select","cat","SearchInput","Badge","getStatusColor","packageItems","packageValue","allAvailable","suggestedAccessories","ArrowLeft","formatMoney","Trash2","AlertTriangle","CardHeader","OptimizedImage","borderRadius","ChevronRight","Lightbulb","reason","ConfirmDialog","EmptyState","PackagesView_default","memo"],"mappings":"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"}